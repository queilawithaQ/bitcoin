<!DOCTYPE html>
<html lang="en" dir="ltr" typeof="bibo:Document w3p:CR" about="" property="dcterms:language" content="en" prefix="bibo: http://purl.org/ontology/bibo/ w3p: http://www.w3.org/2001/02pd/rec54#">
<head>
<title>FIDO 2.0: Client To Authenticator Protocol</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    

    
    
    <style>/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* --- INLINES --- */
em.rfc2119 { 
    text-transform:     lowercase;
    font-variant:       small-caps;
    font-style:         normal;
    color:              #900;
}

h1 acronym, h2 acronym, h3 acronym, h4 acronym, h5 acronym, h6 acronym, a acronym,
h1 abbr, h2 abbr, h3 abbr, h4 abbr, h5 abbr, h6 abbr, a abbr {
    border: none;
}

dfn {
    font-weight:    bold;
}

a.internalDFN {
    color:  inherit;
    border-bottom:  1px solid #99c;
    text-decoration:    none;
}

a.externalDFN {
    color:  inherit;
    border-bottom:  1px dotted #ccc;
    text-decoration:    none;
}

a.bibref {
    text-decoration:    none;
}

cite .bibref {
    font-style: normal;
}

code {
    color:  #ff4500;
}

/* --- TOC --- */
.toc a, .tof a {
    text-decoration:    none;
}

a .secno, a .figno {
    color:  #000;
}

ul.tof, ol.tof {
    list-style: none outside none;
}

.caption {
    margin-top: 0.5em;
    font-style:   italic;
}

/* --- TABLE --- */
table.simple {
    border-spacing: 0;
    border-collapse:    collapse;
    border-bottom:  3px solid #003a7c;
}

.simple th {
    background: #003a7c;
    color:  #fff;
    padding:    3px 5px;
    text-align: left;
}

.simple th[scope="row"] {
    background: inherit;
    color:  inherit;
    border-top: 1px solid #ddd;
}

.simple td {
    padding:    3px 10px;
    border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
    background: #f0f6ff;
}

/* --- DL --- */
.section dd > p:first-child {
    margin-top: 0;
}

.section dd > p:last-child {
    margin-bottom: 0;
}

.section dd {
    margin-bottom:  1em;
}

.section dl.attrs dd, .section dl.eldef dd {
    margin-bottom:  0;
}

@media print {
    .removeOnSave {
        display: none;
    }
}
</style><style>/* --- EXAMPLES --- */
div.example-title {
    min-width: 7.5em;
    color: #b9ab2d;
}
div.example-title span {
    text-transform: uppercase;   
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    //background: #fcfaee;    
    background: rgba(252,250,238,0.3);    
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example div.example-title {
    color: #999;
}
</style><style>/* HIGHLIGHTS */
code.prettyprint {
    color:  inherit;
}

/* this from google-code-prettify */
.pln{color:#000}@media screen{.str{color:#080}.kwd{color:#008}.com{color:#800}.typ{color:#606}.lit{color:#066}.pun,.opn,.clo{color:#660}.tag{color:#008}.atn{color:#606}.atv{color:#080}.dec,.var{color:#606}.fun{color:red}}@media print,projection{.str{color:#060}.kwd{color:#006;font-weight:bold}.com{color:#600;font-style:italic}.typ{color:#404;font-weight:bold}.lit{color:#044}.pun,.opn,.clo{color:#440}.tag{color:#006;font-weight:bold}.atn{color:#404}.atv{color:#060}}ol.linenums{margin-top:0;margin-bottom:0}li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8{list-style-type:none}li.L1,li.L3,li.L5,li.L7,li.L9{background:#eee}
</style><link rel="stylesheet" href="resources/FIDO-RD.css"><!--[if lt IE 9]><script src='https://www.w3.org/2008/site/js/html5shiv.js'></script><![endif]--></head>
<body class="h-entry" style="" role="document" id="respecDocument"><div class="head" role="contentinfo" id="respecHeader">
  <p>
    
      <a href="https://www.fidoalliance.org/"><img width="250" id="toplogo" src="resources/logo.png" alt="FIDO Alliance"></a>
    
  </p>
  <h1 class="title p-name" id="title" property="dcterms:title">FIDO 2.0: Client To Authenticator Protocol</h1>
  
  <h2 property="dcterms:issued" datatype="xsd:dateTime" content="2017-10-05T00:59:13.000Z" id="fido-alliance-review-draft-04-october-2017"><abbr title="FIDO Alliance">FIDO Alliance</abbr> Review Draft <time class="dt-published" datetime="2017-10-04">04 October 2017</time></h2>
  <dl>
    
      <dt>This version:</dt>
      <dd><a class="u-url" href="https://fidoalliance.org/specs/fido-undefined-v2.0-rd-20171004/fido-client-to-authenticator-protocol-v2.0-rd-20171004.html">https://fidoalliance.org/specs/fido-undefined-v2.0-rd-20171004/fido-client-to-authenticator-protocol-v2.0-rd-20171004.html</a></dd>
      <!--<dt>Latest published version:</dt>
      <dd><a href='https://fidoalliance.org/specs/fido-client-to-authenticator-protocol/'>https://fidoalliance.org/specs/fido-client-to-authenticator-protocol/</a></dd>
    
    -->
    
    
    
    
    
    
    <dt>Editors:</dt>
    <dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Rolf Lindemann" href="/cdn-cgi/l/email-protection#4d3f22212b0d232226232226632e2220">Rolf Lindemann</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.noknok.com">Nok Nok Labs</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Vijay Bharadwaj" href="/cdn-cgi/l/email-protection#36405f5c574f545e765b5f554459455950421855595b">Vijay Bharadwaj</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.microsoft.com">Microsoft</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Alexei Czeskis" href="/cdn-cgi/l/email-protection#b0d1d3cad5c3dbd9c3f0d7dfdfd7dcd59ed3dfdd">Alexei Czeskis</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.google.com/">Google</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Michael B. Jones" href="/cdn-cgi/l/email-protection#90fdf2fad0fdf9f3e2ffe3fff6e4bef3fffd">Michael B. Jones</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.microsoft.com">Microsoft</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Jeff Hodges" href="/cdn-cgi/l/email-protection#13597675753d5b7c777476605363726a63727f3d707c7e">Jeff Hodges</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.paypal.com/">PayPal</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Akshay Kumar" href="/cdn-cgi/l/email-protection#2c4d475f444d5547596c41454f5e435f434a58024f4341">Akshay Kumar</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.microsoft.com">Microsoft</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Christiaan Brand" href="/cdn-cgi/l/email-protection#caa9a8b8aba4ae8aada5a5ada6afe4a9a5a7">Christiaan Brand</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.google.com">Google</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Johan Verrept" href="/cdn-cgi/l/email-protection#b7ddd8dfd6d999c1d2c5c5d2c7c3f7c1d6c4d4d899d4d8da">Johan Verrept</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="http://www.vasco.com">VASCO Data Security</a></span>
</dd>
<dd class="p-author h-card vcard" rel="bibo:editor" inlist=""><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Jakob Ehrensvärd" href="/cdn-cgi/l/email-protection#3f555e54505d7f464a5d565c50115c5052">Jakob Ehrensvärd</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.yubico.com/">Yubico</a></span>
</dd>

    
      <dt>Contributors:</dt>
      <dd class="p-author h-card vcard" rel="dcterms:contributor"><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Mirko J. Ploch" href="/cdn-cgi/l/email-protection#d1bcb8a3babeffa1bdbeb2b991a2a4a3b4a1b0a2a2b8b5ffb2bebc">Mirko J. Ploch</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.surepassid.com/">SurePassID</a></span>
</dd>
<dd class="p-author h-card vcard" rel="dcterms:contributor"><span typeof="foaf:Person"><a class="u-url url p-name fn" rel="foaf:homepage" property="foaf:name" content="Matthieu Antoine" href="/cdn-cgi/l/email-protection#315c504545595854441f505f455e585f547156545c505d455e1f525e5c">Matthieu Antoine</a>, <a rel="foaf:workplaceHomepage" class="p-org org h-org h-card" href="https://www.gemalto.com/">Gemalto</a></span>
</dd>

    
    
  </dl>
  
  
  
  
    
      <p class="copyright">
        Copyright ©
        2013-2017
        
        <a href="https://www.fidoalliance.org/"><abbr title="FIDO Alliance">FIDO Alliance</abbr></a>
        All Rights Reserved.
      </p>
    
  
  <hr>
</div>
  <!-- only put content here if you want a custom status of document not
       the specification-maturity-appropriate boilerplate -->
  


  <section id="abstract" class="introductory" property="dcterms:abstract" datatype="" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter"><h2 aria-level="1" role="heading" id="h2_abstract">Abstract</h2>
    <p>
      This specification describes an application layer protocol for
      communication between an external authenticator and another
      client/platform, as well as bindings of this application protocol to a
      variety of transport protocols using different physical media. The
      application layer protocol defines requirements for such transport
      protocols. Each transport binding defines the details of how such
      transport layer connections should be set up, in a manner that meets the
      requirements of the application layer protocol.
    </p>
  </section><section id="sotd" class="introductory" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter"><h2 aria-level="1" role="heading" id="h2_sotd">Status of This Document</h2>
  
    
      
        <p>
          <em>This section describes the status of this document at the time of its publication.
          Other documents may supersede this document. A list of current <abbr title="FIDO Alliance">FIDO Alliance</abbr> publications and the
          latest revision of this technical report can be found in the <a href="https://www.fidoalliance.org/specifications/"><abbr title="FIDO Alliance">FIDO Alliance</abbr> specifications index</a> at
          https://www.fidoalliance.org/specifications/.</em>
        </p>
        
        <p>
          This document was published by the <a href="https://fidoalliance.org/"><abbr title="FIDO Alliance">FIDO Alliance</abbr></a> as a Review Draft.
          
            This document is intended to become a <abbr title="FIDO Alliance">FIDO Alliance</abbr> Proposed Standard.
          
          
            If you wish to make comments regarding this document, please 
            <a href="https://fidoalliance.org/contact">Contact Us</a>.
          
          
          
          
            All comments are welcome.
          
        </p>
        
	
	
	  <div class="ribbon-wrapper"><div class="ribbon">REVIEW DRAFT</div></div>
	  <p>
	    <strong>This is a Review Draft Specification and
            is not intended to be a basis for any implementations as the Specification may change.</strong> Permission is
            hereby granted to use the Specification solely for the purpose of reviewing the Specification. No rights
            are granted to prepare derivative works of this Specification. Entities seeking permission to reproduce
            portions of this Specification for other uses must contact the <abbr title="FIDO Alliance">FIDO Alliance</abbr> to determine whether an 
            appropriate license for such use is available.
	  </p>
	
	
        
          <p>
	    Implementation of certain elements of this Specification may require licenses under third party intellectual 
	    property rights, including without limitation, patent rights. The <abbr title="FIDO Alliance">FIDO Alliance</abbr>, Inc. and its Members
            and any other contributors to the Specification are not, and shall not be held, responsible in any manner
            for identifying or failing to identify any or all such third party intellectual property rights.
	  </p>
	  <p>
	    THIS FIDO ALLIANCE SPECIFICATION IS PROVIDED “AS IS” AND WITHOUT ANY 
            WARRANTY OF ANY KIND, INCLUDING, WITHOUT LIMITATION, ANY EXPRESS OR IMPLIED
	    WARRANTY OF NON-INFRINGEMENT, MERCHANTABILITY OR FITNESS FOR A
	    PARTICULAR PURPOSE.
          </p>
        
        
        
        
      
    
  
</section><section id="toc"><h2 class="introductory" aria-level="1" role="heading" id="h2_toc">Table of Contents</h2><ul class="toc" role="directory" id="respecContents"><li class="tocline"><a href="#overview" class="tocxref"><span class="secno">1. </span>Overview</a></li><li class="tocline"><a href="#conformance" class="tocxref"><span class="secno">2. </span>Conformance</a></li><li class="tocline"><a href="#protocol-structure" class="tocxref"><span class="secno">3. </span>Protocol Structure</a></li><li class="tocline"><a href="#CTAP2ProtocolOverview" class="tocxref"><span class="secno">4. </span>Protocol Overview</a></li><li class="tocline"><a href="#authenticator-api" class="tocxref"><span class="secno">5. </span>Authenticator API</a><ul class="toc"><li class="tocline"><a href="#authenticatorMakeCredential" class="tocxref"><span class="secno">5.1 </span>authenticatorMakeCredential(0x01)</a></li><li class="tocline"><a href="#authenticatorGetAssertion" class="tocxref"><span class="secno">5.2 </span>authenticatorGetAssertion(0x02)</a></li><li class="tocline"><a href="#authenticatorgetnextassertion-0x08" class="tocxref"><span class="secno">5.3 </span>authenticatorGetNextAssertion(0x08)</a></li><li class="tocline"><a href="#authenticatorcancel-0x03" class="tocxref"><span class="secno">5.4 </span>authenticatorCancel(0x03)</a></li><li class="tocline"><a href="#authenticatorgetinfo-0x04" class="tocxref"><span class="secno">5.5 </span>authenticatorGetInfo(0x04)</a></li><li class="tocline"><a href="#authenticatorClientPIN" class="tocxref"><span class="secno">5.6 </span>authenticatorClientPIN(0x06)</a><ul class="toc"><li class="tocline"><a href="#client-pin-support-requirements" class="tocxref"><span class="secno">5.6.1 </span>Client PIN support requirements</a></li><li class="tocline"><a href="#authenticator-configuration-operations-upon-power-up" class="tocxref"><span class="secno">5.6.2 </span>Authenticator Configuration Operations Upon Power Up</a></li><li class="tocline"><a href="#gettingSharedSecret" class="tocxref"><span class="secno">5.6.3 </span>Getting sharedSecret from Authenticator</a></li><li class="tocline"><a href="#settingNewPin" class="tocxref"><span class="secno">5.6.4 </span>Setting a New PIN</a></li><li class="tocline"><a href="#changingExistingPin" class="tocxref"><span class="secno">5.6.5 </span>Changing existing PIN</a></li><li class="tocline"><a href="#gettingPinToken" class="tocxref"><span class="secno">5.6.6 </span>Getting pinToken from the Authenticator</a></li><li class="tocline"><a href="#usingPinToken" class="tocxref"><span class="secno">5.6.7 </span>Using pinToken</a><ul class="toc"><li class="tocline"><a href="#using-pintoken-in-authenticatormakecredential" class="tocxref"><span class="secno">5.6.7.1 </span>Using pinToken in <span class="formerLink"> authenticatorMakeCredential</span></a></li><li class="tocline"><a href="#using-pintoken-in-authenticatorgetassertion" class="tocxref"><span class="secno">5.6.7.2 </span>Using pinToken in <span class="formerLink">authenticatorGetAssertion</span></a></li><li class="tocline"><a href="#without-pintoken-in-authenticatorgetassertion" class="tocxref"><span class="secno">5.6.7.3 </span>Without pinToken in <span class="formerLink">authenticatorGetAssertion</span></a></li></ul></li></ul></li><li class="tocline"><a href="#authenticatorReset" class="tocxref"><span class="secno">5.7 </span>authenticatorReset(0x07)</a></li></ul></li><li class="tocline"><a href="#message-encoding" class="tocxref"><span class="secno">6. </span>Message encoding</a><ul class="toc"><li class="tocline"><a href="#commands" class="tocxref"><span class="secno">6.1 </span>Commands</a></li><li class="tocline"><a href="#responses" class="tocxref"><span class="secno">6.2 </span>Responses</a></li><li class="tocline"><a href="#error-responses" class="tocxref"><span class="secno">6.3 </span>Error Responses</a></li></ul></li><li class="tocline"><a href="#interoperating-with-ctap1-u2f-authenticators" class="tocxref"><span class="secno">7. </span>Interoperating with CTAP1/U2F authenticators</a><ul class="toc"><li class="tocline"><a href="#using-the-ctap2-authenticatormakecredential-command-with-ctap1-u2f-authenticators" class="tocxref"><span class="secno">7.1 </span>Using the CTAP2 authenticatorMakeCredential Command with CTAP1/U2F authenticators</a></li><li class="tocline"><a href="#using-the-ctap2-authenticatorgetassertion-command-with-ctap1-u2f-authenticators" class="tocxref"><span class="secno">7.2 </span>Using the CTAP2 authenticatorGetAssertion Command with CTAP1/U2F authenticators</a></li></ul></li><li class="tocline"><a href="#transport-specific-bindings" class="tocxref"><span class="secno">8. </span>Transport-specific Bindings</a><ul class="toc"><li class="tocline"><a href="#usb" class="tocxref"><span class="secno">8.1 </span>USB</a><ul class="toc"><li class="tocline"><a href="#design-rationale" class="tocxref"><span class="secno">8.1.1 </span>Design rationale</a></li><li class="tocline"><a href="#protocol-structure-and-data-framing" class="tocxref"><span class="secno">8.1.2 </span>Protocol structure and data framing
        </a></li><li class="tocline"><a href="#concurrency-and-channels" class="tocxref"><span class="secno">8.1.3 </span>Concurrency and channels
        </a></li><li class="tocline"><a href="#message-and-packet-structure" class="tocxref"><span class="secno">8.1.4 </span>Message and packet structure
      </a></li><li class="tocline"><a href="#arbitration" class="tocxref"><span class="secno">8.1.5 </span>Arbitration
        </a><ul class="toc"><li class="tocline"><a href="#transaction-atomicity-idle-and-busy-states.x" class="tocxref"><span class="secno">8.1.5.1 </span>Transaction atomicity, idle and busy states.</a></li><li class="tocline"><a href="#transaction-timeout" class="tocxref"><span class="secno">8.1.5.2 </span>Transaction timeout</a></li><li class="tocline"><a href="#transaction-abort-and-re-synchronization" class="tocxref"><span class="secno">8.1.5.3 </span>Transaction abort and re-synchronization</a></li><li class="tocline"><a href="#packet-sequencing" class="tocxref"><span class="secno">8.1.5.4 </span>Packet sequencing</a></li></ul></li><li class="tocline"><a href="#channel-locking" class="tocxref"><span class="secno">8.1.6 </span>Channel locking</a></li><li class="tocline"><a href="#protocol-version-and-compatibility" class="tocxref"><span class="secno">8.1.7 </span>Protocol version and compatibility
          </a></li><li class="tocline"><a href="#hid-device-implementation" class="tocxref"><span class="secno">8.1.8 </span>HID device implementation</a><ul class="toc"><li class="tocline"><a href="#interface-and-endpoint-descriptors" class="tocxref"><span class="secno">8.1.8.1 </span>Interface and endpoint descriptors
          </a></li><li class="tocline"><a href="#hid-report-descriptor-and-device-discovery" class="tocxref"><span class="secno">8.1.8.2 </span>HID report descriptor and device discovery
          </a></li></ul></li><li class="tocline"><a href="#ctaphid-commands" class="tocxref"><span class="secno">8.1.9 </span>CTAPHID commands
        </a><ul class="toc"><li class="tocline"><a href="#mandatory-commands" class="tocxref"><span class="secno">8.1.9.1 </span>Mandatory commands
          </a><ul class="toc"><li class="tocline"><a href="#ctaphid_msg-0x03" class="tocxref"><span class="secno">8.1.9.1.1 </span>CTAPHID_MSG (0x03)</a></li><li class="tocline"><a href="#ctaphid_cbor-0x10" class="tocxref"><span class="secno">8.1.9.1.2 </span>CTAPHID_CBOR (0x10)</a></li><li class="tocline"><a href="#ctaphid_init-0x06" class="tocxref"><span class="secno">8.1.9.1.3 </span>CTAPHID_INIT (0x06)</a></li><li class="tocline"><a href="#ctaphid_ping-0x01" class="tocxref"><span class="secno">8.1.9.1.4 </span>CTAPHID_PING (0x01)</a></li><li class="tocline"><a href="#ctaphid_cancel-0x11" class="tocxref"><span class="secno">8.1.9.1.5 </span>CTAPHID_CANCEL (0x11)</a></li><li class="tocline"><a href="#ctaphid_error-0x3f" class="tocxref"><span class="secno">8.1.9.1.6 </span>CTAPHID_ERROR  (0x3F)</a></li><li class="tocline"><a href="#ctaphid_keepalive-0x3b" class="tocxref"><span class="secno">8.1.9.1.7 </span>CTAPHID_KEEPALIVE (0x3B)</a></li></ul></li><li class="tocline"><a href="#optional-commands" class="tocxref"><span class="secno">8.1.9.2 </span>Optional commands
          </a><ul class="toc"><li class="tocline"><a href="#ctaphid_wink-0x08" class="tocxref"><span class="secno">8.1.9.2.1 </span>CTAPHID_WINK (0x08)</a></li><li class="tocline"><a href="#ctaphid_lock-0x04" class="tocxref"><span class="secno">8.1.9.2.2 </span>CTAPHID_LOCK (0x04)</a></li></ul></li><li class="tocline"><a href="#vendor-specific-commands" class="tocxref"><span class="secno">8.1.9.3 </span>Vendor specific commands
          </a></li></ul></li></ul></li><li class="tocline"><a href="#iso7816-iso14443-and-near-field-communication-nfc" class="tocxref"><span class="secno">8.2 </span>ISO7816, ISO14443 and Near Field Communication (NFC)</a><ul class="toc"><li class="tocline"><a href="#conformance-1" class="tocxref"><span class="secno">8.2.1 </span>Conformance</a></li><li class="tocline"><a href="#protocol" class="tocxref"><span class="secno">8.2.2 </span>Protocol</a></li><li class="tocline"><a href="#applet-selection" class="tocxref"><span class="secno">8.2.3 </span>Applet selection</a></li><li class="tocline"><a href="#framing" class="tocxref"><span class="secno">8.2.4 </span>Framing</a><ul class="toc"><li class="tocline"><a href="#commands-1" class="tocxref"><span class="secno">8.2.4.1 </span>Commands</a></li><li class="tocline"><a href="#response" class="tocxref"><span class="secno">8.2.4.2 </span>Response</a></li></ul></li><li class="tocline"><a href="#fragmentation" class="tocxref"><span class="secno">8.2.5 </span>Fragmentation</a></li><li class="tocline"><a href="#commands-2" class="tocxref"><span class="secno">8.2.6 </span>Commands</a><ul class="toc"><li class="tocline"><a href="#nfcctap_msg-0x10" class="tocxref"><span class="secno">8.2.6.1 </span>NFCCTAP_MSG (0x10)</a></li></ul></li><li class="tocline"><a href="#bluetooth-smart-bluetooth-low-energy-technology" class="tocxref"><span class="secno">8.2.7 </span>Bluetooth Smart / Bluetooth Low Energy Technology</a><ul class="toc"><li class="tocline"><a href="#conformance-2" class="tocxref"><span class="secno">8.2.7.1 </span>Conformance</a></li><li class="tocline"><a href="#pairing" class="tocxref"><span class="secno">8.2.7.2 </span>Pairing</a></li><li class="tocline"><a href="#link-security" class="tocxref"><span class="secno">8.2.7.3 </span>Link Security</a></li><li class="tocline"><a href="#framing-1" class="tocxref"><span class="secno">8.2.7.4 </span>Framing</a><ul class="toc"><li class="tocline"><a href="#request-from-client-to-authenticator" class="tocxref"><span class="secno">8.2.7.4.1 </span>Request from Client to Authenticator</a></li><li class="tocline"><a href="#response-from-authenticator-to-client" class="tocxref"><span class="secno">8.2.7.4.2 </span>Response from Authenticator to Client</a></li><li class="tocline"><a href="#command-status-and-error-constants" class="tocxref"><span class="secno">8.2.7.4.3 </span>Command, Status, and Error constants</a></li></ul></li><li class="tocline"><a href="#gatt-service-description" class="tocxref"><span class="secno">8.2.7.5 </span>GATT Service Description</a><ul class="toc"><li class="tocline"><a href="#fido-service" class="tocxref"><span class="secno">8.2.7.5.1 </span>FIDO Service</a></li><li class="tocline"><a href="#device-information-service" class="tocxref"><span class="secno">8.2.7.5.2 </span>Device Information Service</a></li><li class="tocline"><a href="#generic-access-profile-service" class="tocxref"><span class="secno">8.2.7.5.3 </span>Generic Access Profile Service</a></li></ul></li><li class="tocline"><a href="#protocol-overview" class="tocxref"><span class="secno">8.2.7.6 </span>Protocol Overview</a></li><li class="tocline"><a href="#authenticator-advertising-format" class="tocxref"><span class="secno">8.2.7.7 </span>Authenticator Advertising Format</a></li><li class="tocline"><a href="#requests" class="tocxref"><span class="secno">8.2.7.8 </span>Requests</a></li><li class="tocline"><a href="#responses-1" class="tocxref"><span class="secno">8.2.7.9 </span>Responses</a></li><li class="tocline"><a href="#framing-fragmentation" class="tocxref"><span class="secno">8.2.7.10 </span>Framing fragmentation</a></li><li class="tocline"><a href="#notifications" class="tocxref"><span class="secno">8.2.7.11 </span>Notifications</a></li><li class="tocline"><a href="#implementation-considerations" class="tocxref"><span class="secno">8.2.7.12 </span>Implementation Considerations</a><ul class="toc"><li class="tocline"><a href="#bluetooth-pairing-client-considerations" class="tocxref"><span class="secno">8.2.7.12.1 </span>Bluetooth pairing: Client considerations</a></li><li class="tocline"><a href="#bluetooth-pairing-authenticator-considerations" class="tocxref"><span class="secno">8.2.7.12.2 </span>Bluetooth pairing: Authenticator considerations</a></li></ul></li><li class="tocline"><a href="#handling-command-completion" class="tocxref"><span class="secno">8.2.7.13 </span>Handling command completion</a></li><li class="tocline"><a href="#data-throughput" class="tocxref"><span class="secno">8.2.7.14 </span>Data throughput</a></li><li class="tocline"><a href="#advertising" class="tocxref"><span class="secno">8.2.7.15 </span>Advertising</a></li><li class="tocline"><a href="#authenticator-address-type" class="tocxref"><span class="secno">8.2.7.16 </span>Authenticator Address Type</a></li></ul></li></ul></li></ul></li><li class="tocline"><a href="#bibliography" class="tocxref"><span class="secno">9. </span>Bibliography</a></li><li class="tocline"><a href="#references" class="tocxref"><span class="secno">A. </span>References</a><ul class="toc"><li class="tocline"><a href="#normative-references" class="tocxref"><span class="secno">A.1 </span>Normative references</a></li><li class="tocline"><a href="#informative-references" class="tocxref"><span class="secno">A.2 </span>Informative references</a></li></ul></li></ul></section>


  <section class="informative" id="overview">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_overview"><span class="secno">1. </span>Overview</h2><p><em>This section is non-normative.</em></p>
    <p>
      This protocol is intended to be used in scenarios where a user interacts
      with a relying party (a website or native app) on some platform (e.g., a
      PC) which prompts the user to interact with an external authenticator
      (e.g., a smartphone).
    </p>
    <p>
      In order to provide evidence of user interaction, an external
      authenticator implementing this protocol is expected to have a mechanism
      to obtain a user gesture.  Possible examples of user gestures include: as
      a consent button, password, a PIN, a biometric or a combination of these.
    </p>
    <p>
      Prior to executing this protocol, the client/platform (referred to as
      <em>host</em> hereafter) and external authenticator (referred to as
      <em>authenticator</em> hereafter) must establish a confidential and
      mutually authenticated data transport channel. This specification does
      not specify the details of how such a channel is established, nor how
      transport layer security must be achieved.
    </p>
  </section>

  <section id="conformance" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter"><!--OddPage--><h2 aria-level="1" role="heading" id="h2_conformance"><span class="secno">2. </span>Conformance</h2>
<p>
  As well as sections marked as non-normative, all authoring guidelines, diagrams, examples,
  and notes in this specification are non-normative. Everything else in this specification is
  normative.
</p>
<p>
  The key words <em class="rfc2119" title="MUST">MUST</em>, <em class="rfc2119" title="MUST NOT">MUST NOT</em>, <em class="rfc2119" title="REQUIRED">REQUIRED</em>, <em class="rfc2119" title="SHOULD">SHOULD</em>, <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em>, <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em>, <em class="rfc2119" title="MAY">MAY</em>,
  and <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> in this specification are to be interpreted as described in [<cite><a class="bibref" href="#bib-RFC2119">RFC2119</a></cite>].
</p>
</section>


  <section class="informative" id="protocol-structure">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_protocol-structure"><span class="secno">3. </span>Protocol Structure</h2><p><em>This section is non-normative.</em></p>
    <p>
      This protocol is specified in three parts:
    </p>
      <ul>
        <li><strong>Authenticator API</strong>: At this level of abstraction,
          each authenticator operation is defined similarly to an API call - it
          accepts input parameters and returns either an output or error code.
          Note that this API level is conceptual and does not represent actual
          APIs.  The actual APIs will be provided by each implementing
          platform.
        </li><li><strong>Message Encoding</strong>: In order to invoke a method in the
          authenticator API, the host must construct and encode a request and
          send it to the authenticator over the chosen transport protocol. The
          authenticator will then process the request and return an encoded
          response.
        </li><li><strong>Transport-specific Binding</strong>: Requests and responses
          are conveyed to external authenticators over specific transports
          (e.g., USB, NFC, Bluetooth).  For each transport technology, message
          bindings are specified for this protocol.
      </li></ul>
    <p>
      This document specifies all three of the above pieces for external FIDO
      2.0 authenticators.
    </p>
  </section>

  <section class="informative" id="CTAP2ProtocolOverview" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_CTAP2ProtocolOverview"><span class="secno">4. </span>Protocol Overview</h2><p><em>This section is non-normative.</em></p>
    <p>
      The general protocol between a platform and an authenticator is as follows:
    </p>
    <ol>
      <li>Platform establishes the connection with the authenticator.</li>
      <li>
        Platform gets information about the authenticator using authenticatorGetInfo command
        which helps it determine the capabilities of the authenticator.</li>
      <li>Platform sends a command for an operation if the authenticator is capable of supporting it.</li>
      <li>Authenticator replies with response data or error.</li>
    </ol>
  </section>

  <section id="authenticator-api">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_authenticator-api"><span class="secno">5. </span>Authenticator API</h2>
    <p>
      Each operation in the authenticator API can be performed independently of
      the others, and all operations are asynchronous. The authenticator may
      enforce a limit on outstanding operations to limit resource usage - in
      this case, the authenticator is expected to return a busy status and the
      host is expected to retry the operation later. Additionally, this
      protocol does not enforce in-order or reliable delivery of requests and
      responses; if these properties are desired, they must be provided by the
      underlying transport protocol or implemented at a higher layer by
      applications.
    </p>
    <p>
      Note that this API level is conceptual and does not represent actual
      APIs.  The actual APIs will be provided by each implementing platform.
    </p>
    <p>
      The authenticator API has the following methods and data structures.
    </p>

    <section id="authenticatorMakeCredential" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
      <h3 aria-level="2" role="heading" id="h3_authenticatorMakeCredential"><span class="secno">5.1 </span>authenticatorMakeCredential(0x01)</h3>
      <p>
        This method is invoked by the host to request generation of a new
        credential in the authenticator. It takes the following input
        parameters, which explicitly correspond to those defined in
	<a href="https://www.w3.org/TR/webauthn/#op-make-cred">The authenticatorMakeCredential operation</a>
	section of the Web Authentication specification:
      </p>
      <table class="simple">
        <tbody><tr>
          <th>Parameter name</th>
          <th>Data type</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>clientDataHash</td>
          <td>Byte Array</td>
          <td>Required</td>
          <td>Hash of the ClientData contextual binding specified by host.  See
            [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].</td>
        </tr>
        <tr>
          <td>rp</td>
          <td>PublicKeyCredentialRpEntity</td>
          <td>Required</td>
          <td>This PublicKeyCredentialRpEntity data structure describes a Relying Party with which the new
	    <a href="https://www.w3.org/TR/webauthn/#public-key-credential">public key credential</a> will be associated.
	    It contains the <a href="https://www.w3.org/TR/webauthn/#relying-party-identifier">Relying party identifier</a>,
	    (optionally) a human-friendly RP name, and (optionally) a serialized URL pointing to a RP icon image.
	    The RP name is to be used by the authenticator when displaying the credential to the user
	    for selection and usage authorization.</td>
        </tr>
        <tr>
          <td>user</td>
          <td>PublicKeyCredentialUserEntity</td>
          <td>Required</td>
          <td>This PublicKeyCredentialUserEntity data structure describes the user account to which the new
	    <a href="https://www.w3.org/TR/webauthn/#public-key-credential">public key credential</a>
	    will be associated at the RP.
	    It contains an RP-specific user account identifier, (optionally) a user name, (optionally) a user display name,
	    and (optionally) a URL pointing to an image (of a user avatar, for example).
	    The authenticator associates the created public key credential with the account identifier,
	    and <em class="rfc2119" title="MAY">MAY</em> also associate any or all of the user name, user display name,
	    and image data (pointed to by the URL, if any).</td>
        </tr>
        <tr>
          <td>pubKeyCredParams</td>
          <td>CBOR Array</td>
          <td>Required</td>
          <td>A sequence of CBOR maps consisting of pairs of PublicKeyCredentialType (a string) and cryptographic algorithm (a positive or negative integer),
            where algorithm identifiers are values that <em class="rfc2119" title="SHOULD">SHOULD</em> be registered in the IANA COSE Algorithms registry [<a href="#IANA-COSE-ALGS-REG">IANA-COSE-ALGS-REG</a>].
            This sequence is ordered from most preferred (by the RP) to least preferred.</td>
        </tr>
        <tr>
          <td>excludeList</td>
          <td>Sequence of PublicKeyCredentialDescriptors</td>
          <td>Optional</td>
          <td>A sequence of PublicKeyCredentialDescriptor structures, as specified in [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].
	    The authenticator returns an error if the authenticator already contains one of the credentials enumerated in this sequence.
	    This allows RPs to limit the creation of multiple credentials for the same account on a single authenticator.</td>
        </tr>
        <tr>
          <td>extensions</td>
          <td>CBOR map of <a href="https://www.w3.org/TR/webauthn/#extension-identifier">extension identifier</a> → <a href="https://www.w3.org/TR/webauthn/#authenticator-extension-input">authenticator extension input</a> values</td>
          <td>Optional</td>
          <td>Parameters to influence authenticator operation, as specified in
            [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].  These parameters might be authenticator specific.</td>
        </tr>
        <tr>
          <td>options</td>
          <td>Sequence of authenticator options</td>
          <td>Optional</td>
          <td>Parameters to influence authenticator operation, as specified in
            in the table below.</td>
        </tr>
        <tr>
          <td><section id="makeCredentialPinAuth" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">pinAuth</section></td>
          <td>Byte Array</td>
          <td>Optional</td>
          <td>
            First 16 bytes of HMAC-SHA-256 of clientDataHash using <a href="#pinToken">pinToken</a> which
            <a href="#gettingPinToken">platform got from the authenticator</a>:
            <code>HMAC-SHA-256(pinToken, clientDataHash)</code>.
          </td>
        </tr>
        <tr>
          <td>pinProtocol</td>
          <td>Unsigned Integer</td>
          <td>Optional</td>
          <td>PIN protocol version chosen by the Client</td>
        </tr>
      </tbody></table>
      <p>
        The following values are defined for use in the options parameter. All
        options are booleans.
      </p>
      <table class="simple">
        <tbody><tr>
          <th>Key</th>
          <th>Default value</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>rk</td>
          <td>false</td>
          <td>resident key: Instructs the authenticator to store the key material on the
            device.</td>
        </tr>
          <tr>
            <td>uv</td>
            <td>false</td>
            <td>user verification: Instructs the authenticator to require a gesture that verifies the user
              to complete the request. Examples of such gestures are fingerprint
              scan or a PIN.
            </td>
          </tr>
      </tbody></table>
      <p>
        When such a request is received, the authenticator performs the
        following procedure:
      </p>
      <ol>
        <li>
          If the excludeList parameter is present and contains a credential ID
          that is present on this authenticator, terminate this procedure and
          return error code CTAP2_ERR_CREDENTIAL_EXCLUDED.
        </li>
        <li>
          If the pubKeyCredParams parameter does not contain a valid
          COSEAlgorithmIdentifier value that is supported by the authenticator,
          terminate this procedure and return error code
          CTAP2_ERR_UNSUPPORTED_ALGORITHM.
        </li>
        <li>
          If the options parameter is present, process all options and if any
          of the requested options can't be satisfied, terminate this procedure
          and return the CTAP2_ERR_OPTION_NOT_SUPPORTED error.
        </li>
        <li>
          Optionally, if the extensions parameter is present, process any
          extensions that this authenticator supports.
          <a href="https://www.w3.org/TR/webauthn/#authenticator-extension-output">Authenticator extension outputs</a> generated by the authenticator extension processing
          are returned in the <a href="https://www.w3.org/TR/webauthn/#sec-authenticator-data">authenticator data</a>.
        </li>
        <li>
          If <a href="#makeCredentialPinAuth">pinAuth</a> parameter is present and pinProtocol is 1, verify it by matching it against first 16 bytes of
          HMAC-SHA-256 of clientDataHash parameter using
          <a href="#pinToken">pinToken</a>: <code>HMAC-SHA-256(pinToken, clientDataHash)</code>.
          <ul>
            <li>If the verification succeeds, set the "uv" bit to 1 in the response.</li>
            <li>If the verification fails, return CTAP2_ERR_PIN_AUTH_INVALID error.</li>
          </ul>
          If <a href="#makeCredentialPinAuth">pinAuth</a> parameter is not present and <a href="#getInfoClientPin">clientPin</a>
          been set on the authenticator, return CTAP2_ERR_PIN_REQUIRED error.
        </li>
        <li>
          If the authenticator has a display, show the items contained within the user and rp parameter structures
          to the user. Alternatively, request user interaction in an authenticator-specific way (e.g., flash the LED light).
          Request permission to create a credential. If the user declines permission,
          return the CTAP2_ERR_OPERATION_DENIED error.
        </li>
        <li>
          Generate a new <a href="https://www.w3.org/TR/webauthn/#credential-key-pair">credential key pair</a> for the algorithm specified.
        </li>
        <li>
          If "rk" in options parameter is set to true:
          <ul>
            <li>
              If a credential for the same RP ID and account ID already exists on the authenticator,
              overwrite that credential.
            </li>
            <li>
              Store the user parameter along the newly-created key pair.
            </li>
            <li>
              If authenticator does not have enough internal storage to persist the new credential,
              return CTAP2_ERR_KEY_STORE_FULL.
            </li>
          </ul>
        </li>
        <li>
          Generate an attestation statement for the newly-created key using
          clientDataHash.
        </li>
      </ol>

      <p>
        On success, the authenticator returns an <a href="https://www.w3.org/TR/webauthn/#attestation-objects">attestation object</a> in
        its response as defined in [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>]:
      </p>
      <table class="simple">
        <tbody><tr>
          <th>Member name</th>
          <th>Data type</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>authData</td>
          <td>Sequence of bytes</td>
          <td>Required</td>
          <td>The <a href="https://www.w3.org/TR/webauthn/#authenticator-data">authenticator data</a> object.</td>
        </tr>
        <tr>
          <td>fmt</td>
          <td>String</td>
          <td>Required</td>
          <td>The <a href="https://www.w3.org/TR/webauthn/#attestation-statement-format">attestation statement format identifier</a>.</td>
        </tr>
        <tr>
          <td>attStmt</td>
          <td>Sequence of bytes, the structure of which depends on the attestation statement format identifier</td>
          <td>Required</td>
          <td>The attestation statement, whose format is identified by the
	    "fmt" object member. The client treats it as an opaque object.</td>
        </tr>
      </tbody></table>
    </section>


    <section id="authenticatorGetAssertion" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
      <h3 aria-level="2" role="heading" id="h3_authenticatorGetAssertion"><span class="secno">5.2 </span>authenticatorGetAssertion(0x02)</h3>
      <p>This method is used by a host to request cryptographic proof of user
        authentication as well as user consent to a given transaction, using a
        previously generated credential that is bound to the authenticator and relying party identifier.
        It takes the following input parameters, which explicitly correspond to those defined in
	<a href="https://www.w3.org/TR/webauthn/#op-get-assertion">The authenticatorGetAssertion operation</a>
	section of the Web Authentication specification:
      </p>
      <table class="simple">
        <tbody><tr>
          <th>Parameter name</th>
          <th>Data type</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>rpId</td>
          <td>String</td>
          <td>Required</td>
          <td><a href="https://www.w3.org/TR/webauthn/#relying-party-identifier">Relying party identifier</a>. See [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].</td>
        </tr>
        <tr>
          <td>clientDataHash</td>
          <td>Byte Array</td>
          <td>Required</td>
          <td><a href="https://www.w3.org/TR/webauthn/#collectedclientdata-hash-of-the-serialized-client-data">Hash of the serialized client data</a>
	    collected by the host.  See [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].</td>
        </tr>
        <tr>
          <td>allowList</td>
          <td>Sequence of PublicKeyCredentialDescriptors</td>
          <td>Optional</td>
          <td>A sequence of PublicKeyCredentialDescriptor structures, each denoting a credential, as specified
            in [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].  The authenticator is requested to only generate
            an assertion using one of the denoted credentials.</td>
        </tr>
        <tr>
          <td>extensions</td>
          <td>CBOR map of <a href="https://www.w3.org/TR/webauthn/#extension-identifier">extension identifier</a> → <a href="https://www.w3.org/TR/webauthn/#authenticator-extension-input">authenticator extension input</a> values</td>
          <td>Optional</td>
          <td>Parameters to influence authenticator operation. These parameters
            might be authenticator specific.</td>
        </tr>
        <tr>
          <td>options</td>
          <td>Sequence of authenticator options</td>
          <td>Optional</td>
          <td>Parameters to influence authenticator operation, as specified in
            the table below.</td>
        </tr>
        <tr>
          <td><section id="getAssertionPinAuth" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">pinAuth</section></td>
          <td>Byte Array</td>
          <td>Optional</td>
          <td>
            First 16 bytes of HMAC-SHA-256 of clientDataHash using <a href="#pinToken">pinToken</a> which
            <a href="#gettingPinToken">platform got from the authenticator</a>:
            <code>HMAC-SHA-256(pinToken, clientDataHash)</code>.
          </td>
        </tr>
        <tr>
          <td>pinProtocol</td>
          <td>Unsigned Integer</td>
          <td>Optional</td>
          <td>PIN protocol version selected by Client.</td>
        </tr>
      </tbody></table>
      <p>
        The following values are defined for use in the options parameter. All
        options are booleans.
      </p>
      <table class="simple">
        <tbody><tr>
          </tr><tr>
            <th>Key</th>
            <th>Default value</th>
            <th>Definition</th>
          </tr>
          <tr>
            <td>up</td>
            <td>true</td>
            <td>user presence: Instructs the authenticator to require user consent to complete
              the operation.</td>
          </tr>
          <tr>
            <td>uv</td>
            <td>false</td>
            <td>user verification: Instructs the authenticator to require a gesture that verifies the user
              to complete the request. Examples of such gestures are fingerprint
              scan or a PIN.
            </td>
          </tr>
        
      </tbody></table>
      <p>When such a request is received, the authenticator performs the
        following procedure:
      </p>
      <ol>
        <li>
          Locate all credentials that are eligible for retrieval under
          the specified criteria:
          <ul>
            <li>If an allowList is present and is non-empty, locate all
              denoted credentials present on this authenticator and bound to the specified
              rpId.</li>
            <li>If an allowList is not present, locate all credentials that are
              present on this authenticator and bound to the specified
              rpId.</li>
          </ul>
        </li>
        <li>
          If <a href="#getAssertionPinAuth">pinAuth</a> parameter is present and pinProtocol is 1, verify it by matching it against
          first 16 bytes of HMAC-SHA-256 of clientDataHash parameter using
          <a href="#pinToken">pinToken</a>: <code>HMAC-SHA-256(pinToken, clientDataHash)</code>.
          <ul>
            <li>If the verification succeeds, set the "uv" bit to 1 in the response.</li>
            <li>If the verification fails, return CTAP2_ERR_PIN_AUTH_INVALID error.</li>
          </ul>
          If <a href="#getAssertionPinAuth">pinAuth</a> parameter is not present and <a href="#getInfoClientPin">clientPin</a>
          has been set on the authenticator, set the "uv" bit to 0 in the response.
        </li>
        <li>
          Optionally, if the extensions parameter is present, process any
          extensions that this authenticator supports.
          <a href="https://www.w3.org/TR/webauthn/#authenticator-extension-output">Authenticator extension outputs</a> generated by the authenticator extension processing
          are returned in the <a href="https://www.w3.org/TR/webauthn/#sec-authenticator-data">authenticator data</a>.
        </li>
        <li>
          Collect user consent if required. This step <em class="rfc2119" title="MUST">MUST</em> happen before the following steps due to privacy reasons
          (i.e., authenticator cannot disclose existence of a credential until the user interacted with the device):
          <ul>
            <li>
              If the "uv" option was specified and set to true:
              <ul>
                <li>
                  If device doesn't support user-identifiable gestures, return
                  the CTAP2_ERR_OPTION_NOT_SUPPORTED error.
                </li>
                <li>
                  Collect a user-identifiable gesture. If gesture validation fails,
                  return the CTAP2_ERR_OPERATION_DENIED error.
                </li>
              </ul>
            </li>
            <li>
              If the "up" option was specified and set to true, collect the user's
            consent.
              <ul>
                <li>If no consent is obtained and a timeout occurs, return the CTAP2_ERR_OPERATION_DENIED error.</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>
          If no credentials were located in step 1, return CTAP2_ERR_NO_CREDENTIALS.
        </li>
        <li>
          If only one credential was located in step 1, go to step 9.
        </li>
        <li>
          Order the credentials by the time when they were created.
          The first credential is the most recent credential that was created.
        </li>
        <li>
          If authenticator does not have a display:
          <ul>
            <li>
              Remember the authenticatorGetAssertion parameters.
            </li>
            <li>
              Create a counter and set it to the total number of credentials.
            </li>
            <li>
              Start a timer. This is used during authenticatorGetNextAssertion command.
            </li>
            <li>
              Update the response to include the first credential's publicKeyCredentialUserEntity information and numberOfCredentials.
            </li>
          </ul>
        </li>
        <li>
          If authenticator has a display:
          <ul>
            <li>
              Display all these credentials to the user,
              using their friendly name along with other stored account information.
            </li>
            <li>
              Also, display the rpId of the requester (specified in the request)
              and ask the user to select a credential.
            </li>
            <li>
              If the user declines to select a credential or takes too long (as determined by the authenticator),
              terminate this procedure and return the CTAP2_ERR_OPERATION_DENIED error.
            </li>
          </ul>
        </li>
        <li>Sign the clientDataHash along with authData with the selected credential,
        using the structure specified in [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].
        </li>
      </ol>
      <p>On success, the authenticator returns the following structure in
        its response:
      </p>

      <table class="simple">
        <tbody><tr>
          <th>Member name</th>
          <th>Data type</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>credential</td>
          <td>PublicKeyCredentialDescriptor</td>
          <td>Optional</td>
          <td>PublicKeyCredentialDescriptor structure containing the credential identifier whose private key was used to generate
            the assertion. May be omitted if the allowList has exactly one
            Credential.</td>
        </tr>
        <tr>
          <td>authData</td>
          <td>Byte Array</td>
          <td>Required</td>
          <td>The signed-over contextual bindings made by the authenticator, as specified in
            [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].</td>
        </tr>
        <tr>
          <td>signature</td>
          <td>Byte Array</td>
          <td>Required</td>
          <td>The <a href="https://www.w3.org/TR/webauthn/#assertion-signature">assertion signature</a> produced by the authenticator, as specified in
            [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].</td>
        </tr>
        <tr>
          <td>user</td>
          <td>PublicKeyCredentialUserEntity</td>
          <td>Required</td>
          <td>
            PublicKeyCredentialUserEntity structure containing the user account information.

            For single account per RP case, authenticator returns "id" field to the platform
            which will be returned to the [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>] layer.

            For multiple accounts per RP case, where the authenticator does not have a display,
            authenticator returns "id" as well as other fields to the platform.
            Platform will use this information to show the account selection UX to the user and
            for the user selected account, it will ONLY return "id" back to the [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>]
            layer and discard other user details.
          </td>
        </tr>
        <tr>
          <td>numberOfCredentials</td>
          <td>Integer</td>
          <td>Optional</td>
          <td>
            Total number of account credentials for the RP.
            This member is required when more than one account for the RP and the authenticator does not have a display.
            Omitted when returned for the authenticatorGetNextAssertion method.
          </td>
        </tr>
        </tbody></table>
    </section>
    <section id="authenticatorgetnextassertion-0x08">
      <h3 aria-level="2" role="heading" id="h3_authenticatorgetnextassertion-0x08"><span class="secno">5.3 </span>authenticatorGetNextAssertion(0x08)</h3>
      <p>
        The client calls this method when the authenticatorGetAssertion response contains the numberOfCredentials member and
        the number of credentials exceeds 1.
        This method is used to obtain the next per-credential signature for a given authenticatorGetAssertion request.
      </p>
      <p>
        This method takes no arguments as it is always follows a call to
        authenticatorGetAssertion or authenticatorGetNextAssertion.
      </p>
      <p>
        When such a request is received, the authenticator performs the following procedure:
        </p><ol>
          <li>
            If authenticator does not remember any authenticatorGetAssertion parameters, return CTAP2_ERR_NOT_ALLOWED.
          </li>
          <li>
            If the credential counter is 0, return CTAP2_ERR_NOT_ALLOWED.
          </li>
          <li>
            If timer since the last call to authenticatorGetAssertion/authenticatorGetNextAssertion is greater than 30 seconds,
            discard the current authenticatorGetAssertion state and return CTAP2_ERR_NOT_ALLOWED.
          </li>
          <li>
            Sign the clientDataHash with the credential using credential counter as index
            (e.g., credentials[n] assuming 1-based array), using the structure specified in [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].
          </li>
          <li>
            Reset the timer.
          </li>
          <li>
            Decrement the credential counter.
          </li>
        </ol>
      <p></p>
      <p>
        On success, the authenticator returns the same structure as returned by the authenticatorGetAssertion method.
        The numberOfCredentials member is omitted.
      </p>
      <p>
        </p><h3 id="client-logic">Client Logic</h3>
        If client receives numberOfCredentials member value exceeding 1 in response to the authenticatorGetAssertion call:
        <ol>
          <li>
            Call authenticatorGetNextAssertion numberOfCredentials minus 1 times.
            <ul>
              <li>
                Make sure ‘rp’ member matches the current request.
              </li>
              <li>
                Remember the ‘response’ member.
              </li>
              <li>
                Add credential user information to the ‘credentialInfo’ list.
              </li>
            </ul>
          </li>
          <li>
            Draw a UX that displays credentialInfo list.
          </li>
          <li>
            Let user select which credential to use.
          </li>
          <li>
            Return the value of the ‘response’ member associated with the user choice.
          </li>
          <li>
            Discard all other responses.
          </li>
        </ol>
      <p></p>
    </section>
    <section id="authenticatorcancel-0x03">
      <h3 aria-level="2" role="heading" id="h3_authenticatorcancel-0x03"><span class="secno">5.4 </span>authenticatorCancel(0x03)</h3>
      <p>Using this method, the host can request the authenticator to cancel
        all ongoing operations are return to a ready state. It takes no input
        parameters and returns success or failure.
      </p>
    </section>
    <section id="authenticatorgetinfo-0x04">
      <h3 aria-level="2" role="heading" id="h3_authenticatorgetinfo-0x04"><span class="secno">5.5 </span>authenticatorGetInfo(0x04)</h3>
      <p>Using this method, the host can request that the authenticator report
        a list of all supported protocol versions, supported extensions, AAGUID
        of the device, and its capabilities.  This method takes no
        inputs.</p>
      <p>On success, the authenticator returns:</p>
      <table class="simple">
        <tbody><tr>
          <th>Member name</th>
          <th>Data type</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>versions</td>
          <td>Sequence of strings</td>
          <td>Required</td>
          <td>List of supported versions.</td>
        </tr>
        <tr>
          <td>extensions</td>
          <td>Sequence of strings</td>
          <td>Optional</td>
          <td>List of supported extensions.</td>
        </tr>
        <tr>
          <td>aaguid</td>
          <td>Byte String</td>
          <td>Required</td>
          <td>The claimed AAGUID. 16 bytes in length and encoded the same as MakeCredential AuthenticatorData, as specified in [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].</td>
        </tr>
        <tr>
          <td>options</td>
          <td>Map</td>
          <td>Optional</td>
          <td>List of supported options.</td>
        </tr>
        <tr>
          <td>maxMsgSize</td>
          <td>Unsigned Integer</td>
          <td>Optional</td>
          <td>Maximum message size supported by the authenticator.</td>
        </tr>
        <tr>
          <td>pinProtocols</td>
          <td>Array of Unsigned Integers</td>
          <td>Optional</td>
          <td>List of supported PIN Protocol versions.</td>
        </tr>
      </tbody></table>

      <p>All options are in the form key-value pairs with string IDs and boolean
      values. When an option is not present, the default is applied per table
      below. The following is a list of supported options:</p>
      <table class="simple">
        <tbody><tr>
          <th>Option ID</th>
          <th>Definition</th>
          <th>Default</th>
        </tr>
        <tr>
          <td>plat</td>
          <td>platform device: Indicates that the device is attached to the client and therefore
          can't be removed and used on another client.</td>
          <td>false</td>
        </tr>
        <tr>
          <td>rk</td>
          <td>resident key: Indicates that the device is capable of storing keys on the device
            itself and therefore can satisfy the authenticatorGetAssertion
            request with allowList parameter not specified or empty.</td>
          <td>false</td>
        </tr>
        <tr>
          <td><section id="getInfoClientPin" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">clientPin</section></td>
          <td>
            Client PIN:
            If present and set to true, it indicates that the device is capable of accepting a PIN from the client and PIN has been set.
            If present and set to false, it indicates that the device is capable of accepting a PIN from the client and PIN has not been set yet.
            If absent, it indicates that the device is not capable of accepting a PIN from the client.
          </td>
          <td>Not supported</td>
        </tr>
        <tr>
          <td>up</td>
          <td>user presence: Indicates that the device is capable of testing user presence
            as part of the authenticatorGetAssertion request.</td>
          <td>true</td>
        </tr>
        <tr>
          <td>uv</td>
          <td>user verification: Indicates that the device is capable of verifying the user as part
            of the authenticatorGetAssertion request.</td>
          <td>false</td>
        </tr>
      </tbody></table>

    </section>

    <section id="authenticatorClientPIN" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
      <h3 aria-level="2" role="heading" id="h3_authenticatorClientPIN"><span class="secno">5.6 </span>authenticatorClientPIN(0x06)</h3>
      <p>
        One of the design goals of this command is to have minimum burden on the authenticator and to not send actual encrypted PIN
        to the authenticator in normal authenticator usage scenarios to have more security.
        Hence, below design only sends PIN in encrypted format while setting or changing a PIN.
        On normal PIN usage scenarios, design uses randomized <a href="#gettingPinToken">pinToken</a>
        which gets generated every power cycle.
      </p>
      <p>
        This command is used by the platform to
        <a href="#gettingSharedSecret">establish key agreement with Authenticator and getting sharedSecret</a>,
        <a href="#settingNewPin">setting a new PIN on the Authenticator</a>,
        <a href="#changingExistingPin">changing existing PIN on the Authenticator</a> and 
        <a href="#gettingPinToken">getting "pinToken" from the Authenticator</a> which can be used in subsequent
        <a href="#authenticatorMakeCredential">authenticatorMakeCredential</a> and
        <a href="#authenticatorGetAssertion">authenticatorGetAssertion</a> operations.
      </p>
      <p>
        It takes the following input parameters:
      </p>
      <table class="simple">
        <tbody><tr>
          <th>Parameter name</th>
          <th>Data type</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>pinProtocol</td>
          <td>Integer</td>
          <td>Required</td>
          <td>PIN protocol version chosen by the Client.  For this version of the spec, this <em class="rfc2119" title="SHALL">SHALL</em> be the number 1.</td>
        </tr>
        <tr>
          <td>subCommand</td>
          <td>Integer</td>
          <td>Required</td>
          <td>The authenticator client PIN sub command currently being requested</td>
        </tr>
        <tr>
          <td>keyAgreement</td>
          <td>COSE_KEY</td>
          <td>Optional</td>
          <td>Public key of <a href="#platformKeyAgreementKey">platformKeyAgreementKey</a>.</td>
        </tr>
        <tr>
          <td>pinAuth</td>
          <td>Byte Array</td>
          <td>Optional</td>
          <td>
            First 16 bytes of HMAC-SHA-256 of encrypted contents using <a href="#gettingSharedSecret">sharedSecret</a>.
            See <a href="#settingNewPin">Setting a new PIN</a>, <a href="#changingExistingPin">Changing existing PIN</a> and
            <a href="#gettingPinToken">Getting pinToken from the authenticator</a> for more details.
          </td>
        </tr>
        <tr>
          <td>newPinEnc</td>
          <td>Byte Array</td>
          <td>Optional</td>
          <td>
            Encrypted new PIN using <a href="#gettingSharedSecret">sharedSecret</a>.
            Encryption is done over UTF-8 representation of new PIN.
          </td>
        </tr>
        <tr>
          <td>pinHashEnc</td>
          <td>Byte Array</td>
          <td>Optional</td>
          <td>Encrypted first 16 bytes of SHA-256 of PIN using <a href="#gettingSharedSecret">sharedSecret</a>.</td>
        </tr>
        <tr>
          <td>getKeyAgreement</td>
          <td>Boolean</td>
          <td>Optional</td>
          <td>
            Asks authenticator to return public key of its <a href="#authenticatorKeyAgreementKey">authenticatorKeyAgreementKey</a>
            for <a href="#gettingSharedSecret">getting SharedSecret from the authenticator</a>.
          </td>
        </tr>
        <tr>
          <td>getRetries</td>
          <td>Boolean</td>
          <td>Optional</td>
          <td>Asks authenticator to return number of PIN attempts remaining before lockout.</td>
        </tr>
      </tbody></table>
            
      <p>The list of sub commands for PIN Protocol Version 1 is:</p>
      <table class="simple">
        <tbody><tr>
          <th>Subcommand Name</th>
          <th>Subcommand Number</th>
        </tr>
        <tr>
          <td>Get Retries</td>
          <td>1</td>
        </tr>
        <tr>
          <td>Get Key Agreement</td>
          <td>2</td>
        </tr>
        <tr>
          <td>Set PIN</td>
          <td>3</td>
        </tr>
        <tr>
          <td>Change PIN</td>
          <td>4</td>
        </tr>
        <tr>
          <td>Get PIN token</td>
          <td>5</td>
        </tr>
      </tbody></table>
            

      <p>On success, Authenticator returns the following structure in its response.</p>

      <table class="simple">
        <tbody><tr>
          <th>Parameter name</th>
          <th>Data type</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>KeyAgreement</td>
          <td>COSE_KEY</td>
          <td>Optional</td>
          <td>
            Authenticator key agreement public key in COSE_KEY format. This will be used to
            <a href="#gettingSharedSecret">establish a sharedSecret</a> between platform and the authenticator.
          </td>
        </tr>
        <tr>
          <td><a href="#pinToken">pinToken</a></td>
          <td>Byte Array</td>
          <td>Optional</td>
          <td>
            Encrypted <a href="#pinToken">pinToken</a> using <a href="#gettingSharedSecret">sharedSecret</a>
            to be used in subsequent <a href="#authenticatorMakeCredential">authenticatorMakeCredential</a> and
            <a href="#authenticatorGetAssertion">authenticatorGetAssertion</a> operations.
          </td>
        </tr>
        <tr>
          <td><section id="retries" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">retries</section></td>
          <td>Unsigned Integer</td>
          <td>Optional</td>
          <td>
            Number of PIN attempts remaining before lockout.
            This is optionally used to show in UI when collecting the PIN in <a href="#settingNewPin">Setting a new PIN</a>,
            <a href="#changingExistingPin">Changing existing PIN</a> and 
            <a href="#gettingPinToken">Getting pinToken from the authenticator</a> flows.</td>
        </tr>
      </tbody></table>

      <section id="client-pin-support-requirements">
        <h4 aria-level="3" role="heading" id="h4_client-pin-support-requirements"><span class="secno">5.6.1 </span>Client PIN support requirements</h4>
        <ul>
          <li>
            Platform has to fulfill following PIN support requirements while gathering input from the user:
            <ul>
              <li>Minimum PIN Length: 4 Unicode characters</li>
              <li>Maximum PIN Length: UTF-8 representation must not exceed 255 bytes</li>
            </ul>
          </li>
          <li>
            Authenticator has to fulfill following PIN support requirements:
            <ul>
              <li>Minimum PIN Length: 4 bytes</li>
              <li>Maximum PIN Length: 255 bytes</li>
              <li>
                Maximum incorrect PIN retry count: 8
                <ul>
                  <li>Each correct PIN entry resets <a href="#retries">retries</a> counter.</li>
                  <li>
                    Once the authenticator reaches the maximum incorrect PIN retry count,
                    the <a href="#authenticatorReset">authenticator has to be reset</a> before any further operations with requires PIN.
                  </li>
                </ul>
              </li>
              <li>PIN storage on the device has to be of the same or better security assurances as of private keys on the device.</li>
            </ul>
          </li>
        </ul>
        Note: Authenticators can implement minimum PIN lengths that are longer than 4 characters.
      </section>
     <section id="authenticator-configuration-operations-upon-power-up">
        <h4 aria-level="3" role="heading" id="h4_authenticator-configuration-operations-upon-power-up"><span class="secno">5.6.2 </span>Authenticator Configuration Operations Upon Power Up</h4>
        <p>
          Authenticator generates following configuration at power up.
          This is to have less burden on the Authenticator as key agreement is an expensive operation.
          This also ensures randomness across power cycles.
        </p>
        <p>Following are the operations Authenticator performs on each powerup:</p>
        <ul>
          <li>
            <section id="authenticatorKeyAgreementKey" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
              Generate <strong>"authenticatorKeyAgreementKey"</strong>:
              <ul>
                <li>
                  Generate a ECDH P-256 key pair called "authenticatorKeyAgreementKey" denoted by <code>(a, aG)</code> where
                  <code>"a"</code> denotes the private key and <code>"aG"</code> denotes the public key.
                  <ul>
                    <li>
                      See <a href="https://tools.ietf.org/html/rfc6090#section-4.1">RFC 6090</a> and
                      <a href="#NISTSP800-56A">NIST SP800-56A</a> for more ECDH key agreement protocol details.
                    </li>
                  </ul>
                </li>
              </ul>
            </section>
          </li>
          <li>
            <section id="pinToken" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
              Generate <strong>"pinToken"</strong>:
              <ul>
                <li>Generate a random integer of length which is multiple of 16 bytes (AES block length).</li>
                <li>
                  "pinToken" is used so that there is minimum burden on the authenticator and platform does not
                  have to not send actual encrypted PIN to the authenticator in normal authenticator usage scenarios.
                  This also provides more security as we are not sending actual PIN even in encrypted form.
                  "pinToken" will be given to the platform upon verification of the PIN to be used
                  in subsequent <a href="#authenticatorMakeCredential">authenticatorMakeCredential</a> and
                  <a href="#authenticatorGetAssertion">authenticatorGetAssertion</a> operations.
                </li>
              </ul>
            </section>
          </li>
        </ul>
      </section>

      <section id="gettingSharedSecret" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
        <h4 aria-level="3" role="heading" id="h4_gettingSharedSecret"><span class="secno">5.6.3 </span>Getting sharedSecret from Authenticator</h4>
        <p>
          Platform does the ECDH key agreement to arrive at sharedSecret to be used only during that transaction.
          Authenticator does not have to keep a list of sharedSecrets for all active sessions.
          If there are subsequent authenticatorClientPIN transactions, a new sharedSecret is generated every time.
        </p>
        <p>
          Platform performs the following operations to arrive at the sharedSecret:
        </p>
        <ul>
          <li>
            Platform sends <a href="#authenticatorClientPIN">authenticatorClientPIN</a> command
            by setting getKeyAgreement parameter to true.
            <ul>
              <li>
                Platform optionally can set getRetries parameter to true to get the <a href="#retries">retries</a> count.
                Retries count is the number of attempts remaining before lockout so when device is
                near authenticator lockout stage, platform can optionally warn the user to be careful while entering PIN.
              </li>
            </ul>
          </li>
          <li>Authenticator responds back with <a href="#authenticatorKeyAgreementKey">public key of authenticatorKeyAgreementKey, "aG"</a>.
            <ul>
              <li>
                Authenticator optionally also sends retires count if getRetries parameter is set to true.
              </li>
            </ul>
          </li>
          <li>
            <section id="platformKeyAgreementKey" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
              Platform generates <strong>"platformKeyAgreementKey"</strong>:
              <ul>
                <li>
                  Platform generates ECDH P-256 key pair called "platformKeyAgreementKey" denoted by <code>(b, bG)</code> where
                  <code>"b"</code> denotes the private key and <code>"bG"</code> denotes the public key.
                </li>
              </ul>
            </section>
          </li><li>
            <section id="platformSharedSecret" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
              Platform generates <strong>"sharedSecret"</strong>
              <ul>
                <li>
                  Platform generates "sharedSecret" using SHA-256 over ECDH key agreement protocol using
                  <a href="#platformKeyAgreementKey">private key of platformKeyAgreementKey, "b"</a> and
                  <a href="#authenticatorKeyAgreementKey">public key of authenticatorKeyAgreementKey, "aG"</a>:
                  <code>SHA-256((baG).x)</code>.
                  <ul>
                    <li>SHA-256 is done over only "x" curve point of baG.</li>
                    <li>
                      See <a href="https://tools.ietf.org/html/rfc6090#section-4.1">RFC 6090</a> and
                      appendix (C.2) of <a href="#NISTSP800-56A">NIST SP800-56A</a> for more ECDH key agreement protocol details
                      and key representation.
                    </li>
                  </ul>
                </li>
              </ul>
            </section>
          </li>
        </ul>
      </section>

      <section id="settingNewPin" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
        <h4 aria-level="3" role="heading" id="h4_settingNewPin"><span class="secno">5.6.4 </span>Setting a New PIN</h4>
        <p>Following operations are performed to set up a new PIN:</p>
        <ul>
          <li>Platform <a href="#gettingSharedSecret">gets sharedSecret</a> from the authenticator.</li>
          <li>
            Platform collects new PIN ("newPinUnicode") from the user in Unicode format.
            <ul>
              <li>
                Platform checks the Unicode character length of "newPinUnicode" against
                the minimum 4 Unicode character requirement and
                returns CTAP2_ERR_PIN_POLICY_VIOLATION if the check fails.
              </li>
              <li>
                Let "newPin" be the UTF-8 representation of "newPinUnicode".
                <ul>
                  <li>
                    Platform checks the byte length of "newPin" against
                    the max UTF-8 representation limit of 255 bytes and
                    returns CTAP2_ERR_PIN_POLICY_VIOLATION if the check fails.
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            Platform sends <a href="authenticatorClientPIN">authenticatorClientPIN</a> command
            with following parameters to the authenticator:
            <ul>
              <li>keyAgreement: <a href="#platformKeyAgreementKey">public key of platformKeyAgreementKey, "bG"</a>.</li>
              <li>
                newPinEnc: Encrypted newPin using <a href="#platformSharedSecret">sharedSecret</a>:
                <code>AES256-CBC(sharedSecret, IV=0, newPin)</code>.
                <ul>
                  <li>
                    During encryption, newPin is padded with trailing 0x00 bytes and is of minimum 64 bytes length.
                    This is to prevent leak of PIN length while communicating to the authenticator.
                    There is no PKCS #7 padding used in this scheme.
                  </li>
                </ul>
              </li>
              <li>
                pinAuth: <code>LEFT(HMAC-SHA-256(sharedSecret, newPinEnc), 16)</code>.
                <ul>
                  <li>
                    The platform sends the first 16 bytes of the HMAC-SHA-256 result.
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            Authenticator performs following operations upon receiving the request:
            <ul>
              <li>
                Authenticator generates "sharedSecret": <code>SHA-256((abG).x)</code> using
                <a href="#authenticatorKeyAgreementKey">private key of authenticatorKeyAgreementKey, "a"</a> and
                <a href="#platformKeyAgreementKey">public key of platformKeyAgreementKey, "bG"</a>.
                <ul>
                  <li>SHA-256 is done over only <code>"x"</code> curve point of <code>"abG"</code></li>
                  <li>
                    See <a href="https://tools.ietf.org/html/rfc6090#section-4.1">RFC 6090</a> and
                    appendix (C.2) of <a href="#NISTSP800-56A">NIST SP800-56A</a> for more ECDH key agreement protocol details
                    and key representation.
                  </li>
                </ul>
              </li>
              <li>
                Authenticator verifies pinAuth by generating <code>LEFT(HMAC-SHA-256(sharedSecret, newPinEnc), 16)</code>
                and matching against input pinAuth parameter.
                <ul>
                  <li>If pinAuth verification fails, authenticator returns CTAP2_ERR_PIN_AUTH_INVALID error.</li>
                </ul>
              </li>
              <li>
                Authenticator decrypts newPinEnc using above "sharedSecret" producing newPin and
                checks newPin length against minimum PIN length of 4 characters.
                <ul>
                  <li>
                    The decrypted padded newPin should be of at least 64 bytes length and
                    authenticator determines actual PIN length by looking for first 0x00 byte which terminates the PIN.
                  </li>
                  <li>If minimum PIN length check fails, authenticator returns CTAP2_ERR_PIN_POLICY_VIOLATION error.</li>
                  <li>Authenticator may have additional constraints for PIN policy. The current spec only enforces minimum length of 4 characters.</li>
                </ul>
              </li>
              <li>Authenticator stores <code>LEFT(SHA-256(newPin), 16)</code> on the device and returns CTAP2_OK.</li>
            </ul>
          </li>
        </ul>
      </section>

      <section id="changingExistingPin" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
        <h4 aria-level="3" role="heading" id="h4_changingExistingPin"><span class="secno">5.6.5 </span>Changing existing PIN</h4>
        <p>Following operations are performed to change an existing PIN:</p>
        <ul>
          <li>Platform <a href="#gettingSharedSecret">gets sharedSecret</a> from the authenticator.</li>
          <li>
            Platform collects current PIN ("curPinUnicode") and new PIN ("newPinUnicode") from the user.
            <ul>
              <li>
                Platform checks the Unicode character length of "newPinUnicode" against
                the minimum 4 Unicode character requirement and
                returns CTAP2_ERR_PIN_POLICY_VIOLATION if the check fails.
              </li>
              <li>
                Let "curPin" be the UTF-8 representation of "curPinUnicode" and "newPin" be the UTF-8 representation of "newPinUnicode"
                <ul>
                  <li>
                    Platform checks the byte length of "curPin" and "newPin" against
                    the max UTF-8 representation limit of 255 bytes and
                    returns CTAP2_ERR_PIN_POLICY_VIOLATION if the check fails.
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            Platform sends <a href="authenticatorClientPIN">authenticatorClientPIN</a> command
            with following parameters to the authenticator:
            <ul>
              <li>keyAgreement: <a href="#platformKeyAgreementKey">public key of platformKeyAgreementKey, "bG"</a>.</li>
              <li>
                pinHashEnc: Encrypted first 16 bytes of SHA-256 hash of curPin using
                <a href="#platformSharedSecret">sharedSecret</a>:
                <code>AES256-CBC(sharedSecret, IV=0, LEFT(SHA-256(curPin),16))</code>.
              </li>
              <li>
                newPinEnc: Encrypted "newPin" using <a href="#platformSharedSecret">sharedSecret</a>:
                <code>AES256-CBC(sharedSecret, IV=0, newPin)</code>.
                <ul>
                  <li>
                    During encryption, newPin is padded with trailing 0x00 bytes and is of minimum 64 bytes length.
                    This is to prevent leak of PIN length while communicating to the authenticator.
                    There is no PKCS #7 padding used in this scheme.
                  </li>
                </ul>
              </li>
              <li>pinAuth: <code>LEFT(HMAC-SHA-256(sharedSecret, newPinEnc || pinHashEnc), 16)</code>.
                <ul>
                  <li>
                    The platform sends the first 16 bytes of the HMAC-SHA-256 result.
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li>
            Authenticator performs following operations upon receiving the request:
            <ul>
              <li>
                Authenticator generates "sharedSecret": SHA-256((abG).x) using
                <a href="#authenticatorKeyAgreementKey">private key of authenticatorKeyAgreementKey, "a"</a> and
                <a href="#platformKeyAgreementKey">public key of platformKeyAgreementKey, "bG"</a>.
                <ul>
                  <li>SHA-256 is done over only <code>"x"</code> curve point of <code>"abG"</code></li>
                  <li>
                    See <a href="https://tools.ietf.org/html/rfc6090#section-4.1">RFC 6090</a> and
                    appendix (C.2) of <a href="#NISTSP800-56A">NIST SP800-56A</a> for more ECDH key agreement protocol details
                    and key representation.
                  </li>
                </ul>
              </li>
              <li>
                Authenticator verifies pinAuth by generating
                <code>LEFT(HMAC-SHA-256(sharedSecret, newPinEnc || pinHashEnc), 16)</code>
                and matching against input pinAuth parameter.
                <ul>
                  <li>If pinAuth verification fails, authenticator returns CTAP2_ERR_PIN_AUTH_INVALID error.</li>
                </ul>
              </li>
              <li>
                Authenticator decrypts pinHashEnc and verifies against its internal stored <code>LEFT(SHA-256(curPin), 16)</code>.
                <ul>
                  <li>
                    If a mismatch is detected, authenticator generate new <strong>"authenticatorKeyAgreementKey"</strong> first
                    and then returns CTAP2_ERR_PIN_INVALID error.
                      <ul>
                        <li>
                          Generate a new ECDH P-256 key pair called "authenticatorKeyAgreementKey" denoted by <code>(a, aG)</code> where
                          <code>"a"</code> denotes the private key and <code>"aG"</code> denotes the public key.
                          <ul>
                            <li>
                              See <a href="https://tools.ietf.org/html/rfc6090#section-4.1">RFC 6090</a> and
                              <a href="#NISTSP800-56A">NIST SP800-56A</a> for more ECDH key agreement protocol details.
                            </li>
                          </ul>
                        </li>
                      </ul>                        
                  </li>
                </ul>
              </li>
              <li>
                Authenticator decrypts newPinEnc using above "sharedSecret" producing newPin and
                checks newPin length against minimum PIN length of 4 characters.
                <ul>
                  <li>
                    The decrypted padded newPin should be of at least 64 bytes length and
                    authenticator determines actual PIN length by looking
                    for first 0x00 byte which terminates the PIN.
                  </li>
                  <li>If minimum PIN length check fails, authenticator returns CTAP2_ERR_PIN_POLICY_VIOLATION error.</li>
                  <li>Authenticator may have additional constraints for PIN policy. The current spec only enforces minimum length of 4 characters.</li>
                </ul>
              </li>
              <li>Authenticator stores <code>LEFT(SHA-256(newPin), 16)</code> on the device and returns CTAP2_OK.</li>
            </ul>
          </li>
        </ul>
      </section>

      <section id="gettingPinToken" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
        <h4 aria-level="3" role="heading" id="h4_gettingPinToken"><span class="secno">5.6.6 </span>Getting pinToken from the Authenticator</h4>
        <p>
          This step only has to be performed once for the lifetime of the authenticator/platform handle.
          Getting pinToken once provides allows high security without any additional roundtrips every time
          (except for the first key-agreement phase) and its overhead is minimal.
        </p>
        <p>
          Following operations are performed to get pinToken which will be used in subsequent
          <a href="#authenticatorMakeCredential">authenticatorMakeCredential</a> and
          <a href="#authenticatorGetAssertion">authenticatorGetAssertion</a> operations:
        </p>
        <ul>
          <li>Platform <a href="#gettingSharedSecret">gets sharedSecret</a> from the authenticator.</li>
          <li>Platform collects PIN from the user.</li>
          <li>
            Platform sends <a href="authenticatorClientPIN">authenticatorClientPIN</a> command
            with following parameters to the authenticator:
            <ul>
              <li>keyAgreement: <a href="#platformKeyAgreementKey">public key of platformKeyAgreementKey, "bG"</a>.</li>
              <li>pinHashEnc: <code>AES256-CBC(sharedSecret, IV=0, LEFT(SHA-256(PIN),16))</code>.</li>
            </ul>
          </li>
          <li>
            Authenticator performs following operations upon receiving the request:
            <ul>
              <li>
                Authenticator generates "sharedSecret": <code>SHA-256((abG).x)</code> using
                <a href="#authenticatorKeyAgreementKey">private key of authenticatorKeyAgreementKey, "a"</a> and
                <a href="#platformKeyAgreementKey">public key of platformKeyAgreementKey, "bG"</a>.
                <ul>
                  <li>SHA-256 is done over only <code>"x"</code> curve point of <code>"abG"</code></li>
                  <li>
                    See <a href="https://tools.ietf.org/html/rfc6090#section-4.1">RFC 6090</a> and
                    appendix (C.2) of <a href="#NISTSP800-56A">NIST SP800-56A</a> for more ECDH key agreement protocol details
                    and key representation.
                  </li>
                </ul>
              </li>
              <li>
                Authenticator decrypts pinHashEnc and verifies against its internal stored <code>LEFT(SHA-256(curPin), 16)</code>.
                <ul>
                  <li>
                    If a mismatch is detected, authenticator generate new <strong>"authenticatorKeyAgreementKey"</strong> first
                    and then returns CTAP2_ERR_PIN_INVALID error.
                      <ul>
                        <li>
                          Generate a new ECDH P-256 key pair called "authenticatorKeyAgreementKey" denoted by <code>(a, aG)</code> where
                          <code>"a"</code> denotes the private key and <code>"aG"</code> denotes the public key.
                          <ul>
                            <li>
                              See <a href="https://tools.ietf.org/html/rfc6090#section-4.1">RFC 6090</a> and
                              <a href="#NISTSP800-56A">NIST SP800-56A</a> for more ECDH key agreement protocol details.
                            </li>
                          </ul>
                        </li>
                      </ul>                        
                  </li>
                </ul>
              </li>
              <li>
                Authenticator returns encrypted pinToken using "sharedSecret": <code>AES256-CBC(sharedSecret, IV=0, pinToken)</code>.
                <ul>
                  <li>
                    pinToken should be a multiple of 16 bytes (AES block length) without any padding or IV. There is no PKCS #7 padding used in this scheme.
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </section>

      <section id="usingPinToken" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
        <h4 aria-level="3" role="heading" id="h4_usingPinToken"><span class="secno">5.6.7 </span>Using pinToken</h4>

        <p>
          Platform has the flexibility to manage the lifetime of pinToken based on the scenario however
          it should get rid of the pinToken as soon as possible when not required.
          Authenticator also can expire pinToken based on certain conditions like changing a PIN,
          timeout happening on authenticator, machine waking up from a suspend state etc.
          If pinToken has expired, authenticator will return CTAP2_ERR_PIN_TOKEN_EXPIRED and platform can act
          on the error accordingly.
        </p>

        <section id="using-pintoken-in-authenticatormakecredential">
          <h5 aria-level="4" role="heading" id="h5_using-pintoken-in-authenticatormakecredential"><span class="secno">5.6.7.1 </span>Using pinToken in <a href="#authenticatorMakeCredential"> authenticatorMakeCredential</a></h5>
          <p>Following operations are performed to use <a href="#pinToken">pinToken</a> in authenticatorMakeCredential API:</p>
          <ul>
            <li>Platform <a href="#gettingPinToken">gets pinToken</a> from the authenticator.</li>
            <li>
              Platform sends authenticatorMakeCredential command with following additional optional parameter:
              <ul>
                <li>
                  pinAuth: <code>LEFT(HMAC-SHA-256(pinToken, clientDataHash), 16)</code>.
                  <ul>
                    <li>
                      The platform sends the first 16 bytes of the HMAC-SHA-256 result.
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              Authenticator verifies pinAuth by generating
              <code>LEFT(HMAC-SHA-256(pinToken, clientDataHash), 16)</code>
              and matching against input pinAuth parameter.
            </li>
            <li>Authenticator returns authenticatorMakeCredential response with "uv" bit set to 1. </li>
          </ul>

          <p>
            If platform sends zero length pinAuth, authenticator needs to wait for user touch and then returns either
            CTAP2_ERR_PIN_NOT_SET if pin is not set or CTAP2_ERR_PIN_INVALID if pin has been set. This is done for the case
            where multiple authenticators are attached to the platform and the platform wants to enforce clientPin
            semantics, but the user has to select which authenticator to send the pinToken to.
          </p>

        </section>
        <section id="using-pintoken-in-authenticatorgetassertion">
          <h5 aria-level="4" role="heading" id="h5_using-pintoken-in-authenticatorgetassertion"><span class="secno">5.6.7.2 </span>Using pinToken in <a href="#authenticatorGetAssertion">authenticatorGetAssertion</a></h5>
          <p>Following operations are performed to use <a href="#pinToken">pinToken</a> in authenticatorGetAssertion API:</p>
          <ul>
            <li>Platform <a href="#gettingPinToken">gets pinToken</a> from the authenticator.</li>
            <li>
              Platform sends authenticatorGetAssertion command with following additional optional parameter:
              <ul>
                <li>
                  pinAuth: <code>LEFT(HMAC-SHA-256(pinToken, clientDataHash), 16)</code>.
                </li>
              </ul>
            </li>
            <li>
              Authenticator verifies pinAuth by generating
              <code>LEFT(HMAC-SHA-256(pinToken, clientDataHash), 16)</code>
              and matching against input pinAuth parameter.
            </li>
            <li>Authenticator returns authenticatorGetAssertion response with "uv" bit set to 1. </li>
          </ul>

          <p>
            If platform sends zero length pinAuth, authenticator needs to wait for user touch and then returns either
            CTAP2_ERR_PIN_NOT_SET if pin is not set or CTAP2_ERR_PIN_INVALID if pin has been set. This is done for the case
            where multiple authenticators are attached to the platform and the platform wants to enforce clientPin
            semantics, but the user has to select which authenticator to send the pinToken to.
          </p>

        </section>
        <section id="without-pintoken-in-authenticatorgetassertion">
          <h5 aria-level="4" role="heading" id="h5_without-pintoken-in-authenticatorgetassertion"><span class="secno">5.6.7.3 </span>Without pinToken in <a href="#authenticatorGetAssertion">authenticatorGetAssertion</a></h5>
          <p>Following operations are performed without using <a href="#pinToken">pinToken</a> in authenticatorGetAssertion API:</p>
          <ul>
            <li>Platform sends authenticatorGetAssertion command without pinAuth optional parameter.</li>
            <li>Authenticator returns authenticatorGetAssertion response with "uv" bit set to 0. </li>
          </ul>
        </section>
      </section>

      <figure id="fig-clientPin">
        <img src="img/fido-2.0-clientpin.svg" alt="Client Pin">
        <figcaption>Fig. <span class="figno">1</span> <span class="fig-title">Client Pin</span></figcaption>
      </figure>
    </section>

    <section id="authenticatorReset" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter">
      <h3 aria-level="2" role="heading" id="h3_authenticatorReset"><span class="secno">5.7 </span>authenticatorReset(0x07)</h3>
      <p>This method is used by the client to reset an authenticator back to a
        factory default state, invalidating all generated credentials. In order
        to prevent accidental trigger of this mechanism, some form of user
        approval <em class="rfc2119" title="MAY">MAY</em> be performed on the authenticator itself,
        meaning that the client will have to poll the device until the reset
        has been performed. The actual user-flow to perform the reset will vary
        depending on the authenticator and it outside the scope of this
        specification.
      </p>
    </section>
  </section>
  <section id="message-encoding">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_message-encoding"><span class="secno">6. </span>Message encoding</h2>

    <p>Many transports (e.g., Bluetooth Smart) are bandwidth constrained, and
      serialization formats such as JSON are too heavy-weight for such
      environments.  For this reason, all encoding is done using the concise
      binary encoding CBOR [<cite><a class="bibref" href="#bib-RFC7049">RFC7049</a></cite>].</p>
    <p>
      To reduce the complexity of the messages and the resources required to
      parse and validate them, all messages <em class="rfc2119" title="MUST">MUST</em> use Canonical CBOR as specified
      below. All encoders <em class="rfc2119" title="MUST">MUST</em> generate Canonical CBOR without duplicate map keys. 
      All decoders <em class="rfc2119" title="SHOULD">SHOULD</em> enforce Canonical CBOR and <em class="rfc2119" title="SHOULD">SHOULD</em> reject messages with 
      duplicate map keys.

      Canonical CBOR for CTAP uses the following rules:
      </p><ul>
        <li>Integers must be encoded as small as possible.
          <ul>
            <li>0 to 23 and -1 to -24 must be expressed in the same byte as the
                major type;
            </li><li>24 to 255 and -25 to -256 must be expressed only with an
                additional uint8_t;
            </li><li>256 to 65535 and -257 to -65536 must be expressed only with an
                additional uint16_t;
            </li><li>65536 to 4294967295 and -65537 to -4294967296 must be expressed
                only with an additional uint32_t.
          </li></ul>
        </li><li>The expression of lengths in major types 2 through 5 must be as
            short as possible.  The rules for these lengths follow the above
            rule for integers.
        </li><li>Indefinite-length items must be made into definite-length items.
        </li><li>The keys in every map must be sorted lowest value to highest.
            Sorting is performed on the bytes of the representation of the key
            data items without paying attention to the 3/5 bit splitting for
            major types.
            The sorting rules are:
            <ul>
              <li>If the major types are different, the one with the lower value
                  in numerical order sorts earlier.
              </li><li>If two keys have different lengths, the shorter one sorts earlier;
              </li><li>If two keys have the same length, the one with the lower value
                  in (byte-wise) lexical order sorts earlier.
            </li></ul>
      </li></ul>
    <p>
      Because some authenticators are memory constrained,
      the depth of nested CBOR structures used by all message encodings
      is limited to at most four (4) levels of any combination of
      CBOR maps and/or CBOR arrays.
      Authenticators <em class="rfc2119" title="MUST">MUST</em> support at least 4 levels of CBOR nesting.
      Clients, platforms, and servers <em class="rfc2119" title="MUST NOT">MUST NOT</em> use more than 4 levels of CBOR nesting.
    </p>
    <p>
      Likewise, because some authenticators are memory constrained,
      the maximum message size supported by an authenticator <em class="rfc2119" title="MAY">MAY</em> be limited.
      By default, authenticators <em class="rfc2119" title="MUST">MUST</em> support messages of at least 1024 bytes.
      Authenticators <em class="rfc2119" title="MAY">MAY</em> declare a different maximum message size supported
      using the maxMsgSize authenticatorGetInfo result parameter.
      Clients, platforms, and servers <em class="rfc2119" title="MUST NOT">MUST NOT</em> send messages larger than 1024
      bytes unless the authenticator's maxMsgSize indicates support for
      the larger message size.
      Authenticators <em class="rfc2119" title="MAY">MAY</em> return the CTAP2_ERR_REQUEST_TOO_LARGE error
      if size or memory constraints are exceeded.
    </p>
    <p>
      If map keys are present that an implementation does not understand,
      they <em class="rfc2119" title="MUST">MUST</em> be ignored.
      Note that this enables additional fields to be used as new features are added
      without breaking existing implementations.
    </p>

    <p>Messages from the host to authenticator are called "commands" and
      messages from authenticator to host are called "replies". All values are
      big endian encoded.</p>

    <section id="commands">
      <h3 aria-level="2" role="heading" id="h3_commands"><span class="secno">6.1 </span>Commands</h3>

      <p>All commands are structured as:</p>
      <table class="simple">
        <tbody><tr>
          <th>Name</th>
          <th>Length</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>Command Value</td>
          <td>1 byte</td>
          <td>Required</td>
          <td>The value of the command to execute</td>
        </tr>
        <tr>
          <td>Command Parameters</td>
          <td>variable</td>
          <td>Optional</td>
          <td>CBOR [<cite><a class="bibref" href="#bib-RFC7049">RFC7049</a></cite>] encoded set of parameters.  Some commands have
            parameters, while others do not (see below)</td>
        </tr>
      </tbody></table>

      <p>The assigned values for commands and their descriptions are:</p>
      <table class="simple">
        <tbody><tr>
          <th>Command Name</th>
          <th>Command Value</th>
          <th>Has parameters?</th>
        </tr>
        <tr>
          <td>authenticatorMakeCredential</td>
          <td>0x01</td>
          <td>yes</td>
        </tr>
        <tr>
          <td>authenticatorGetAssertion</td>
          <td>0x02</td>
          <td>yes</td>
        </tr>
        <tr>
          <td>authenticatorCancel</td>
          <td>0x03</td>
          <td>no</td>
        </tr>
        <tr>
          <td>authenticatorGetInfo</td>
          <td>0x04</td>
          <td>no</td>
        </tr>
        <tr>
          <td>authenticatorClientPIN</td>
          <td>0x06</td>
          <td>yes</td>
        </tr>
        <tr>
          <td>authenticatorReset</td>
          <td>0x07</td>
          <td>no</td>
        </tr>
        <tr>
          <td>authenticatorGetNextAssertion</td>
          <td>0x08</td>
          <td>no</td>
        </tr>
        <tr>
          <td>authenticatorVendorFirst</td>
          <td>0x40</td>
          <td>NA</td>
        </tr>
        <tr>
          <td>authenticatorVendorLast</td>
          <td>0xBF</td>
          <td>NA</td>
        </tr>
      </tbody></table>

      <p>
        Command codes in the range between <strong>authenticatorVendorFirst</strong> and <strong>authenticatorVendorLast</strong>
        may be used for vendor-specific implementations. For example, the vendor may choose to put in some testing commands.
        Note that the FIDO client will never generate these commands. All other command codes are reserved for future use
        and may not be used.
      </p>

      <p>Command parameters are encoded using a CBOR map (CBOR major type 5).
        The CBOR map must be encoded using the definite length variant.</p>

      <p>Some commands have optional parameters.  Therefore, the length of the
        parameter map for these commands may vary.  For example,
        authenticatorMakeCredential may have 4, 5, 6, or 7 parameters, while
        authenticatorGetAssertion may have 2, 3, 4, or 5 parameters.</p>

      <p>All command parameters are CBOR encoded following the <em>JSON to
        CBOR</em> conversion procedures as per the CBOR specification
        [<cite><a class="bibref" href="#bib-RFC7049">RFC7049</a></cite>].  Specifically, parameters that are represented as DOM
        objects in the <em>Authenticator API</em> layers (formally defined in
        the Web API [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>]) are converted first to JSON and subsequently
        to CBOR.</p>

      <aside class="example"><div class="example-title"><span>Example 1</span></div>A PublicKeyCredentialRpEntity DOM object defined as follows:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">  </span><span class="kwd">var</span><span class="pln"> rp </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"Acme"</span><span class="pln">
      </span><span class="pun">};</span><span class="pln">
        </span></pre>
        would be CBOR encoded as follows:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">  a1                                              </span><span class="com"># map(1)</span><span class="pln">
      </span><span class="lit">64</span><span class="pln">                                          </span><span class="com"># text(4)</span><span class="pln">
          </span><span class="lit">6e616d65</span><span class="pln">                                </span><span class="com"># "name"</span><span class="pln">
      </span><span class="lit">64</span><span class="pln">                                          </span><span class="com"># text(4)</span><span class="pln">
          </span><span class="lit">41636d65</span><span class="pln">                                </span><span class="com"># "Acme"</span><span class="pln">
        </span></pre>
      </aside>

      <aside class="example"><div class="example-title"><span>Example 2</span></div>A PublicKeyCredentialUserEntity DOM object defined as follows:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">  </span><span class="kwd">var</span><span class="pln"> user </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        id</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Uint8Array</span><span class="pun">.</span><span class="kwd">from</span><span class="pun">(</span><span class="pln">window</span><span class="pun">.</span><span class="pln">atob</span><span class="pun">(</span><span class="str">"MIIBkzCCATigAwIBAjCCAZMwggE4oAMCAQIwggGTMII="</span><span class="pun">),</span><span class="pln"> c</span><span class="pun">=&gt;</span><span class="pln">c</span><span class="pun">.</span><span class="pln">charCodeAt</span><span class="pun">(</span><span class="lit">0</span><span class="pun">)),</span><span class="pln">
        icon</span><span class="pun">:</span><span class="pln"> </span><span class="str">"https://pics.acme.com/00/p/aBjjjpqPb.png"</span><span class="pun">,</span><span class="pln">
        name</span><span class="pun">:</span><span class="pln"> </span><span class="str">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5832373036282b35312c30183d20393528343d763b3735">[email&#160;protected]</a>"</span><span class="pun">,</span><span class="pln">
        displayName</span><span class="pun">:</span><span class="pln"> </span><span class="str">"John P. Smith"</span><span class="pln">
      </span><span class="pun">};</span><span class="pln">
        </span></pre>
        would be CBOR encoded as follows:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">  a4                                              </span><span class="com"># map(4)</span><span class="pln">
      </span><span class="lit">62</span><span class="pln">                                          </span><span class="com"># text(2)</span><span class="pln">
          </span><span class="lit">6964</span><span class="pln">                                    </span><span class="com"># "id"</span><span class="pln">
      </span><span class="lit">58</span><span class="pln"> </span><span class="lit">20</span><span class="pln">                                       </span><span class="com"># bytes(32)</span><span class="pln">
          </span><span class="lit">3082019330820138a003020102</span><span class="pln">              </span><span class="com"># userid</span><span class="pln">
          </span><span class="lit">3082019330820138a003020102</span><span class="pln">              </span><span class="com"># ...</span><span class="pln">
          </span><span class="lit">308201933082</span><span class="pln">                            </span><span class="com"># ...</span><span class="pln">
      </span><span class="lit">64</span><span class="pln">                                          </span><span class="com"># text(4)</span><span class="pln">
          </span><span class="lit">69636f6e</span><span class="pln">                                </span><span class="com"># "icon"</span><span class="pln">
      </span><span class="lit">7828</span><span class="pln">                                        </span><span class="com"># text(40)</span><span class="pln">
          </span><span class="lit">68747470733a2f2f706963732e61636d</span><span class="pln">        </span><span class="com"># "https://pics.acme.com/00/p/aBjjjpqPb.png"</span><span class="pln">
          </span><span class="lit">652e636f6d2f30302f702f61426a6a6a</span><span class="pln">        </span><span class="com"># ...</span><span class="pln">
          </span><span class="lit">707150622e706e67</span><span class="pln">                        </span><span class="com"># ...</span><span class="pln">
      </span><span class="lit">64</span><span class="pln">                                          </span><span class="com"># text(4)</span><span class="pln">
          </span><span class="lit">6e616d65</span><span class="pln">                                </span><span class="com"># "name"</span><span class="pln">
      </span><span class="lit">76</span><span class="pln">                                          </span><span class="com"># text(22)</span><span class="pln">
          </span><span class="lit">6a6f686e70736d697468406578616d70</span><span class="pln">        </span><span class="com"># "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e08a8f888e90938d899488a08598818d908c85ce838f8d">[email&#160;protected]</a>"</span><span class="pln">
          </span><span class="lit">6c652e636f6d</span><span class="pln">                            </span><span class="com"># ...</span><span class="pln">
      </span><span class="lit">6b</span><span class="pln">                                          </span><span class="com"># text(11)</span><span class="pln">
          </span><span class="lit">646973706c61794e616d65</span><span class="pln">                  </span><span class="com"># "displayName"</span><span class="pln">
      </span><span class="lit">6d</span><span class="pln">                                          </span><span class="com"># text(13)</span><span class="pln">
          </span><span class="lit">4a6f686e20502e20536d697468</span><span class="pln">              </span><span class="com"># "John P. Smith"	  </span><span class="pln">
        </span></pre>
      </aside>

      <aside class="example"><div class="example-title"><span>Example 3</span></div>A DOM object that is a sequence of
        PublicKeyCredentialParameters defined as follows:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">      </span><span class="kwd">var</span><span class="pln"> pubKeyCredParams </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="pln">
          </span><span class="pun">{</span><span class="pln">
            type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"public-key"</span><span class="pun">,</span><span class="pln">
            alg</span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">7</span><span class="pln"> </span><span class="com">// "ES256" as registered in the IANA COSE Algorithms registry</span><span class="pln">
          </span><span class="pun">},</span><span class="pln">
          </span><span class="pun">{</span><span class="pln">
            type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"public-key"</span><span class="pun">,</span><span class="pln">
            alg</span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">257</span><span class="pln"> </span><span class="com">// "RS256" as registered by WebAuthn</span><span class="pln">
          </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">];</span><span class="pln">
        </span></pre>
        would be CBOR encoded as:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">  </span><span class="lit">82</span><span class="pln">                                              </span><span class="com"># array(2)</span><span class="pln">
      a2                                          </span><span class="com"># map(2)</span><span class="pln">
          </span><span class="lit">63</span><span class="pln">                                      </span><span class="com"># text(3)</span><span class="pln">
              </span><span class="lit">616c67</span><span class="pln">                              </span><span class="com"># "alg"</span><span class="pln">
          </span><span class="lit">26</span><span class="pln">                                      </span><span class="com"># -7 (ES256)</span><span class="pln">
          </span><span class="lit">64</span><span class="pln">                                      </span><span class="com"># text(4)</span><span class="pln">
              </span><span class="lit">74797065</span><span class="pln">                            </span><span class="com"># "type"</span><span class="pln">
          </span><span class="lit">6a</span><span class="pln">                                      </span><span class="com"># text(10)</span><span class="pln">
              </span><span class="lit">7075626C69632D6B6579</span><span class="pln">                </span><span class="com"># "public-key"</span><span class="pln">
      a2                                          </span><span class="com"># map(2)</span><span class="pln">
          </span><span class="lit">63</span><span class="pln">                                      </span><span class="com"># text(3)</span><span class="pln">
              </span><span class="lit">616c67</span><span class="pln">                              </span><span class="com"># "alg"</span><span class="pln">
          </span><span class="lit">390100</span><span class="pln">                                  </span><span class="com"># -257 (RS256)</span><span class="pln">
          </span><span class="lit">64</span><span class="pln">                                      </span><span class="com"># text(4)</span><span class="pln">
              </span><span class="lit">74797065</span><span class="pln">                            </span><span class="com"># "type"</span><span class="pln">
          </span><span class="lit">6a</span><span class="pln">                                      </span><span class="com"># text(10)</span><span class="pln">
              </span><span class="lit">7075626C69632D6B6579</span><span class="pln">                </span><span class="com"># "public-key"</span><span class="pln">
        </span></pre>
      </aside>


      <p>For each command that contains parameters, the parameter map keys and
        value types are specified below:</p>

      <table class="simple">
        <tbody><tr>
          <th>Command</th>
          <th>Parameter Name</th>
          <th>Key</th>
          <th>Value type</th>
        </tr>
        <tr>
          <td>authenticatorMakeCredential</td>
          <td>clientDataHash</td>
          <td>0x01</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>rp</td>
          <td>0x02</td>
          <td>CBOR definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>user</td>
          <td>0x03</td>
          <td>CBOR definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>pubKeyCredParams</td>
          <td>0x04</td>
          <td>CBOR definite length array (CBOR major type 4) of CBOR definite
            length maps (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>excludeList</td>
          <td>0x05</td>
          <td>CBOR definite length array (CBOR major type 4) of CBOR definite
            length maps (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>extensions</td>
          <td>0x06</td>
          <td>CBOR definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>options</td>
          <td>0x07</td>
          <td>CBOR definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>pinAuth</td>
          <td>0x08</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>pinProtocol</td>
          <td>0x09</td>
          <td>PIN protocol version chosen by the Client.  For this version of the spec, this <em class="rfc2119" title="SHALL">SHALL</em> be the number 1.</td>
        </tr>
        <tr><td></td><td></td><td></td><td></td></tr>
        <tr>
          <td>authenticatorGetAssertion</td>
          <td>rpId</td>
          <td>0x01</td>
          <td>UTF-8 encoded text string (CBOR major type 3).</td>
        </tr>
        <tr>
          <td></td>
          <td>clientDataHash</td>
          <td>0x02</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>allowList</td>
          <td>0x03</td>
          <td>CBOR definite length array (CBOR major type 4) of CBOR definite
            length maps (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>extensions</td>
          <td>0x04</td>
          <td>CBOR definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>options</td>
          <td>0x05</td>
          <td>CBOR definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>pinAuth</td>
          <td>0x06</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>pinProtocol</td>
          <td>0x07</td>
          <td>PIN protocol version chosen by the Client.  For this version of the spec, this <em class="rfc2119" title="SHALL">SHALL</em> be the number 1.</td>
        </tr>
        <tr><td></td><td></td><td></td><td></td></tr>
        <tr>
          <td>authenticatorClientPIN</td>
          <td>pinProtocol</td>
          <td>0x01</td>
          <td>Unsigned Integer. (CBOR major type 0)</td>
        </tr>
        <tr>
          <td></td>
          <td>subCommand</td>
          <td>0x02</td>
          <td>Unsigned Integer. (CBOR major type 0)</td>
        </tr>
        <tr>
          <td></td>
          <td>keyAgreement</td>
          <td>0x03</td>
          <td>COSE_KEY</td>
        </tr>
        <tr>
          <td></td>
          <td>pinAuth</td>
          <td>0x04</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>newPinEnc</td>
          <td>0x05</td>
          <td>byte string (CBOR major type 2). It is UTF-8 representation of encrypted input PIN value.</td>
        </tr>
        <tr>
          <td></td>
          <td>pinHashEnc</td>
          <td>0x06</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>getKeyAgreement</td>
          <td>0x07</td>
          <td>Boolean. (CBOR major type 7, additional simple value information 20(False)/21(True)).</td>
        </tr>
        <tr>
          <td></td>
          <td>getRetries</td>
          <td>0x08</td>
          <td>Boolean. (CBOR major type 7, additional simple value information 20(False)/21(True)).</td>
        </tr>
      </tbody></table>

      <aside class="example"><div class="example-title"><span>Example 4</span></div>
        The following is a complete encoding example of the
        <code>authenticatorMakeCredential</code> command (using same account
        and crypto parameters as above) and the corresponding
        <code>authenticatorMakeCredential_Response</code> response:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">          </span><span class="lit">01</span><span class="pln">                                      </span><span class="com"># authenticatorMakeCredential command</span><span class="pln">
          a5                                      </span><span class="com"># map(5)</span><span class="pln">
             </span><span class="lit">01</span><span class="pln">                                   </span><span class="com"># unsigned(1) - clientDataHash</span><span class="pln">
             </span><span class="lit">58</span><span class="pln"> </span><span class="lit">20</span><span class="pln">                                </span><span class="com"># bytes(32)</span><span class="pln">
                </span><span class="lit">687134968222ec17202e42505f8ed2b1</span><span class="pln">  </span><span class="com"># h'687134968222ec17202e42505f8ed2b16ae22f16bb05b88c25db9e602645f141'</span><span class="pln">
                </span><span class="lit">6ae22f16bb05b88c25db9e602645f141</span><span class="pln">  </span><span class="com">#</span><span class="pln">
             </span><span class="lit">02</span><span class="pln">                                   </span><span class="com"># unsigned(2) - rp</span><span class="pln">
             a2                                   </span><span class="com"># map(2)</span><span class="pln">
                </span><span class="lit">62</span><span class="pln">                                </span><span class="com"># text(2)</span><span class="pln">
                   </span><span class="lit">6964</span><span class="pln">                           </span><span class="com"># "id"</span><span class="pln">
                </span><span class="lit">68</span><span class="pln">                                </span><span class="com"># text(8)</span><span class="pln">
                   </span><span class="lit">61636d652e636f6d</span><span class="pln">               </span><span class="com"># "acme.com"</span><span class="pln">
                </span><span class="lit">64</span><span class="pln">                                </span><span class="com"># text(4)</span><span class="pln">
                   </span><span class="lit">6e616d65</span><span class="pln">                       </span><span class="com"># "name"</span><span class="pln">
                </span><span class="lit">64</span><span class="pln">                                </span><span class="com"># text(4)</span><span class="pln">
                   </span><span class="lit">41636d65</span><span class="pln">                       </span><span class="com"># "Acme"</span><span class="pln">
             </span><span class="lit">03</span><span class="pln">                                   </span><span class="com"># unsigned(3) - user</span><span class="pln">
             a4                                   </span><span class="com"># map(4)</span><span class="pln">
                </span><span class="lit">62</span><span class="pln">                                </span><span class="com"># text(2)</span><span class="pln">
                   </span><span class="lit">6964</span><span class="pln">                           </span><span class="com"># "id"</span><span class="pln">
                </span><span class="lit">58</span><span class="pln"> </span><span class="lit">20</span><span class="pln">                             </span><span class="com"># bytes(32)</span><span class="pln">
                   </span><span class="lit">3082019330820138a003020102</span><span class="pln">     </span><span class="com"># userid</span><span class="pln">
                   </span><span class="lit">3082019330820138a003020102</span><span class="pln">     </span><span class="com"># ...</span><span class="pln">
                   </span><span class="lit">308201933082</span><span class="pln">                   </span><span class="com"># ...                         </span><span class="pln">
                </span><span class="lit">64</span><span class="pln">                                </span><span class="com"># text(4)</span><span class="pln">
                   </span><span class="lit">69636f6e</span><span class="pln">                       </span><span class="com"># "icon"</span><span class="pln">
                </span><span class="lit">78</span><span class="pln"> </span><span class="lit">28</span><span class="pln">                             </span><span class="com"># text(40)</span><span class="pln">
                   </span><span class="lit">68747470733a2f2f706963732e616</span><span class="pln">  </span><span class="com"># "https://pics.acme.com/00/p/aBjjjpqPb.png"</span><span class="pln">
                   </span><span class="lit">36d652e636f6d2f30302f702f6142</span><span class="pln">  </span><span class="com">#</span><span class="pln">
                   </span><span class="lit">6a6a6a707150622e706e67</span><span class="pln">         </span><span class="com">#</span><span class="pln">
                </span><span class="lit">64</span><span class="pln">                                </span><span class="com"># text(4)</span><span class="pln">
                   </span><span class="lit">6e616d65</span><span class="pln">                       </span><span class="com"># "name"</span><span class="pln">
                </span><span class="lit">76</span><span class="pln">                                </span><span class="com"># text(22)</span><span class="pln">
                   </span><span class="lit">6a6f686e70736d697468406578616</span><span class="pln">  </span><span class="com"># "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="157f7a7d7b6566787c617d55706d74786579703b767a78">[email&#160;protected]</a>"</span><span class="pln">
                   d706c652e636f6d                </span><span class="com">#</span><span class="pln">
                </span><span class="lit">6b</span><span class="pln">                                </span><span class="com"># text(11)</span><span class="pln">
                   </span><span class="lit">646973706c61794e616d65</span><span class="pln">         </span><span class="com"># "displayName"</span><span class="pln">
                </span><span class="lit">6d</span><span class="pln">                                </span><span class="com"># text(13)</span><span class="pln">
                   </span><span class="lit">4a6f686e20502e20536d697468</span><span class="pln">     </span><span class="com"># "John P. Smith"</span><span class="pln">
             </span><span class="lit">04</span><span class="pln">                                   </span><span class="com"># unsigned(4) - pubKeyCredParams</span><span class="pln">
             </span><span class="lit">82</span><span class="pln">                                   </span><span class="com"># array(2)</span><span class="pln">
                a2                                </span><span class="com"># map(2)</span><span class="pln">
                   </span><span class="lit">63</span><span class="pln">                             </span><span class="com"># text(3)</span><span class="pln">
                      </span><span class="lit">616c67</span><span class="pln">                      </span><span class="com"># "alg"</span><span class="pln">
                   </span><span class="lit">26</span><span class="pln">                             </span><span class="com"># -7 (ES256)</span><span class="pln">
                   </span><span class="lit">64</span><span class="pln">                             </span><span class="com"># text(4)</span><span class="pln">
                      </span><span class="lit">74797065</span><span class="pln">                    </span><span class="com"># "type"</span><span class="pln">
                   </span><span class="lit">6a</span><span class="pln">                             </span><span class="com"># text(10)</span><span class="pln">
                      </span><span class="lit">7075626C69632D6B6579</span><span class="pln">        </span><span class="com"># "public-key"</span><span class="pln">
                a2                                </span><span class="com"># map(2)</span><span class="pln">
                   </span><span class="lit">63</span><span class="pln">                             </span><span class="com"># text(3)</span><span class="pln">
                      </span><span class="lit">616c67</span><span class="pln">                      </span><span class="com"># "alg"</span><span class="pln">
                   </span><span class="lit">390100</span><span class="pln">                         </span><span class="com"># -257 (RS256)</span><span class="pln">
                   </span><span class="lit">64</span><span class="pln">                             </span><span class="com"># text(4)</span><span class="pln">
                      </span><span class="lit">74797065</span><span class="pln">                    </span><span class="com"># "type"</span><span class="pln">
                   </span><span class="lit">6a</span><span class="pln">                             </span><span class="com"># text(10)</span><span class="pln">
                      </span><span class="lit">7075626C69632D6B6579</span><span class="pln">        </span><span class="com"># "public-key"</span><span class="pln">
             </span><span class="lit">07</span><span class="pln">                                   </span><span class="com"># unsigned(7) - options</span><span class="pln">
             a1                                   </span><span class="com"># map(1)</span><span class="pln">
                </span><span class="lit">70</span><span class="pln">                                </span><span class="com"># text(16)</span><span class="pln">
                   </span><span class="lit">6b657953746f72616765446576696</span><span class="pln">  </span><span class="com"># "keyStorageDevice"</span><span class="pln">
                   </span><span class="lit">365</span><span class="pln">                            </span><span class="com">#</span><span class="pln">
                f5                                </span><span class="com"># primitive(21)</span><span class="pln">
        </span></pre>

        <code>authenticatorMakeCredential_Response</code> response:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">          </span><span class="lit">00</span><span class="pln">                                      </span><span class="com"># status = success</span><span class="pln">
          a3                                      </span><span class="com"># map(3)</span><span class="pln">
             </span><span class="lit">01</span><span class="pln">                                   </span><span class="com"># unsigned(1)</span><span class="pln">
             </span><span class="lit">66</span><span class="pln">                                   </span><span class="com"># text(6)</span><span class="pln">
                </span><span class="lit">7061636b6564</span><span class="pln">                      </span><span class="com"># "packed"</span><span class="pln">
             </span><span class="lit">02</span><span class="pln">                                   </span><span class="com"># unsigned(2)</span><span class="pln">
             </span><span class="lit">58</span><span class="pln"> </span><span class="lit">9a</span><span class="pln">                                </span><span class="com"># bytes(154)</span><span class="pln">
                c289c5ca9b0460f9346ab4e42d842743  </span><span class="com"># authData</span><span class="pln">
                </span><span class="lit">404d31f4846825a6d065be597a87051d</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">410000000bf8a011f38c0a4d15800617</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">111f9edc7d00108959cead5b5c48164e</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">8abcd6d9435c6fa363616c6765455332</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">353661785820f7c4f4a6f1d79538dfa4</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                c9ac50848df708bc1c99f5e60e51b42a  </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">521b35d3b69a61795820de7b7d6ca564</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                e70ea321a4d5d96ea00ef0e2db89dd61  </span><span class="com"># ...</span><span class="pln">
                d4894c15ac585bd23684              </span><span class="com"># ...</span><span class="pln">
             </span><span class="lit">03</span><span class="pln">                                   </span><span class="com"># unsigned(3)</span><span class="pln">
             a3                                   </span><span class="com"># map(3)</span><span class="pln">
                </span><span class="lit">63</span><span class="pln">                                </span><span class="com"># text(3)</span><span class="pln">
                   </span><span class="lit">616c67</span><span class="pln">                         </span><span class="com"># "alg"</span><span class="pln">
                </span><span class="lit">26</span><span class="pln">                                </span><span class="com"># -7 (ES256)</span><span class="pln">
                </span><span class="lit">63</span><span class="pln">                                </span><span class="com"># text(3)</span><span class="pln">
                   </span><span class="lit">736967</span><span class="pln">                         </span><span class="com"># "sig"</span><span class="pln">
                </span><span class="lit">58</span><span class="pln"> </span><span class="lit">47</span><span class="pln">                             </span><span class="com"># bytes(71)</span><span class="pln">
                   </span><span class="lit">3045022013f73c5d9d530e8cc15cc</span><span class="pln">  </span><span class="com"># signature...</span><span class="pln">
                   </span><span class="lit">9bd96ad586d393664e462d5f05612</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                   </span><span class="lit">35e6350f2b728902210090357ff91</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                   </span><span class="lit">0ccb56ac5b596511948581c8fddb4</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                   a2b79959948078b09f4bdc6229     </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">63</span><span class="pln">                                </span><span class="com"># text(3)</span><span class="pln">
                   </span><span class="lit">783563</span><span class="pln">                         </span><span class="com"># "x5c"</span><span class="pln">
                </span><span class="lit">81</span><span class="pln">                                </span><span class="com"># array(1)</span><span class="pln">
                   </span><span class="lit">59</span><span class="pln"> </span><span class="lit">0197</span><span class="pln">                        </span><span class="com"># bytes(407)</span><span class="pln">
                      </span><span class="lit">3082019330820138a003020102</span><span class="pln">  </span><span class="com"># certificate...</span><span class="pln">
                      </span><span class="lit">020900859b726cb24b4c29300a</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">06082a8648ce3d040302304731</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">0b300906035504061302555331</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">143012060355040a0c0b597562</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">69636f20546573743122302006</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">0355040b0c1941757468656e74</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">696361746f7220417474657374</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">6174696f6e301e170d31363132</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">30343131353530305a170d3236</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">313230323131353530305a3047</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">310b3009060355040613025553</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">31143012060355040a0c0b5975</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">6269636f205465737431223020</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">060355040b0c1941757468656e</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">74696361746f72204174746573</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">746174696f6e3059301306072a</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">8648ce3d020106082a8648ce3d</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">03010703420004ad11eb0e8852</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      e53ad5dfed86b41e6134a18ec4  </span><span class="com"># ...</span><span class="pln">
                      e1af8f221a3c7d6e636c80ea13  </span><span class="com"># ...</span><span class="pln">
                      c3d504ff2e76211bb44525b196  </span><span class="com"># ...</span><span class="pln">
                      c44cb4849979cf6f896ecd2bb8  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">60de1bf4376ba30d300b300906</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">03551d1304023000300a06082a</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">8648ce3d040302034900304602</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">2100e9a39f1b03197525f7373e</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">10ce77e78021731b94d0c03f3f</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      da1fd22db3d030e7022100c4fa  </span><span class="com"># ...</span><span class="pln">
                      ec3445a820cf43129cdb00aabe  </span><span class="com"># ...</span><span class="pln">
                      fd9ae2d874f9c5d343cb2f113d  </span><span class="com"># ...</span><span class="pln">
                      a23723f3                    </span><span class="com"># ...</span><span class="pln">
       </span></pre>
      </aside>
      <aside class="example"><div class="example-title"><span>Example 5</span></div>
        The following is a complete encoding example of the
        <code>authenticatorGetAssertion</code> command and the corresponding
        <code>authenticatorGetAssertion_Response</code> response:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">          </span><span class="lit">02</span><span class="pln">                                      </span><span class="com"># authenticatorGetAssertion command</span><span class="pln">
          a4                                      </span><span class="com"># map(4)</span><span class="pln">
             </span><span class="lit">01</span><span class="pln">                                   </span><span class="com"># unsigned(1)</span><span class="pln">
             </span><span class="lit">68</span><span class="pln">                                   </span><span class="com"># text(8)</span><span class="pln">
                </span><span class="lit">61636d652e636f6d</span><span class="pln">                  </span><span class="com"># "acme.com"</span><span class="pln">
             </span><span class="lit">02</span><span class="pln">                                   </span><span class="com"># unsigned(2)</span><span class="pln">
             </span><span class="lit">58</span><span class="pln"> </span><span class="lit">20</span><span class="pln">                                </span><span class="com"># bytes(32)</span><span class="pln">
                </span><span class="lit">687134968222ec17202e42505f8ed2b1</span><span class="pln">  </span><span class="com"># clientDataHash</span><span class="pln">
                </span><span class="lit">6ae22f16bb05b88c25db9e602645f141</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
             </span><span class="lit">03</span><span class="pln">                                   </span><span class="com"># unsigned(3)</span><span class="pln">
             </span><span class="lit">82</span><span class="pln">                                   </span><span class="com"># array(2)</span><span class="pln">
                a2                                </span><span class="com"># map(2)</span><span class="pln">
                   </span><span class="lit">62</span><span class="pln">                             </span><span class="com"># text(2)</span><span class="pln">
                      </span><span class="lit">6964</span><span class="pln">                        </span><span class="com"># "id"</span><span class="pln">
                   </span><span class="lit">58</span><span class="pln"> </span><span class="lit">40</span><span class="pln">                          </span><span class="com"># bytes(64)</span><span class="pln">
                      f22006de4f905af68a43942f02  </span><span class="com"># credential ID</span><span class="pln">
                      </span><span class="lit">4f2a5ece603d9c6d4b3df8be08</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      ed01fc442646d034858ac75bed  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">3fd580bf9808d94fcbee82b9b2</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      ef6677af0adcc35852ea6b9e    </span><span class="com"># ...</span><span class="pln">
                   </span><span class="lit">64</span><span class="pln">                             </span><span class="com"># text(4)</span><span class="pln">
                      </span><span class="lit">74797065</span><span class="pln">                    </span><span class="com"># "type"</span><span class="pln">
                   </span><span class="lit">6a</span><span class="pln">                             </span><span class="com"># text(10)</span><span class="pln">
                      </span><span class="lit">7075626C69632D6B6579</span><span class="pln">        </span><span class="com"># "public-key"</span><span class="pln">
                a2                                </span><span class="com"># map(2)</span><span class="pln">
                   </span><span class="lit">62</span><span class="pln">                             </span><span class="com"># text(2)</span><span class="pln">
                      </span><span class="lit">6964</span><span class="pln">                        </span><span class="com"># "id"</span><span class="pln">
                   </span><span class="lit">58</span><span class="pln"> </span><span class="lit">32</span><span class="pln">                          </span><span class="com"># bytes(50)</span><span class="pln">
                      </span><span class="lit">03030303030303030303030303</span><span class="pln">  </span><span class="com"># credential ID</span><span class="pln">
                      </span><span class="lit">03030303030303030303030303</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">03030303030303030303030303</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                      </span><span class="lit">0303030303030303030303</span><span class="pln">      </span><span class="com"># ...</span><span class="pln">
                   </span><span class="lit">64</span><span class="pln">                             </span><span class="com"># text(4)</span><span class="pln">
                      </span><span class="lit">74797065</span><span class="pln">                    </span><span class="com"># "type"</span><span class="pln">
                   </span><span class="lit">6a</span><span class="pln">                             </span><span class="com"># text(10)</span><span class="pln">
                      </span><span class="lit">7075626C69632D6B6579</span><span class="pln">        </span><span class="com"># "public-key"</span><span class="pln">
             </span><span class="lit">05</span><span class="pln">                                   </span><span class="com"># unsigned(5)</span><span class="pln">
             a1                                   </span><span class="com"># map(1)</span><span class="pln">
                </span><span class="lit">62</span><span class="pln">                                </span><span class="com"># text(2)</span><span class="pln">
                   </span><span class="lit">747569</span><span class="pln">                         </span><span class="com"># "uv"</span><span class="pln">
                f5                                </span><span class="com"># true</span><span class="pln">
        </span></pre>
        <code>authenticatorGetAssertion_Response</code> response:
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">          </span><span class="lit">00</span><span class="pln">                                      </span><span class="com"># status = success</span><span class="pln">
          a3                                      </span><span class="com"># map(5)</span><span class="pln">
             </span><span class="lit">01</span><span class="pln">                                   </span><span class="com"># unsigned(1) - Credential</span><span class="pln">
             a2                                   </span><span class="com"># map(2)</span><span class="pln">
                </span><span class="lit">62</span><span class="pln">                                </span><span class="com"># text(2)</span><span class="pln">
                   </span><span class="lit">6964</span><span class="pln">                           </span><span class="com"># "id"</span><span class="pln">
                </span><span class="lit">58</span><span class="pln"> </span><span class="lit">40</span><span class="pln">                             </span><span class="com"># bytes(64)</span><span class="pln">
                   f22006de4f905af68a43942f024f2  </span><span class="com"># credentialId</span><span class="pln">
                   a5ece603d9c6d4b3df8be08ed01fc  </span><span class="com"># ...</span><span class="pln">
                   </span><span class="lit">442646d034858ac75bed3fd580bf9</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                   </span><span class="lit">808d94fcbee82b9b2ef6677af0adc</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                   c35852ea6b9e                   </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">64</span><span class="pln">                                </span><span class="com"># text(4)</span><span class="pln">
                   </span><span class="lit">74797065</span><span class="pln">                       </span><span class="com"># "type"</span><span class="pln">
                </span><span class="lit">6a</span><span class="pln">                                </span><span class="com"># text(10)</span><span class="pln">
                   </span><span class="lit">7075626C69632D6B6579</span><span class="pln">           </span><span class="com"># "public-key"</span><span class="pln">
             </span><span class="lit">02</span><span class="pln">                                   </span><span class="com"># unsigned(2)</span><span class="pln">
             </span><span class="lit">58</span><span class="pln"> </span><span class="lit">25</span><span class="pln">                                </span><span class="com"># bytes(37)</span><span class="pln">
                </span><span class="lit">625ddadf743f5727e66bba8c2e387922</span><span class="pln">  </span><span class="com"># authData</span><span class="pln">
                d1af43c503d9114a8fba104d84d02bfa  </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">0100000011</span><span class="pln">                        </span><span class="com"># ...</span><span class="pln">
             </span><span class="lit">03</span><span class="pln">                                   </span><span class="com"># unsigned(3)</span><span class="pln">
             </span><span class="lit">58</span><span class="pln"> </span><span class="lit">47</span><span class="pln">                                </span><span class="com"># bytes(71)</span><span class="pln">
                </span><span class="lit">304502204a5a9dd39298149d904769b5</span><span class="pln">  </span><span class="com"># signature</span><span class="pln">
                </span><span class="lit">1a451433006f182a34fbdf66de5fc717</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                d75fb350022100a46b8ea3c3b933821c  </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">6e7f5ef9daae94ab47f18db474c74790</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                eaabb14411e7a0                    </span><span class="com"># ...        </span><span class="pln">
             </span><span class="lit">04</span><span class="pln">                                   </span><span class="com"># unsigned(4) - publicKeyCredentialUserEntity</span><span class="pln">
             a4                                   </span><span class="com"># map(4)</span><span class="pln">
               </span><span class="lit">6b</span><span class="pln">                                 </span><span class="com"># text(11)</span><span class="pln">
                  </span><span class="lit">646973706c61794e616d65</span><span class="pln">          </span><span class="com"># "displayName"</span><span class="pln">
               </span><span class="lit">6d</span><span class="pln">                                 </span><span class="com"># text(13)</span><span class="pln">
                  </span><span class="lit">4a6f686e20502e20536d697468</span><span class="pln">      </span><span class="com"># "John P. Smith"</span><span class="pln">
               </span><span class="lit">64</span><span class="pln">                                 </span><span class="com"># text(4)</span><span class="pln">
                  </span><span class="lit">6e616d65</span><span class="pln">                        </span><span class="com"># "name"</span><span class="pln">
               </span><span class="lit">76</span><span class="pln">                                 </span><span class="com"># text(22)</span><span class="pln">
                  </span><span class="lit">6a6f686e70736d697468406578616d</span><span class="pln">  </span><span class="com"># "<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="1973767177696a74706d71597c61787469757c377a7674">[email&#160;protected]</a>"</span><span class="pln">
                  </span><span class="lit">706c652e636f6d</span><span class="pln">                  </span><span class="com"># ...</span><span class="pln">
               </span><span class="lit">62</span><span class="pln">                                 </span><span class="com"># text(2)</span><span class="pln">
                  </span><span class="lit">6964</span><span class="pln">                            </span><span class="com"># "id"</span><span class="pln">
                </span><span class="lit">58</span><span class="pln"> </span><span class="lit">20</span><span class="pln">                             </span><span class="com"># bytes(32)</span><span class="pln">
                  </span><span class="lit">3082019330820138a003020102</span><span class="pln">      </span><span class="com"># userid</span><span class="pln">
                  </span><span class="lit">3082019330820138a003020102</span><span class="pln">      </span><span class="com"># ...</span><span class="pln">
                  </span><span class="lit">308201933082</span><span class="pln">                    </span><span class="com"># ...</span><span class="pln">
                </span><span class="lit">64</span><span class="pln">                                </span><span class="com"># text(4)</span><span class="pln">
                  </span><span class="lit">69636f6e</span><span class="pln">                        </span><span class="com"># "icon"</span><span class="pln">
                </span><span class="lit">7828</span><span class="pln">                              </span><span class="com"># text(40)</span><span class="pln">
                  </span><span class="lit">68747470733a2f2f706963732e6163</span><span class="pln">  </span><span class="com"># "https://pics.acme.com/00/p/aBjjjpqPb.png"</span><span class="pln">
                  </span><span class="lit">6d652e636f6d2f30302f702f61426a</span><span class="pln">  </span><span class="com"># ...</span><span class="pln">
                  </span><span class="lit">6a6a707150622e706e67</span><span class="pln">            </span><span class="com"># ...           </span><span class="pln">
             </span><span class="lit">05</span><span class="pln">                                   </span><span class="com"># unsigned(5) - numberofCredentials</span><span class="pln">
             </span><span class="lit">01</span><span class="pln">                                   </span><span class="com"># unsigned(1) </span><span class="pln">
   </span></pre>
    </aside></section><!-- Commands -->
    <section id="responses">
      <h3 aria-level="2" role="heading" id="h3_responses"><span class="secno">6.2 </span>Responses</h3>
      <p>All responses are structured as:</p>
      <table class="simple">
        <tbody><tr>
          <th>Name</th>
          <th>Length</th>
          <th>Required?</th>
          <th>Definition</th>
        </tr>
        <tr>
          <td>Status</td>
          <td>1 byte</td>
          <td>Required</td>
          <td>The status of the response.  0x00 means success; all other values
            are errors.  See the table in the next section for error
            values.</td>
        </tr>
        <tr>
          <td>Response Data</td>
          <td>variable</td>
          <td>Optional</td>
          <td>CBOR encoded set of values.</td>
        </tr>
      </tbody></table>

      <p>Response data is encoded using a CBOR map (CBOR major type 5).
        The CBOR map must be encoded using the definite length variant.</p>

      <p>For each response message, the map keys and value types are specified
        below:</p>

      <table class="simple">
        <tbody><tr>
          <th>Response Message</th>
          <th>Member Name</th>
          <th>Key</th>
          <th>Value type</th>
        </tr>
        <tr>
          <td>authenticatorMakeCredential_Response</td>
          <td>fmt</td>
          <td>0x01</td>
          <td>text string (CBOR major type 3).</td>
        </tr>
        <tr>
          <td></td>
          <td>authData</td>
          <td>0x02</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>attStmt</td>
          <td>0x03</td>
          <td>definite length map (CBOR major type 5).</td>
        </tr>
        <tr><td></td><td></td><td></td><td></td></tr>
        <tr>
          <td>authenticatorGetAssertion_Response</td>
          <td>credential</td>
          <td>0x01</td>
          <td>definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>authData</td>
          <td>0x02</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>signature</td>
          <td>0x03</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>publicKeyCredentialUserEntity</td>
          <td>0x04</td>
          <td>definite length map (CBOR major type 5). <em class="rfc2119" title="MUST">MUST</em> not be present if UV bit is not set.</td>
        </tr>
        <tr>
          <td></td>
          <td>numberOfCredentials</td>
          <td>0x05</td>
          <td>unsigned integer(CBOR major type 0).</td>
        </tr>
        <tr><td></td><td></td><td></td><td></td></tr>
        <tr>
          <td>authenticatorGetNextAssertion_Response</td>
          <td>credential</td>
          <td>0x01</td>
          <td>definite length map (CBOR major type 5).</td>
        </tr>
        <tr>
          <td></td>
          <td>authData</td>
          <td>0x02</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>signature</td>
          <td>0x03</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>publicKeyCredentialUserEntity</td>
          <td>0x04</td>
          <td>definite length map (CBOR major type 5).</td>
        </tr>
        <tr><td></td><td></td><td></td><td></td></tr>
        <tr>
          <td>authenticatorGetInfo_Response</td>
          <td>versions</td>
          <td>0x01</td>
          <td>definite length array (CBOR major type 4) of UTF-8 encoded
            strings (CBOR major type 3).</td>
        </tr>
        <tr>
          <td></td>
          <td>extensions</td>
          <td>0x02</td>
          <td>definite length array (CBOR major type 4) of UTF-8 encoded
            strings (CBOR major type 3).</td>
        </tr>
        <tr>
          <td></td>
          <td>aaguid</td>
          <td>0x03</td>
          <td>byte string (CBOR major type 2). 16 bytes in length and encoded the same as MakeCredential AuthenticatorData, as specified in [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].</td>
        </tr>
        <tr>
          <td></td>
          <td>options</td>
          <td>0x04</td>
          <td>Definite length map (CBOR major type 5) of key-value pairs where
            keys are UTF8 strings (CBOR major type 3) and values are booleans
            (CBOR simple value 21).</td>
        </tr>
        <tr>
          <td></td>
          <td>maxMsgSize</td>
          <td>0x05</td>
          <td>CBOR definite length array (CBOR major type 4) of CBOR unsigned integers (CBOR major type 0)
	    This is the maximum message size supported by the authenticator.</td>
        </tr>
        <tr>
          <td></td>
          <td>pinProtocols</td>
          <td>0x06</td>
          <td>array of unsigned integers (CBOR major type). This is the list of pinProtocols supported by the Authenticator.</td>
        </tr>
		
        <tr><td></td><td></td><td></td><td></td></tr>
        <tr>
          <td>authenticatorClientPIN_Response</td>
          <td>keyAgreement</td>
          <td>0x01</td>
          <td>Authenticator public key in COSE_KEY format.</td>
        </tr>
        <tr>
          <td></td>
          <td><a href="#pinToken">pinToken</a></td>
          <td>0x02</td>
          <td>byte string (CBOR major type 2).</td>
        </tr>
        <tr>
          <td></td>
          <td>retries</td>
          <td>0x03</td>
          <td>Unsigned integer (CBOR major type 0). This is number of retries left before lockout.</td>
        </tr>
        <tr><td></td><td></td><td></td><td></td></tr>
      </tbody></table>
    </section> <!-- Responses -->
    <section id="error-responses">
      <h3 aria-level="2" role="heading" id="h3_error-responses"><span class="secno">6.3 </span>Error Responses</h3>
      <p>
        The error response values range from 0x01 - 0xff.  This range is
        split based on error type.
      </p>

      <p>
        Error response values in the range between <strong>CTAP2_OK</strong>
        and <strong>CTAP2_ERR_SPEC_LAST</strong> are reserved for spec purposes.
      </p>

      <p>
        Error response values in the range between <strong>CTAP2_ERR_VENDOR_FIRST</strong>
        and <strong>CTAP2_ERR_VENDOR_LAST</strong> may be used for vendor-specific implementations.
        All other response values are reserved for future use and may not be used.
        These vendor specific error codes are not interoperable and the platform should treat
        these errors as any other unknown error codes.
      </p>

      <p>
        Error response values in the range between <strong>CTAP2_ERR_EXTENSION_FIRST</strong>
        and <strong>CTAP2_ERR_EXTENSION_LAST</strong> may be used for extension-specific implementations.
        These errors need to be interoperable for vendors who decide to implement such optional extension.
      </p>

      <table class="simple">
        <tbody><tr>
          <th>Code</th>
          <th>Name</th>
          <th>Description</th>
        </tr>
        <tr>
          <td>0x00</td>
          <td>CTAP1_ERR_SUCCESS</td>
          <td>Indicates successful response.</td>
        </tr>
        <tr>
          <td>0x01</td>
          <td>CTAP1_ERR_INVALID_COMMAND</td>
          <td>The command is not a valid CTAP command.</td>
        </tr>
        <tr>
          <td>0x02</td>
          <td>CTAP1_ERR_INVALID_PARAMETER</td>
          <td>The command included an invalid parameter.</td>
        </tr>
        <tr>
          <td>0x03</td>
          <td>CTAP1_ERR_INVALID_LENGTH</td>
          <td>Invalid message or item length.</td>
        </tr>
        <tr>
          <td>0x04</td>
          <td>CTAP1_ERR_INVALID_SEQ</td>
          <td>Invalid message sequencing.</td>
        </tr>
        <tr>
          <td>0x05</td>
          <td>CTAP1_ERR_TIMEOUT</td>
          <td>Message timed out.</td>
        </tr>
        <tr>
          <td>0x06</td>
          <td>CTAP1_ERR_CHANNEL_BUSY</td>
          <td>Channel busy.</td>
        </tr>
        <tr>
          <td>0x0A</td>
          <td>CTAP1_ERR_LOCK_REQUIRED</td>
          <td>Command requires channel lock.</td>
        </tr>
        <tr>
          <td>0x0B</td>
          <td>CTAP1_ERR_INVALID_CHANNEL</td>
          <td>Command not allowed on this cid.</td>
        </tr>
        <tr>
          <td>0x10</td>
          <td>CTAP2_ERR_CBOR_PARSING</td>
          <td>Error while parsing CBOR.</td>
        </tr>
        <tr>
          <td>0x11</td>
          <td>CTAP2_ERR_CBOR_UNEXPECTED_TYPE</td>
          <td>Invalid/unexpected CBOR error.</td>
        </tr>
        <tr>
          <td>0x12</td>
          <td>CTAP2_ERR_INVALID_CBOR</td>
          <td>Error when parsing CBOR.</td>
        </tr>
        <tr>
          <td>0x13</td>
          <td>CTAP2_ERR_INVALID_CBOR_TYPE</td>
          <td>Invalid or unexpected CBOR type.</td>
        </tr>
        <tr>
          <td>0x14</td>
          <td>CTAP2_ERR_MISSING_PARAMETER</td>
          <td>Missing non-optional parameter.</td>
        </tr>
        <tr>
          <td>0x15</td>
          <td>CTAP2_ERR_LIMIT_EXCEEDED</td>
          <td>Limit for number of items exceeded.</td>
        </tr>
        <tr>
          <td>0x16</td>
          <td>CTAP2_ERR_UNSUPPORTED_EXTENSION</td>
          <td>Unsupported extension.</td>
        </tr>
        <tr>
          <td>0x17</td>
          <td>CTAP2_ERR_TOO_MANY_ELEMENTS</td>
          <td>Limit for number of items exceeded.</td>
        </tr>
        <tr>
          <td>0x18</td>
          <td>CTAP2_ERR_EXTENSION_NOT_SUPPORTED</td>
          <td>Unsupported extension.</td>
        </tr>
        <tr>
          <td>0x19</td>
          <td>CTAP2_ERR_CREDENTIAL_EXCLUDED</td>
          <td>Valid credential found in the exludeList.</td>
        </tr>
        <tr>
          <td>0x20</td>
          <td>CTAP2_ERR_CREDENTIAL_NOT_VALID</td>
          <td>Credential not valid for authenticator.</td>
        </tr>
        <tr>
          <td>0x21</td>
          <td>CTAP2_ERR_PROCESSING</td>
          <td>Processing (Lengthy operation is in progress).</td>
        </tr>
        <tr>
          <td>0x22</td>
          <td>CTAP2_ERR_INVALID_CREDENTIAL</td>
          <td>Credential not valid for the authenticator.</td>
        </tr>
        <tr>
          <td>0x23</td>
          <td>CTAP2_ERR_USER_ACTION_PENDING</td>
          <td>Authentication is waiting for user interaction.</td>
        </tr>
        <tr>
          <td>0x24</td>
          <td>CTAP2_ERR_OPERATION_PENDING</td>
          <td>Processing, lengthy operation is in progress.</td>
        </tr>
        <tr>
          <td>0x25</td>
          <td>CTAP2_ERR_NO_OPERATIONS</td>
          <td>No request is pending.</td>
        </tr>
        <tr>
          <td>0x26</td>
          <td>CTAP2_ERR_UNSUPPORTED_ALGORITHM</td>
          <td>Authenticator does not support requested algorithm.</td>
        </tr>
        <tr>
          <td>0x27</td>
          <td>CTAP2_ERR_OPERATION_DENIED</td>
          <td>Not authorized for requested operation.</td>
        </tr>
        <tr>
          <td>0x28</td>
          <td>CTAP2_ERR_KEY_STORE_FULL</td>
          <td>Internal key storage is full.</td>
        </tr>
        <tr>
          <td>0x29</td>
          <td>CTAP2_ERR_NOT_BUSY</td>
          <td>Authenticator cannot cancel as it is not busy.</td>
        </tr>
        <tr>
          <td>0x2A</td>
          <td>CTAP2_ERR_NO_OPERATION_PENDING</td>
          <td>No outstanding operations.</td>
        </tr>
        <tr>
          <td>0x2B</td>
          <td>CTAP2_ERR_UNSUPPORTED_OPTION</td>
          <td>Unsupported option.</td>
        </tr>
        <tr>
          <td>0x2C</td>
          <td>CTAP2_ERR_INVALID_OPTION</td>
          <td>Unsupported option.</td>
        </tr>
        <tr>
          <td>0x2D</td>
          <td>CTAP2_ERR_KEEPALIVE_CANCEL</td>
          <td>Pending keep alive was cancelled.</td>
        </tr>
        <tr>
          <td>0x2E</td>
          <td>CTAP2_ERR_NO_CREDENTIALS</td>
          <td>No valid credentials provided.</td>
        </tr>
        <tr>
          <td>0x2F</td>
          <td>CTAP2_ERR_USER_ACTION_TIMEOUT</td>
          <td>Timeout waiting for user interaction.</td>
        </tr>
        <tr>
          <td>0x30</td>
          <td>CTAP2_ERR_NOT_ALLOWED</td>
          <td>Continuation command, such as, authenticatorGetNextAssertion not allowed.</td>
        </tr>
        <tr>
          <td>0x31</td>
          <td>CTAP2_ERR_PIN_INVALID</td>
          <td>PIN Blocked.</td>
        </tr>
        <tr>
          <td>0x32</td>
          <td>CTAP2_ERR_PIN_BLOCKED</td>
          <td>PIN Blocked.</td>
        </tr>
        <tr>
          <td>0x33</td>
          <td>CTAP2_ERR_PIN_AUTH_INVALID</td>
          <td>PIN authentication,<a href="#pinAuth">pinAuth</a>, verification failed.</td>
        </tr>
        <tr>
          <td>0x34</td>
          <td>CTAP2_ERR_PIN_AUTH_BLOCKED</td>
          <td>PIN authentication,<a href="#pinAuth">pinAuth</a>, blocked. Requires power recycle to reset.</td>
        </tr>
        <tr>
          <td>0x35</td>
          <td>CTAP2_ERR_PIN_NOT_SET</td>
          <td>No PIN has been set.</td>
        </tr>
        <tr>
          <td>0x36</td>
          <td>CTAP2_ERR_PIN_REQUIRED</td>
          <td>PIN is required for the selected operation.</td>
        </tr>
        <tr>
          <td>0x37</td>
          <td>CTAP2_ERR_PIN_POLICY_VIOLATION</td>
          <td>PIN policy violation. Currently only enforces minimum length.</td>
        </tr>
        <tr>
          <td>0x38</td>
          <td>CTAP2_ERR_PIN_TOKEN_EXPIRED</td>
          <td>pinToken expired on authenticator.</td>
        </tr>
        <tr>
          <td>0x39</td>
          <td>CTAP2_ERR_REQUEST_TOO_LARGE</td>
          <td>Authenticator cannot handle this request due to memory constraints.</td>
        </tr>
        <tr>
          <td>0x7F</td>
          <td>CTAP1_ERR_OTHER</td>
          <td>Other unspecified error.</td>
        </tr>
        <tr>
          <td>0xDF</td>
          <td>CTAP2_ERR_SPEC_LAST</td>
          <td>CTAP 2 spec last error.</td>
        </tr>
        <tr>
          <td>0xE0</td>
          <td>CTAP2_ERR_EXTENSION_FIRST</td>
          <td>Extension specific error.</td>
        </tr>
        <tr>
          <td>0xEF</td>
          <td>CTAP2_ERR_EXTENSION_LAST</td>
          <td>Extension specific error.</td>
        </tr>
        <tr>
          <td>0xF0</td>
          <td>CTAP2_ERR_VENDOR_FIRST</td>
          <td>Vendor specific error.</td>
        </tr>
        <tr>
          <td>0xFF</td>
          <td>CTAP2_ERR_VENDOR_LAST</td>
          <td>Vendor specific error.</td>
        </tr>
      </tbody></table>
    </section> <!-- Error Responses -->
  </section> <!-- Message encoding -->

  <section id="interoperating-with-ctap1-u2f-authenticators">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_interoperating-with-ctap1-u2f-authenticators"><span class="secno">7. </span>Interoperating with CTAP1/U2F authenticators</h2>
    <p>
      This section defines how a platform maps CTAP2 requests to CTAP1/U2F requests
      and CTAP1/U2F responses to CTAP2 responses in order to support CTAP1/U2F
      authenticators via CTAP2.
      CTAP2 requests can be mapped to CTAP1/U2F requests provided the CTAP2
      request does not have parameters that only CTAP2 authenticators can fulfill.
      The processes for RPs to use to verify CTAP1/U2F based authenticatorMakeCredential
      and authenticatorGetAssertion responses are also defined below.
      Platform may choose to skip this feature and work only with CTAP devices.
    </p>
    <section id="using-the-ctap2-authenticatormakecredential-command-with-ctap1-u2f-authenticators">
      <h3 aria-level="2" role="heading" id="h3_using-the-ctap2-authenticatormakecredential-command-with-ctap1-u2f-authenticators"><span class="secno">7.1 </span>Using the CTAP2 authenticatorMakeCredential Command with CTAP1/U2F authenticators</h3>
      <p>
        Platform follows the following procedure
        <a href="#fig-u2f-compat-makeCredential" class="fig-ref">(Fig: Mapping: WebAuthn
        authenticatorMakeCredential to and from CTAP1/U2F Registration Messages)</a>:
      </p>
      <ol>
        <li>
          Platform tries to get information about the authenticator by sending authenticatorGetInfo command
          as specified in <a href="#CTAP2ProtocolOverview"> CTAP2 protocol overview</a>.
          <ul>
            <li>
              CTAP1/U2F authenticator returns a command error or improperly formatted CBOR response.
              For any failure, platform may fall back to CTAP1/U2F protocol.
            </li>
          </ul>
        </li>
        <li>
          Map CTAP2 authenticatorMakeCredential request to
          <a href="https://fidoalliance.org/specs/fido-u2f-v1.1-id-20160915/fido-u2f-raw-message-formats-v1.1-id-20160915.html#registration-request-message---u2f_register">
          U2F_REGISTER
          </a>
          request.
          <ul>
            <li>
              Platform verifies that CTAP2 request does not have any parameters
              that CTAP1/U2F authenticators cannot fulfill.
              <ul>
                <li>
                  All of the below conditions must be true for the platform to proceed to next step.
                  If any of the below conditions is not true,
                  platform errors out with CTAP2_ERR_OPTION_NOT_SUPPORTED.
                  <ul>
                    <li>pubKeyCredParams must use the ES256 algorithm (-7).</li>
                    <li>Options must not include "rk" set to true.</li>
                    <li>Options must not include "uv" set to true.</li>
                  </ul>
                </li>
                <li>
                  If excludeList is not empty:
                  <ul>
                    <li>
                      If the excludeList is not empty, the platform must send signing
                      request with check-only control byte to the CTAP1/U2F authenticator
                      using each of the credential ids (key handles) in the excludeList.
                      If any of them does not result in an error,
                      that means that this is a known device.
                      Afterwards, the platform must still send a dummy registration request
                      (with a dummy appid and invalid challenge) to CTAP1/U2F authenticators
                      that it believes are excluded.
                      This makes it so the user still needs to touch the CTAP1/U2F authenticator
                      before the RP gets told that the token is already registered.
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>Use clientDataHash parameter of CTAP2 request as CTAP1/U2F challenge parameter (32 bytes).</li>
            <li>
              Let <code>rpIdHash</code> be a byte array of size 32 initialized
              with SHA-256 hash of <code>rp.id</code>
              parameter as CTAP1/U2F application parameter (32 bytes).
            </li>
          </ul>
        </li>
        <li>
          Send the U2F_REGISTER request to the authenticator as specified in [<cite><a class="bibref" href="#bib-U2FRawMsgs">U2FRawMsgs</a></cite>] spec.
        </li>
        <li>
          Map the U2F registration response message
          (see the "Registration Response Message: Success" section of [<cite><a class="bibref" href="#bib-U2FRawMsgs">U2FRawMsgs</a></cite>])
          to a CTAP2 authenticatorMakeCredential response message:
          <ul>
            <li>
              Generate <code>authenticatorData</code> from the
              <a href="https://fidoalliance.org/specs/fido-u2f-v1.2-ps-20170411/fido-u2f-raw-message-formats-v1.2-ps-20170411.html#registration-response-message-success">
              U2F registration response message</a> received from the authenticator:
              <ul>
                <li>
                  Initialize <code>attestationData</code>:
                  <ul>
                    <li>
                      Let <code>credentialIdLength</code> be a 2-byte unsigned
                      big-endian integer representing length of the Credential ID
                      initialized with CTAP1/U2F response key handle length.
                    </li>
                    <li>
                      Let <code>credentialID</code> be a <code>credentialIdLength</code>
                      byte array initialized with CTAP1/U2F response key handle bytes.</li>
                    <li>
                      Let <code>x9encodedUserPublicKey</code>be the <code>user public key</code>
                      returned in the U2F registration response message
                      [<cite><a class="bibref" href="#bib-U2FRawMsgs">U2FRawMsgs</a></cite>]. Let <code>coseEncodedCredentialPublicKey</code>
                      be the result of converting <code>x9encodedUserPublicKey</code>'s value
                      from ANS X9.62 / Sec-1 v2 uncompressed curve point representation
                      [<cite><a class="bibref" href="#bib-SEC1V2">SEC1V2</a></cite>] to COSE_Key representation ([<cite><a class="bibref" href="#bib-RFC8152">RFC8152</a></cite>] Section 7).
                    </li>
                    <li>
                      Let <code>attestationData</code> be a byte array with following structure:
                      <table class="simple">
                        <tbody><tr>
                          <th>Length (in bytes)</th>
                          <th>Description</th>
                          <th>Value</th>
                        </tr>
                        <tr>
                          <td>16</td>
                          <td>The AAGUID of the authenticator.</td>
                          <td>Initialized with all zeros.</td>
                        </tr>
                        <tr>
                          <td>2</td>
                          <td>Byte length L of Credential ID</td>
                          <td>Initialized with <code>credentialIdLength</code> bytes.
                          </td>
                        </tr>
                        <tr>
                          <td><code>credentialIdLength</code></td>
                          <td>Credential ID.</td>
                          <td>Initialized with <code>credentialID</code> bytes.</td>
                        </tr>
                        <tr>
                          <td>77</td>
                          <td>The credential public key.</td>
                          <td>Initialized with <code>coseEncodedCredentialPublicKey</code> bytes.</td>
                        </tr>
                      </tbody></table>
                    </li>
                  </ul>
                </li>
                <li>
                  Initialize <code>authenticatorData</code>:
                  <ul>
                    <li>
                      Let <code>flags</code> be a byte whose zeroth bit (bit 0, UP) is set,
                      and whose sixth bit (bit 6, AT) is set,
                      and all other bits are zero (bit zero is the least significant bit).
                      See also Authenticator Data section of [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].
                    </li>
                    <li>Let <code>signCount</code> be a 4-byte unsigned integer initialized to zero.</li>
                    <li>
                      Let <code>authenticatorData</code> be a byte array with the following structure:
                      <table class="simple">
                        <tbody><tr>
                          <th>Length (in bytes)</th>
                          <th>Description</th>
                          <th>Value</th>
                        </tr>
                        <tr>
                          <td>32</td>
                          <td>
                            SHA-256 hash of the
                            <a href="https://www.w3.org/TR/webauthn/#rp-id"><code>rp.id</code></a>.
                          </td>
                          <td>Initialized with <code>rpIdHash</code> bytes.</td>
                        </tr>
                        <tr>
                          <td>1</td>
                          <td>Flags</td>
                          <td>
                            Initialized with <code>flags</code>' value.
                          </td>
                        </tr>
                        <tr>
                          <td>4</td>
                          <td>Signature counter (signCount).</td>
                          <td>Initialized with <code>signCount</code> bytes.</td>
                        </tr>
                        <tr>
                          <td>Variable Length</td>
                          <td>
                            <a href="https://www.w3.org/TR/webauthn/#attestation-data">Attestation Data</a>.
                          </td>
                          <td>Initialized with <code>attestationData</code>'s value.</td>
                        </tr>
                      </tbody></table>
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              Let <code>attestationStatement</code> be a CBOR map
              (see "attStmtTemplate" in
              <a href="https://www.w3.org/TR/webauthn/#generating-an-attestation-object">
              Generating an Attestation Object
              </a>
              [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>]) with the following keys whose values are as
              follows:
              <ul>
                <li>
                  Set "x5c" as an array of the one attestation cert extracted
                  from CTAP1/U2F response.
                </li>
                <li>
                  Set "sig"'s value to be the "signature" bytes from the U2F
                  registration response message [<cite><a class="bibref" href="#bib-U2FRawMsgs">U2FRawMsgs</a></cite>].
                </li>
              </ul>
            </li>
            <li>
              Let <code>attestationObject</code> be a CBOR map
              (see "attObj" in 
              <a href="https://www.w3.org/TR/webauthn/#generating-an-attestation-object">
              Attestation object
              </a>
              [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>]) with the following keys whose values are as
              follows:
              <ul>
                <li>Set "authData"'s value to <code>authenticatorData</code>.</li>
                <li>Set "fmt"'s value to "fido-u2f".</li>
                <li>Set "attStmt"'s value to <code>attestationStatement</code>.</li>
              </ul>
            </li>
          </ul>
        </li>
        <li>Return <code>attestationObject</code> to the caller.</li>
      </ol>
      <aside class="example"><div class="example-title"><span>Example 6</span></div>
        Sample CTAP2 authenticatorMakeCredential Request (CBOR):
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pun">{</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'687134968222EC17202E42505F8ED2B16AE22F16BB05B88C25DB9E602645F141'</span><span class="pun">,</span><span class="pln">
 </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"acme.com"</span><span class="pun">,</span><span class="pln">
     </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"acme.com"</span><span class="pun">},</span><span class="pln">
 </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"1098237235409872"</span><span class="pun">,</span><span class="pln">
     </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4e242126203e3d23273a260e2b362f233e222b602d2123">[email&#160;protected]</a>"</span><span class="pun">,</span><span class="pln">
     </span><span class="str">"icon"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"https://pics.acme.com/00/p/aBjjjpqPb.png"</span><span class="pun">,</span><span class="pln">
     </span><span class="str">"displayName"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"John P. Smith"</span><span class="pun">},</span><span class="pln">
 </span><span class="lit">4</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[{</span><span class="str">"type"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"public-key"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"alg"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">7</span><span class="pun">},</span><span class="pln">
     </span><span class="pun">{</span><span class="str">"type"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"public-key"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"alg"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">257</span><span class="pun">}]}</span><span class="pln">
        </span></pre>
        CTAP1/U2F Request from above CTAP2 authenticatorMakeCredential request
        <pre class="highlight prettyprint prettyprinted" style=""><span class="lit">687134968222EC17202E42505F8ED2B16AE22F16BB05B88C25DB9E602645F141</span><span class="pln">    </span><span class="com"># clientdatahash</span><span class="pln">
</span><span class="lit">1194228DA8FDBDEEFD261BD7B6595CFD70A50D70C6407BCF013DE96D4EFB17DE</span><span class="pln">    </span><span class="com"># rpidhash</span><span class="pln">
        </span></pre>
        Sample CTAP1/U2F Response from the device
        <pre class="highlight prettyprint prettyprinted" style=""><span class="lit">05</span><span class="pln">                                                                  </span><span class="com"># Reserved Byte (1 Byte)</span><span class="pln">
</span><span class="lit">04E87625896EE4E46DC032766E8087962F36DF9DFE8B567F3763015B1990A60E</span><span class="pln">    </span><span class="com"># User Public Key (65 Bytes)</span><span class="pln">
</span><span class="lit">1427DE612D66418BDA1950581EBC5C8C1DAD710CB14C22F8C97045F4612FB20C</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">91</span><span class="pln">                                                                  </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">40</span><span class="pln">                                                                  </span><span class="com"># Key Handle Length (1 Byte)</span><span class="pln">
</span><span class="lit">3EBD89BF77EC509755EE9C2635EFAAAC7B2B9C5CEF1736C3717DA48534C8C6B6</span><span class="pln">    </span><span class="com"># Key Handle (Key Handle Length Bytes)</span><span class="pln">
</span><span class="lit">54D7FF945F50B5CC4E78055BDD396B64F78DA2C5F96200CCD415CD08FE420038</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">3082024A30820132A0030201020204046C8822300D06092A864886F70D01010B</span><span class="pln">    </span><span class="com"># X.509 Cert (Variable length Cert)</span><span class="pln">
</span><span class="lit">0500302E312C302A0603550403132359756269636F2055324620526F6F742043</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">412053657269616C203435373230303633313020170D31343038303130303030</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">30305A180F32303530303930343030303030305A302C312A302806035504030C</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">2159756269636F205532462045452053657269616C2032343931383233323437</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">37303059301306072A8648CE3D020106082A8648CE3D030107034200043CCAB9</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">2CCB97287EE8E639437E21FCD6B6F165B2D5A3F3DB131D31C16B742BB476D8D1</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
E99080EB546C9BBDF556E6210FD42785899E78CC589EBE310F6CDB9FF4A33B30    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">39302206092B0601040182C40A020415312E332E362E312E342E312E34313438</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">322E312E323013060B2B0601040182E51C020101040403020430300D06092A86</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">4886F70D01010B050003820101009F9B052248BC4CF42CC5991FCAABAC9B651B</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
BE5BDCDC8EF0AD2C1C1FFB36D18715D42E78B249224F92C7E6E7A05C49F0E7E4    </span><span class="com"># ...</span><span class="pln">
C881BF2E94F45E4A21833D7456851D0F6C145A29540C874F3092C934B43D222B    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">8962C0F410CEF1DB75892AF116B44A96F5D35ADEA3822FC7146F6004385BCB69</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
B65C99E7EB6919786703C0D8CD41E8F75CCA44AA8AB725AD8E799FF3A8696A6F    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">1B2656E631B1E40183C08FDA53FA4A8F85A05693944AE179A1339D002D15CABD</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">810090EC722EF5DEF9965A371D415D624B68A2707CAD97BCDD1785AF97E258F3</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">3DF56A031AA0356D8E8D5EBCADC74E071636C6B110ACE5CC9B90DFEACAE640FF</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">1BB0F1FE5DB4EFF7A95F060733F5</span><span class="pln">                                        </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">30450220324779C68F3380288A1197B6095F7A6EB9B1B1C127F66AE12A99FE85</span><span class="pln">    </span><span class="com"># Signature (variable Length)</span><span class="pln">
</span><span class="lit">32EC23B9022100E39516AC4D61EE64044D50B415A6A4D4D84BA6D895CB5AB7A1</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
AA7D081DE341FA                                                      </span><span class="com"># ...</span><span class="pln">
        </span></pre>
        Authenticator Data from CTAP1/U2F Response
        <pre class="highlight prettyprint prettyprinted" style=""><span class="lit">1194228DA8FDBDEEFD261BD7B6595CFD70A50D70C6407BCF013DE96D4EFB17DE</span><span class="pln">    </span><span class="com"># rpidhash</span><span class="pln">
</span><span class="lit">41</span><span class="pln">                                                                  </span><span class="com"># flags</span><span class="pln">
</span><span class="lit">00000000</span><span class="pln">                                                            </span><span class="com"># Sign Count</span><span class="pln">
</span><span class="lit">00000000000000000000000000000000</span><span class="pln">                                    </span><span class="com"># AAGUID</span><span class="pln">
</span><span class="lit">0040</span><span class="pln">                                                                </span><span class="com"># Key Handle Length (1 Byte)</span><span class="pln">
</span><span class="lit">3EBD89BF77EC509755EE9C2635EFAAAC7B2B9C5CEF1736C3717DA48534C8C6B6</span><span class="pln">    </span><span class="com"># Key Handle (Key Handle Length Bytes)</span><span class="pln">
</span><span class="lit">54D7FF945F50B5CC4E78055BDD396B64F78DA2C5F96200CCD415CD08FE420038</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
A5010203262001215820E87625896EE4E46DC032766E8087962F36DF9DFE8B56    </span><span class="com"># Public Key</span><span class="pln">
</span><span class="lit">7F3763015B1990A60E1422582027DE612D66418BDA1950581EBC5C8C1DAD710C</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
B14C22F8C97045F4612FB20C91                                          </span><span class="com"># ...</span><span class="pln">
        </span></pre>
        Mapped CTAP2 authenticatorMakeCredential response(CBOR)
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pun">{</span><span class="str">"fmt"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"fido-u2f"</span><span class="pun">,</span><span class="pln">
 </span><span class="str">"authData"</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'1194228DA8FDBDEEFD261BD7B6595CFD70A50D70C6407BCF013DE96D4EFB17DE
               41000000000000000000000000000000000000000000403EBD89BF77EC509755
               EE9C2635EFAAAC7B2B9C5CEF1736C3717DA48534C8C6B654D7FF945F50B5CC4E
               78055BDD396B64F78DA2C5F96200CCD415CD08FE420038A50102032620012158
               20E87625896EE4E46DC032766E8087962F36DF9DFE8B567F3763015B1990A60E
               1422582027DE612D66418BDA1950581EBC5C8C1DAD710CB14C22F8C97045F461
               2FB20C91'</span><span class="pun">,</span><span class="pln">
 </span><span class="str">"attStmt"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="str">"sig"</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'30450220324779C68F3380288A1197B6095F7A6EB9B1B1C127F66AE12A99FE85
              32EC23B9022100E39516AC4D61EE64044D50B415A6A4D4D84BA6D895CB5AB7A1
              AA7D081DE341FA'</span><span class="pun">,</span><span class="pln">
             </span><span class="str">"x5c"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="pln">h</span><span class="str">'3082024A30820132A0030201020204046C8822300D06092A864886F70D01010B
                       0500302E312C302A0603550403132359756269636F2055324620526F6F742043
                       412053657269616C203435373230303633313020170D31343038303130303030
                       30305A180F32303530303930343030303030305A302C312A302806035504030C
                       2159756269636F205532462045452053657269616C2032343931383233323437
                       37303059301306072A8648CE3D020106082A8648CE3D030107034200043CCAB9
                       2CCB97287EE8E639437E21FCD6B6F165B2D5A3F3DB131D31C16B742BB476D8D1
                       E99080EB546C9BBDF556E6210FD42785899E78CC589EBE310F6CDB9FF4A33B30
                       39302206092B0601040182C40A020415312E332E362E312E342E312E34313438
                       322E312E323013060B2B0601040182E51C020101040403020430300D06092A86
                       4886F70D01010B050003820101009F9B052248BC4CF42CC5991FCAABAC9B651B
                       BE5BDCDC8EF0AD2C1C1FFB36D18715D42E78B249224F92C7E6E7A05C49F0E7E4
                       C881BF2E94F45E4A21833D7456851D0F6C145A29540C874F3092C934B43D222B
                       8962C0F410CEF1DB75892AF116B44A96F5D35ADEA3822FC7146F6004385BCB69
                       B65C99E7EB6919786703C0D8CD41E8F75CCA44AA8AB725AD8E799FF3A8696A6F
                       1B2656E631B1E40183C08FDA53FA4A8F85A05693944AE179A1339D002D15CABD
                       810090EC722EF5DEF9965A371D415D624B68A2707CAD97BCDD1785AF97E258F3
                       3DF56A031AA0356D8E8D5EBCADC74E071636C6B110ACE5CC9B90DFEACAE640FF
                       1BB0F1FE5DB4EFF7A95F060733F5'</span><span class="pun">]}}</span><span class="pln">
        </span></pre>
      </aside>
      <figure id="fig-u2f-compat-makeCredential">
        <img src="img/u2fcompat-makecredential.svg" alt="CTAP1/U2F Register - authenticatorMakeCredential Compat.">
        <figcaption>Fig. <span class="figno">2</span> <span class="fig-title">Mapping: WebAuthn authenticatorMakeCredential to and from CTAP1/U2F Registration Messages.</span></figcaption>
      </figure>
    </section>
    <section id="using-the-ctap2-authenticatorgetassertion-command-with-ctap1-u2f-authenticators">
      <h3 aria-level="2" role="heading" id="h3_using-the-ctap2-authenticatorgetassertion-command-with-ctap1-u2f-authenticators"><span class="secno">7.2 </span>Using the CTAP2 authenticatorGetAssertion Command with CTAP1/U2F authenticators</h3>
      <p>
        Platform follows the following procedure
        <a href="#fig-u2f-compat-getAssertion" class="fig-ref">
        (Fig: Mapping: WebAuthn authenticatorGetAssertion to and from CTAP1/U2F Authentication Messages)
        </a>:
      </p>
      <ol>
        <li>
          Platform tries to get information about the authenticator by sending
          authenticatorGetInfo command
          as specified in <a href="#CTAP2ProtocolOverview"> CTAP2 protocol overview</a>.
          <ul>
            <li>
              CTAP1/U2F authenticator returns a command error or improperly formatted CBOR response.
              For any failure, platform may fall back to CTAP1/U2F protocol.
            </li>
          </ul>
        </li>
        <li>
          Map CTAP2 authenticatorGetAssertion request to
          <a href="https://fidoalliance.org/specs/fido-u2f-v1.1-id-20160915/fido-u2f-raw-message-formats-v1.1-id-20160915.html#authentication-request-message---u2f_authenticate">
          U2F_AUTHENTICATE
          </a>
          request:
          <ul>
            <li>
              Platform verifies that CTAP2 request does not have any parameters that
              CTAP1/U2F authenticators cannot fulfill:
              <ul>
                <li>
                  All of the below conditions must be true for the platform to proceed to next step.
                  If any of the below conditions is not true, platform errors out with
                  CTAP2_ERR_OPTION_NOT_SUPPORTED.
                  <ul>
                    <li>Options must not include "uv" set to true.</li>
                    <li>allowList must have at least one credential.</li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              If allowList has more than one credential, platform has to loop over the list and
              send individual different U2F_AUTHENTICATE commands to the authenticator.
              For each credential in credential list, map CTAP2 authenticatorGetAssertion request to
              <a href="https://fidoalliance.org/specs/fido-u2f-v1.1-id-20160915/fido-u2f-raw-message-formats-v1.1-id-20160915.html#authentication-request-message---u2f_authenticate">
              U2F_AUTHENTICATE
              </a>
              as below:
              <ul>
                <li>
                  Let <code>controlByte</code> be a byte initialized as follows:
                  <ul>
                    <li>
                      For USB, set it to 0x07 (check-only). This should prevent call getting
                      blocked on waiting for user input.
                      If response returns success, then call again setting the
                      enforce-user-presence-and-sign.
                    </li>
                    <li>
                      For NFC, set it to 0x03 (enforce-user-presence-and-sign).
                      The tap has already provided the presence and won’t block.
                    </li>
                  </ul>
                </li>
                <li>
                  Use clientDataHash parameter of CTAP2 request as CTAP1/U2F
                  challenge parameter (32 bytes).
                </li>
                <li>
                  Let <code>rpIdHash</code> be a byte array of size 32 initialized
                  with SHA-256 hash of <code>rp.id</code>
                  parameter as CTAP1/U2F application parameter (32 bytes).
                </li>
                <li>
                  Let <code>credentialID</code> is the byte array initialized with
                  the id for this PublicKeyCredentialDescriptor.
                </li>
                <li>
                  Let <code>keyHandleLength</code> be a byte initialized
                  with length of <code>credentialID</code> byte array.
                </li>
                <li>
                  Let <code>u2fAuthenticateRequest</code> be a byte array
                  with the following structure:
                  <table class="simple">
                    <tbody><tr>
                      <th>Length (in bytes)</th>
                      <th>Description</th>
                      <th>Value</th>
                    </tr>
                    <tr>
                      <td>1</td>
                      <td>Control Byte</td>
                      <td>Initialized with <code>controlByte</code>'s value.</td>
                    </tr>
                    <tr>
                      <td>32</td>
                      <td>Challenge parameter</td>
                      <td>Initialized with clientDataHash parameter bytes.</td>
                    </tr>
                    <tr>
                      <td>32</td>
                      <td>Application parameter</td>
                      <td>Initialized with <code>rpIdHash</code> bytes.</td>
                    </tr>
                    <tr>
                      <td>1</td>
                      <td>Key handle length</td>
                      <td>Initialized with <code>keyHandleLength</code>'s value.</td>
                    </tr>
                    <tr>
                      <td><code>keyHandleLength</code></td>
                      <td>Key handle</td>
                      <td>Initialized with <code>credentialID</code> bytes.</td>
                    </tr>
                  </tbody></table>
                </li>
              </ul>
            </li>
          </ul>
        </li>
        <li>Send <code>u2fAuthenticateRequest</code> to the authenticator.</li>
        <li>
          Map the U2F authentication response message
          (see the "Authentication Response Message: Success" section of [<cite><a class="bibref" href="#bib-U2FRawMsgs">U2FRawMsgs</a></cite>])
          to a CTAP2 authenticatorGetAssertion response message:
          <ul>
            <li>
              Generate <code>authenticatorData</code> from the
              <a href="https://fidoalliance.org/specs/fido-u2f-v1.2-ps-20170411/fido-u2f-raw-message-formats-v1.2-ps-20170411.html#authentication-response-message-success">
              U2F authentication response message
              </a>
              received from the authenticator:
              <ul>
                <li>
                  Let <code>flags</code> be a byte whose zeroth bit (bit 0, UP)
                  is set to 1 if CTAP1/U2F response user presence byte is set to 1,
                  and all other bits are zero (bit zero is the least significant bit).
                  See also Authenticator Data section of [<cite><a class="bibref" href="#bib-WebAuthN">WebAuthN</a></cite>].
                </li>
                <li>
                  Let <code>signCount</code> be a 4-byte unsigned integer
                  initialized with CTAP1/U2F response counter field.
                </li>
                <li>
                  Let <code>authenticatorData</code> is a byte array of following structure:
                  <table class="simple">
                    <tbody><tr>
                      <th>Length (in bytes)</th>
                      <th>Description</th>
                      <th>Value</th>
                    </tr>
                    <tr>
                      <td>32</td>
                      <td>
                        SHA-256 hash of the
                        <a href="https://www.w3.org/TR/webauthn/#rp-id"><code>rp.id</code></a>.
                      </td>
                      <td>Initialized with <code>rpIdHash</code> bytes.</td>
                    </tr>
                    <tr>
                      <td>1</td>
                      <td>Flags</td>
                      <td>Initialized with <code>flags</code>' value.</td>
                    </tr>
                    <tr>
                      <td>4</td>
                      <td>Signature counter (signCount)</td>
                      <td>Initialized with <code>signCount</code> bytes.</td>
                    </tr>
                  </tbody></table>
                </li>
              </ul>
            </li>
            <li>
              Let <code>authenticatorGetAssertionResponse</code> be a CBOR map with the
              following keys whose values are as follows:
              <ul>
                <li>Set 0x01 with the credential from allowList that whose response succeeded.</li>
                <li>Set 0x02 with <code>authenticatorData</code> bytes.</li>
                <li>Set 0x03 with signature field from CTAP1/U2F authentication response message.</li>
              </ul>
            </li>
          </ul>
        </li>
      </ol>

      <aside class="example"><div class="example-title"><span>Example 7</span></div>
        Sample CTAP2 authenticatorGetAssertion Request (CBOR):
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pun">{</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="str">"acme.com"</span><span class="pun">,</span><span class="pln">
 </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'687134968222EC17202E42505F8ED2B16AE22F16BB05B88C25DB9E602645F141'</span><span class="pun">,</span><span class="pln">
 </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[{</span><span class="str">"type"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"public-key"</span><span class="pun">,</span><span class="pln">
      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'3EBD89BF77EC509755EE9C2635EFAAAC7B2B9C5CEF1736C3717DA48534C8C6B6
              54D7FF945F50B5CC4E78055BDD396B64F78DA2C5F96200CCD415CD08FE420038'</span><span class="pun">}],</span><span class="pln">
 </span><span class="lit">5</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="str">"up"</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">}}</span><span class="pln">
        </span></pre>
        CTAP1/U2F Request from above CTAP2 authenticatorGetAssertion request
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pln">
</span><span class="lit">687134968222EC17202E42505F8ED2B16AE22F16BB05B88C25DB9E602645F141</span><span class="pln">    </span><span class="com"># clientdatahash</span><span class="pln">
</span><span class="lit">1194228DA8FDBDEEFD261BD7B6595CFD70A50D70C6407BCF013DE96D4EFB17DE</span><span class="pln">    </span><span class="com"># rpidhash</span><span class="pln">
</span><span class="lit">40</span><span class="pln">                                                                  </span><span class="com"># Key Handle Length (1 Byte)</span><span class="pln">
</span><span class="lit">3EBD89BF77EC509755EE9C2635EFAAAC7B2B9C5CEF1736C3717DA48534C8C6B6</span><span class="pln">    </span><span class="com"># Key Handle (Key Handle Length Bytes)</span><span class="pln">
</span><span class="lit">54D7FF945F50B5CC4E78055BDD396B64F78DA2C5F96200CCD415CD08FE420038</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
        </span></pre>
        Sample CTAP1/U2F Response from the device
        <pre class="highlight prettyprint prettyprinted" style=""><span class="lit">01</span><span class="pln">                                                                  </span><span class="com"># User Presence (1 Byte)</span><span class="pln">
</span><span class="lit">0000003B</span><span class="pln">                                                            </span><span class="com"># Sign Count (4 Bytes)</span><span class="pln">
</span><span class="lit">304402207BDE0A52AC1F4C8B27E003A370CD66A4C7118DD22D5447835F45B99C</span><span class="pln">    </span><span class="com"># Signature (variable Length)</span><span class="pln">
</span><span class="lit">68423FF702203C517B47877F85782DE10086A783D1E7DF4E3639E771F5F6AFA3</span><span class="pln">    </span><span class="com"># ...</span><span class="pln">
</span><span class="lit">5AAD5373858E</span><span class="pln">                                                        </span><span class="com"># ...</span><span class="pln">
        </span></pre>
        Authenticator Data from CTAP1/U2F Response
        <pre class="highlight prettyprint prettyprinted" style=""><span class="lit">1194228DA8FDBDEEFD261BD7B6595CFD70A50D70C6407BCF013DE96D4EFB17DE</span><span class="pln">    </span><span class="com"># rpidhash</span><span class="pln">
</span><span class="lit">01</span><span class="pln">                                                                  </span><span class="com"># User Presence (1 Byte)</span><span class="pln">
</span><span class="lit">0000003B</span><span class="pln">                                                            </span><span class="com"># Sign Count (4 Bytes)</span><span class="pln">
        </span></pre>
        Mapped CTAP2 authenticatorGetAssertion response(CBOR)
        <pre class="highlight prettyprint prettyprinted" style=""><span class="pun">{</span><span class="lit">1</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><span class="str">"type"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"public-key"</span><span class="pun">,</span><span class="pln">
     </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'3EBD89BF77EC509755EE9C2635EFAAAC7B2B9C5CEF1736C3717DA48534C8C6B6
             54D7FF945F50B5CC4E78055BDD396B64F78DA2C5F96200CCD415CD08FE420038'</span><span class="pun">},</span><span class="pln">
 </span><span class="lit">2</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'1194228DA8FDBDEEFD261BD7B6595CFD70A50D70C6407BCF013DE96D4EFB17DE
      010000003B'</span><span class="pun">,</span><span class="pln">
 </span><span class="lit">3</span><span class="pun">:</span><span class="pln"> h</span><span class="str">'304402207BDE0A52AC1F4C8B27E003A370CD66A4C7118DD22D5447835F45B99C
      68423FF702203C517B47877F85782DE10086A783D1E7DF4E3639E771F5F6AFA3
      5AAD5373858E'</span><span class="pun">}</span><span class="pln">
        </span></pre>
      </aside>

      <figure id="fig-u2f-compat-getAssertion">
        <img src="img/u2fcompat-getassertion.svg" alt="CTAP1/U2F Authenticate - authenticatorGetAssertion Compat.">
        <figcaption>Fig. <span class="figno">3</span> <span class="fig-title">Mapping: WebAuthn authenticatorGetAssertion to and from CTAP1/U2F Authentication Messages.</span></figcaption>
      </figure>
    </section>
  </section> <!-- Interoperating with CTAP1/U2F authenticators -->

  <section id="transport-specific-bindings">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_transport-specific-bindings"><span class="secno">8. </span>Transport-specific Bindings</h2>
    <section id="usb">
      <h3 aria-level="2" role="heading" id="h3_usb"><span class="secno">8.1 </span>USB</h3>
      <section id="design-rationale">
        <h4 aria-level="3" role="heading" id="h4_design-rationale"><span class="secno">8.1.1 </span>Design rationale</h4>
        <p>CTAP messages are framed for USB transport using the HID (Human
          Interface Device) protocol.  We henceforth refer to the protocol as
          CTAPHID.  The CTAPHID protocol is designed with the following design
          objectives in mind
        </p>
        <ul>
          <li>Driver-less installation on all major host platforms
          </li>
          <li>Multi-application support with concurrent application access
            without the need for serialization and centralized dispatching.
          </li>
          <li>Fixed latency response and low protocol overhead
          </li>
          <li>Scalable method for CTAPHID device discovery
          </li>
        </ul>
        <p>Since HID data is sent as interrupt packets and multiple
          applications may access the HID stack at once, a non-trivial
          level of complexity has to be added to handle this.
        </p>
      </section>
      <section id="protocol-structure-and-data-framing">
        <h4 aria-level="3" role="heading" id="h4_protocol-structure-and-data-framing"><span class="secno">8.1.2 </span>Protocol structure and data framing
        </h4>
        <p>The CTAP protocol is designed to be concurrent and state-less in
          such a way that each performed function is not dependent on
          previous actions. However, there has to be some form of
          "atomicity" that varies between the characteristics of the
          underlying transport protocol, which for the CTAPHID protocol
          introduces the following terminology:
        </p>
        <ul>
          <li>Transaction
          </li>
          <li>Message
          </li>
          <li>Packet
          </li>
        </ul>
        <p>A <strong>transaction</strong> is the highest level of aggregated functionality,
          which in turn consists of a request, followed by a response
          message. Once a request has been initiated, the transaction has
          to be entirely completed before a second transaction can take
          place and a response is never sent without a previous request. Transactions exist
          only at the highest CTAP protocol layer.
        </p>
        <p>Request and response <strong>messages</strong> are in turn divided into
          individual fragments, known as <strong>packets</strong>. The packet is the
          smallest form of protocol data unit, which in the case of
          CTAPHID are mapped into HID reports.
        </p>
      </section>
      <section id="concurrency-and-channels">
        <h4 aria-level="3" role="heading" id="h4_concurrency-and-channels"><span class="secno">8.1.3 </span>Concurrency and channels
        </h4>
        <p>Additional logic and overhead is required to allow a CTAPHID
          device to deal with multiple "clients", i.e. multiple
          applications accessing the single resource through the HID
          stack. Each client communicates with a CTAPHID device through a
          logical <strong>channel</strong>, where each application uses a unique 32-bit
          <strong>channel identifier</strong> for routing and arbitration purposes.
        </p>
        <p>A channel identifier is allocated by the FIDO authenticator device to ensure
          its system-wide uniqueness. The actual algorithm for generation
          of channel identifiers is vendor specific and not defined by
          this specification.
        </p>
        <p>Channel ID 0 is reserved and <code>0xffffffff</code> is reserved for
          broadcast commands, i.e. at the time of channel allocation.
        </p>
      </section>
      <section id="message-and-packet-structure">
        <h4 aria-level="3" role="heading" id="h4_message-and-packet-structure"><span class="secno">8.1.4 </span>Message and packet structure
      </h4>
      <p>Packets are one of two types, <strong>initialization packets</strong> and
        <strong>continuation packets</strong>. As the name suggests, the first packet
        sent in a message is an initialization packet, which also
        becomes the start of a transaction. If the entire message does
        not fit into one packet (including the CTAPHID protocol
        overhead), one or more continuation packets have to be sent in
        strict ascending order to complete the message transfer.
      </p>
      <p>A message sent from a host to a device is known as a <strong>request</strong> and
        a message sent from a device back to the host is known as a
        <strong>response</strong>. A request always triggers a response and response
        messages are never sent ad-hoc, i.e. without a prior request
        message. However, a keep-alive message can be sent between a request 
        and a response message.
      </p>
      <p>The request and response messages have an identical structure. A
        transaction is started with the initialization packet of the
        request message and ends with the last packet of the response
        message.
      </p>
      <p>Packets are always fixed size (defined by the endpoint and HID
        report descriptors) and although all bytes may not be needed in
        a particular packet, the full size always has to be sent. Unused
        bytes <em class="rfc2119" title="SHOULD">SHOULD</em> be set to zero.
      </p>
      <p>An initialization packet is defined as
      </p>
      <table title="Initialization Packet Definition" border="1" cellspacing="0" cellpadding="5">
        <tbody><tr><th>Offset</th><th>Length</th><th>Mnemonic</th><th>Description</th></tr>
        <tr><td>0</td><td>4</td><td>CID</td><td>Channel identifier</td></tr>
        <tr><td>4</td><td>1</td><td>CMD</td><td>Command identifier (bit 7 always set)</td></tr>
        <tr><td>5</td><td>1</td><td>BCNTH</td><td>High part of payload length</td></tr>
        <tr><td>6</td><td>1</td><td>BCNTL</td><td>Low part of payload length</td></tr>
        <tr><td>7</td><td>(s - 7)</td><td>DATA</td><td>Payload data (s is equal to the fixed packet size)</td></tr>
      </tbody></table>
      <p>The command byte has always the highest bit set to distinguish
        it from a continuation packet, which is described below.
      </p>
      <p>A continuation packet is defined as
      </p>
       <table title="Continuation Packet Definition" border="1" cellspacing="0" cellpadding="5">
         <tbody><tr><th>Offset</th><th>Length</th><th>Mnemonic</th><th>Description</th></tr>
         <tr><td>0</td><td>4</td><td>CID</td><td>Channel identifier</td></tr>
         <tr><td>4</td><td>1</td><td>SEQ</td><td>Packet sequence 0x00..0x7f (bit 7 always cleared)</td></tr>
         <tr><td>5</td><td>(s - 5)</td><td>DATA</td><td>Payload data (s is equal to the fixed packet size)</td></tr>
       </tbody></table>
       <p>With this approach, a message with a payload less or equal to (s
         - 7) may be sent as one packet. A larger message is then divided
         into one or more continuation packets, starting with sequence
         number 0, which then increments by one to a maximum of 127.
       </p>
       <p>With a packet size of 64 bytes (max for full-speed devices),
         this means that the maximum message payload length is 64 - 7 +
         128 * (64 - 5) = 7609 bytes.
       </p>
      </section>
      <section id="arbitration">
        <h4 aria-level="3" role="heading" id="h4_arbitration"><span class="secno">8.1.5 </span>Arbitration
        </h4>
        <p>In order to handle multiple channels and clients concurrency,
          the CTAPHID protocol has to maintain certain internal states,
          block conflicting requests and maintain protocol integrity. The
          protocol relies on each client application (channel) behaves
          politely, i.e. does not actively act to destroy for other
          channels. With this said, a malign or malfunctioning
          application can cause issues for other channels. Expected
          errors and potentially stalling applications should however, be
          handled properly.
        </p>
        <section id="transaction-atomicity-idle-and-busy-states.x">
          <h5 aria-level="4" role="heading" id="h5_transaction-atomicity-idle-and-busy-states.x"><span class="secno">8.1.5.1 </span>Transaction atomicity, idle and busy states.</h5>

          <p>A transaction always consists of three stages:
          </p>
          <ol>
            <li>A message is sent from the host to the device
            </li>
            <li>The device processes the message
            </li>
            <li>A response is sent back from the device to the host
            </li>
          </ol>
          <p>The protocol is built on the assumption that a plurality of
            concurrent applications may try ad-hoc to perform transactions
            at any time, with each transaction being atomic, i.e. it cannot
            be interrupted by another application once started.
          </p>
          <p>The application channel that manages to get through the first
            initialization packet when the device is in idle state will
            keep the device locked for other channels until the last packet
            of the response message has been received. The device then
            returns to idle state, ready to perform another transaction for
            the same or a different channel. Between two transactions, no
            state is maintained in the device and a host application must
            assume that any other process may execute other transactions at
            any time.
          </p>
          <p>If an application tries to access the device from a different
            channel while the device is busy with a transaction, that
            request will immediately fail with a busy-error message sent to
            the requesting channel.
          </p>
        </section>
        <section id="transaction-timeout">
          <h5 aria-level="4" role="heading" id="h5_transaction-timeout"><span class="secno">8.1.5.2 </span>Transaction timeout</h5>
          <p>A transaction has to be completed within a specified period of
            time to prevent a stalling application to cause the device to
            be completely locked out for access by other applications. If
            for example an application sends an initialization packet that
            signals that continuation packets will follow and that
            application crashes, the device will back out that pending
            channel request and return to an idle state.
          </p>
        </section>
        <section id="transaction-abort-and-re-synchronization">
          <h5 aria-level="4" role="heading" id="h5_transaction-abort-and-re-synchronization"><span class="secno">8.1.5.3 </span>Transaction abort and re-synchronization</h5>
          <p>If an application for any reason "gets lost", gets an unexpected
            response or error, it may at any time issue an
            abort-and-resynchronize command. If the device detects an INIT
            command during a transaction that has the same channel id as
            the active transaction, the transaction is aborted (if
            possible) and all buffered data flushed (if any). The device
            then returns to idle state to become ready for a new
            transaction.
          </p>
        </section>
        <section id="packet-sequencing">
          <h5 aria-level="4" role="heading" id="h5_packet-sequencing"><span class="secno">8.1.5.4 </span>Packet sequencing</h5>
            <p>The device keeps track of packets arriving in correct and
              ascending order and that no expected packets are missing. The
              device will continue to assemble a message until all parts of
              it has been received or that the transaction times out.
              Spurious continuation packets appearing without a prior
              initialization packet will be ignored.
            </p>
          </section>
        </section>
        <section id="channel-locking">
          <h4 aria-level="3" role="heading" id="h4_channel-locking"><span class="secno">8.1.6 </span>Channel locking</h4>
          <p>In order to deal with aggregated transactions that may not be
            interrupted, such as tunneling of vendor-specific commands, a
            channel lock command may be implemented. By sending a channel
            lock command, the device prevents other channels from
            communicating with the device until the channel lock has timed
            out or been explicitly unlocked by the application.
          </p>
          <p>This feature is optional and has not to be considered by general CTAP HID applications.
          </p>
        </section>
        <section id="protocol-version-and-compatibility">
          <h4 aria-level="3" role="heading" id="h4_protocol-version-and-compatibility"><span class="secno">8.1.7 </span>Protocol version and compatibility
          </h4>
          <p>The CTAPHID protocol is designed to be extensible, yet
            maintaining backwards compatibility to the extent it is
            applicable. This means that a CTAPHID host shall support any
            version of a device with the command set available in that
            particular version.
          </p>
        </section>
      <section id="hid-device-implementation">
        <h4 aria-level="3" role="heading" id="h4_hid-device-implementation"><span class="secno">8.1.8 </span>HID device implementation</h4>

        <p>This description assumes knowledge of the USB and HID
          specifications and is intended to provide the basics for
          implementing a CTAPHID device. There are several ways to
          implement USB devices and reviewing these different methods is
          beyond the scope of this document. This specification targets
          the interface part, where a device is regarded as either a
          single or multiple interface (composite) device.
        </p>
        <p>The description further assumes (but is not limited to) a
          full-speed USB device (12 Mbit/s). Although not excluded per
          se, USB low-speed devices are not practical to use given the
          8-byte report size limitation together with the protocol
          overhead.
        </p>
        <section id="interface-and-endpoint-descriptors">
          <h5 aria-level="4" role="heading" id="h5_interface-and-endpoint-descriptors"><span class="secno">8.1.8.1 </span>Interface and endpoint descriptors
          </h5>
          <p>The device implements two endpoints (except the control endpoint
            0), one for IN and one for OUT transfers. The packet size is
            vendor defined, but the reference implementation assumes a
            full-speed device with two 64-byte endpoints.
          </p>
          <p><strong>Interface Descriptor</strong></p>
          <table title="Interface Descriptor" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><th>Mnemonic</th><th>Value</th><th>Description</th></tr>
            <tr><td>bNumEndpoints</td><td>2</td><td>One IN and one OUT endpoint</td></tr>
            <tr><td>bInterfaceClass</td><td>0x03</td><td>HID</td></tr>
            <tr><td>bInterfaceSubClass</td><td>0x00</td><td>No interface subclass</td></tr>
            <tr><td>bInterfaceProtocol</td><td>0x00</td><td>No interface protocol</td></tr>
          </tbody></table>
          <p><strong>Endpoint 1 descriptor</strong></p>
          <table title="Endpoint 1 descriptor" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><th>Mnemonic</th><th>Value</th><th>Description</th></tr>
            <tr><td>bmAttributes</td><td>0x03</td><td>Interrupt transfer</td></tr>
            <tr><td>bEndpointAdresss</td><td>0x01</td><td>1, OUT</td></tr>
            <tr><td>bMaxPacketSize</td><td>64</td><td>64-byte packet max</td></tr>
            <tr><td>bInterval</td><td>5</td><td>Poll every 5 millisecond</td></tr>
          </tbody></table>
          <p><strong>Endpoint 2 descriptor</strong></p>
          <table title="Endpoint 2 descriptor" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><th>Mnemonic</th><th>Value</th><th>Description</th></tr>
            <tr><td>bmAttributes</td><td>0x03</td><td>Interrupt transfer</td></tr>
            <tr><td>bEndpointAdresss</td><td>0x81</td><td>1, IN</td></tr>
            <tr><td>bMaxPacketSize</td><td>64</td><td>64-byte packet max</td></tr>
            <tr><td>bInterval</td><td>5</td><td>Poll every 5 millisecond</td></tr>
          </tbody></table>
          <p>The actual endpoint order, intervals, endpoint numbers and
            endpoint packet size may be defined freely by the vendor and
            the host application is responsible for querying these values
            and handle these accordingly. For the sake of clarity, the
            values listed above are used in the following examples.
          </p>
        </section>
        <section id="hid-report-descriptor-and-device-discovery">
          <h5 aria-level="4" role="heading" id="h5_hid-report-descriptor-and-device-discovery"><span class="secno">8.1.8.2 </span>HID report descriptor and device discovery
          </h5>
          <p>A HID report descriptor is required for all HID devices, even
            though the reports and their interpretation (scope, range,
            etc.) makes very little sense from an operating system
            perspective. The CTAPHID just provides two "raw" reports, which
            basically map directly to the IN and OUT endpoints. However,
            the HID report descriptor has an important purpose in CTAPHID,
            as it is used for device discovery.
          </p>
          <p>For the sake of clarity, a bit of high-level C-style abstraction
            is provided
          </p>
          <div class="example"><div class="example-title"><span>Example 8</span></div><pre class="example">// HID report descriptor

const uint8_t HID_ReportDescriptor[] = {
  HID_UsagePage ( FIDO_USAGE_PAGE ), 
  HID_Usage ( FIDO_USAGE_CTAPHID ), 
  HID_Collection ( HID_Application ),
  HID_Usage ( FIDO_USAGE_DATA_IN ),
  HID_LogicalMin ( 0 ),
  HID_LogicalMaxS ( 0xff ),
  HID_ReportSize ( 8 ),
  HID_ReportCount ( HID_INPUT_REPORT_BYTES ),
  HID_Input ( HID_Data | HID_Absolute | HID_Variable ),
  HID_Usage ( FIDO_USAGE_DATA_OUT ),
  HID_LogicalMin ( 0 ),
  HID_LogicalMaxS ( 0xff ),
  HID_ReportSize ( 8 ),
  HID_ReportCount ( HID_OUTPUT_REPORT_BYTES ),
  HID_Output ( HID_Data | HID_Absolute | HID_Variable ),
HID_EndCollection
};</pre></div>

          <p>A unique <strong>Usage Page</strong> is defined (0xF1D0) for the FIDO alliance 
            and under this realm, a CTAPHID <strong>Usage</strong> is defined as well (0x01).
            During CTAPHID device discovery, all HID devices present in the system are
            examined and devices that match this usage pages and usage are
            then considered to be CTAPHID devices.
          </p>
          <p>The length values specified by the <code>HID_INPUT_REPORT_BYTES</code> and
            the <code>HID_OUTPUT_REPORT_BYTES</code> should typically match the
            respective endpoint sizes defined in the endpoint descriptors.
          </p>
        </section>
      </section>

      <section id="ctaphid-commands">
        <h4 aria-level="3" role="heading" id="h4_ctaphid-commands"><span class="secno">8.1.9 </span>CTAPHID commands
        </h4>
        <p>The CTAPHID protocol implements the following commands. </p>
        <section id="mandatory-commands">
          <h5 aria-level="4" role="heading" id="h5_mandatory-commands"><span class="secno">8.1.9.1 </span>Mandatory commands
          </h5>
          <p>The following list describes the minimum set of commands
            required by an CTAPHID device. Optional and vendor-specific
            commands may be implemented as described in respective sections
          of this document.
        </p>
        <section id="ctaphid_msg-0x03">
          <h6 aria-level="5" role="heading" id="h6_ctaphid_msg-0x03"><span class="secno">8.1.9.1.1 </span>CTAPHID_MSG (0x03)</h6>
        <p>This command sends an encapsulated CTAP1/U2F message to the device.
          The semantics of the data message is defined in the U2F Raw Message
          Format encoding specification.
          Please note that keep-alive messages <em class="rfc2119" title="MAY">MAY</em> be sent from the device
          to the client before the response message is returned.
        </p>
        <p><strong>Request</strong></p>
        <table title="Request" border="1" cellspacing="0" cellpadding="5">
          <tbody><tr><td>CMD</td><td>CTAPHID_MSG</td></tr>
          <tr><td>BCNT</td><td>1..(n + 1)</td></tr>
          <tr><td>DATA</td><td>U2F command byte</td></tr>
          <tr><td>DATA + 1</td><td>n bytes of data</td></tr>
        </tbody></table>
        <p><strong>Response at success</strong></p>
        <table title="Response at success" border="1" cellspacing="0" cellpadding="5">
          <tbody><tr><td>CMD</td><td>CTAPHID_MSG</td></tr>
          <tr><td>BCNT</td><td>1..(n + 1)</td></tr>
          <tr><td>DATA</td><td>U2F status code</td></tr>
          <tr><td>DATA + 1</td><td>n bytes of data</td></tr>
        </tbody></table>
        </section>
        <section id="ctaphid_cbor-0x10">
          <h6 aria-level="5" role="heading" id="h6_ctaphid_cbor-0x10"><span class="secno">8.1.9.1.2 </span>CTAPHID_CBOR (0x10)</h6>
        <p>This command sends an encapsulated CTAP CBOR encoded message. The
          semantics of the data message is defined in the CTAP Message encoding
          specification.
        </p>
        <p><strong>Request</strong></p>
        <table title="Request" border="1" cellspacing="0" cellpadding="5">
          <tbody><tr><td>CMD</td><td>CTAPHID_CBOR</td></tr>
          <tr><td>BCNT</td><td>1..(n + 1)</td></tr>
          <tr><td>DATA</td><td>CTAP command byte</td></tr>
          <tr><td>DATA + 1</td><td>n bytes of CBOR encoded data</td></tr>
        </tbody></table>
        <p><strong>Response at success</strong></p>
        <table title="Response at success" border="1" cellspacing="0" cellpadding="5">
          <tbody><tr><td>CMD</td><td>CTAPHID_MSG</td></tr>
          <tr><td>BCNT</td><td>1..(n + 1)</td></tr>
          <tr><td>DATA</td><td>CTAP status code</td></tr>
          <tr><td>DATA + 1</td><td>n bytes of CBOR encoded data</td></tr>
        </tbody></table>
        </section>
        <section id="ctaphid_init-0x06">
          <h6 aria-level="5" role="heading" id="h6_ctaphid_init-0x06"><span class="secno">8.1.9.1.3 </span>CTAPHID_INIT (0x06)</h6>

          <p>This command has two functions.
          </p>
          <p>If sent on an allocated CID, it synchronizes a channel, discarding
            the current transaction, buffers and state as quickly as possible.
            It will then be ready for a new transaction. The device then
            responds with the CID of the channel it received the INIT on, using 
            that channel.
          </p>
          <p>If sent on the broadcast CID, it requests the device to allocate a 
            unique 32-bit channel identifier (CID) that can be used by the 
            requesting application during its lifetime. The requesting application 
            generates a nonce that is used to match the response. When the response
            is received, the application compares the sent nonce with the received one.
            After a positive match, the application stores the received
            channel id and uses that for subsequent transactions.
          </p>
          <p>To allocate a new channel, the requesting application shall use
            the broadcast channel CTAPHID_BROADCAST_CID (0xFFFFFFFF). The device then
            responds with the newly allocated channel in the response, using the
            broadcast channel.
          </p>
          <p><strong>Request</strong></p>
          <table title="Request" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_INIT</td></tr>
            <tr><td>BCNT</td><td>8</td></tr>
            <tr><td>DATA</td><td>8-byte nonce</td></tr>
          </tbody></table>
          <p><strong>Response at success</strong></p>
          <table title="Response at success" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_INIT</td></tr>
            <tr><td>BCNT</td><td>17 (see note below)</td></tr>
            <tr><td>DATA</td><td>8-byte nonce</td></tr>
            <tr><td>DATA+8</td><td>4-byte channel ID</td></tr>
            <tr><td>DATA+12</td><td>CTAPHID protocol version identifier</td></tr>
            <tr><td>DATA+13</td><td>Major device version number</td></tr>
            <tr><td>DATA+14</td><td>Minor device version number</td></tr>
            <tr><td>DATA+15</td><td>Build device version number</td></tr>
            <tr><td>DATA+16</td><td>Capabilities flags</td></tr>
          </tbody></table>
          <p>The protocol version identifies the protocol version implemented
            by the device. An CTAPHID host shall accept a response size that
            is longer than the anticipated size to allow for future
            extensions of the protocol, yet maintaining backwards
            compatibility. Future versions will maintain the response
            structure to this current version, but additional fields may be
            added.
          </p>
            <p>The meaning and interpretation of the version number is vendor
              defined.
            </p>
            <p>The following device capabilities flags are defined. Unused
              values are reserved for future use and must be set to zero by
              device vendors.
            </p>
            <table title="Capabilities flags" border="1" cellspacing="0" cellpadding="5">
              <tbody><tr><td>CAPABILITY_WINK</td><td>If set to 1, authenticator implements CTAPHID_WINK function</td></tr>
              <tr><td>CAPABILITY_CBOR</td><td>If set to 1, authenticator implements CTAPHID_CBOR function</td></tr>
              <tr><td>CAPABILITY_NMSG</td><td>If set to 1, authenticator DOES NOT implement CTAPHID_MSG function</td></tr>
            </tbody></table>
        </section>
        <section id="ctaphid_ping-0x01">
          <h6 aria-level="5" role="heading" id="h6_ctaphid_ping-0x01"><span class="secno">8.1.9.1.4 </span>CTAPHID_PING (0x01)</h6>
          <p>Sends a transaction to the device, which immediately echoes the
            same data back. This command is defined to be a uniform
            function for debugging, latency and performance measurements.
          </p>
          <p><strong>Request</strong></p>
          <table title="Request" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_PING</td></tr>
            <tr><td>BCNT</td><td>0..n</td></tr>
            <tr><td>DATA</td><td>n bytes</td></tr>
          </tbody></table>
          <p><strong>Response at success</strong></p>
          <table title="Response at success" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_PING</td></tr>
            <tr><td>BCNT</td><td>n</td></tr>
            <tr><td>DATA</td><td>N bytes</td></tr>
          </tbody></table>
        </section>
        <section id="ctaphid_cancel-0x11">
          <h6 aria-level="5" role="heading" id="h6_ctaphid_cancel-0x11"><span class="secno">8.1.9.1.5 </span>CTAPHID_CANCEL (0x11)</h6>
          <p>Cancel any outstanding requests on this CID.
          </p>
          <p><strong>Request</strong></p>
          <table title="Request" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_CANCEL</td></tr>
            <tr><td>BCNT</td><td>0</td></tr>
          </tbody></table>
          <p><strong>Response at success</strong></p>
          <table title="Response at success" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_CANCEL</td></tr>
            <tr><td>BCNT</td><td>0</td></tr>
          </tbody></table>
        </section>
        <section id="ctaphid_error-0x3f">
          <h6 aria-level="5" role="heading" id="h6_ctaphid_error-0x3f"><span class="secno">8.1.9.1.6 </span>CTAPHID_ERROR  (0x3F)</h6>

          <p>This command code is used in response messages only.
          </p>
          <table title="Response" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_ERROR</td></tr>
            <tr><td>BCNT</td><td>1</td></tr>
            <tr><td>DATA</td><td>Error code</td></tr>
          </tbody></table>
          <p>The following error codes are defined
          </p>
          <table title="Error Codes" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>ERR_INVALID_CMD</td><td>The command in the request is invalid</td></tr>
            <tr><td>ERR_INVALID_PAR</td><td>The parameter(s) in the request is invalid</td></tr>
            <tr><td>ERR_INVALID_LEN</td><td>The length field (BCNT) is invalid for the request</td></tr>
            <tr><td>ERR_INVALID_SEQ</td><td>The sequence does not match expected value</td></tr>
            <tr><td>ERR_MSG_TIMEOUT</td><td>The message has timed out</td></tr>
            <tr><td>ERR_CHANNEL_BUSY</td><td>The device is busy for the requesting channel</td></tr>
          </tbody></table>
        </section>
        <section id="ctaphid_keepalive-0x3b">
          <h6 aria-level="5" role="heading" id="h6_ctaphid_keepalive-0x3b"><span class="secno">8.1.9.1.7 </span>CTAPHID_KEEPALIVE (0x3B)</h6>
          <p>This command code is sent while processing a CTAPHID_MSG. It should be sent at least
             every 100ms and whenever the status changes.
          </p>
          <table title="Response" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>CMD</td><td>CTAPHID_KEEPALIVE</td></tr>
            <tr><td>BCNT</td><td>1</td></tr>
            <tr><td>DATA</td><td>Status code</td></tr>
          </tbody></table>
          <p>The following status codes are defined
          </p>
          <table title="Error Codes" border="1" cellspacing="0" cellpadding="5">
            <tbody><tr><td>STATUS_PROCESSING</td><td>1</td><td>The authenticator is still processing the current request.</td></tr>
            <tr><td>STATUS_UPNEEDED</td><td>2</td><td>The authenticator is waiting for user presence.</td></tr>
          </tbody></table>
        </section>
        </section>
        <section id="optional-commands">
          <h5 aria-level="4" role="heading" id="h5_optional-commands"><span class="secno">8.1.9.2 </span>Optional commands
          </h5>
          <p>The following commands are defined by this specification but are
            optional and does not have to be implemented.
          </p>
          <section id="ctaphid_wink-0x08"><h6 aria-level="5" role="heading" id="h6_ctaphid_wink-0x08"><span class="secno">8.1.9.2.1 </span>CTAPHID_WINK (0x08)</h6>

            <p>The wink command performs a vendor-defined action that provides
              some visual or audible identification a particular authenticator device.
              A typical implementation will do a short burst of flashes with a
              LED or something similar. This is useful when more than one
              device is attached to a computer and there is confusion which
              device is paired with which connection.
            </p>
            <p><strong>Request</strong></p>
            <table title="Request" border="1" cellspacing="0" cellpadding="5">
              <tbody><tr><td>CMD</td><td>CTAPHID_WINK</td></tr>
              <tr><td>BCNT</td><td>0</td></tr>
              <tr><td>DATA</td><td>N/A</td></tr>
            </tbody></table>
            <p><strong>Response at success</strong></p>
            <table title="Response at success" border="1" cellspacing="0" cellpadding="5">
              <tbody><tr><td>CMD</td><td>CTAPHID_WINK</td></tr>
              <tr><td>BCNT</td><td>0</td></tr>
              <tr><td>DATA</td><td>N/A</td></tr>
            </tbody></table>
          </section>
          <section id="ctaphid_lock-0x04">
            <h6 aria-level="5" role="heading" id="h6_ctaphid_lock-0x04"><span class="secno">8.1.9.2.2 </span>CTAPHID_LOCK (0x04)</h6>
      <p>The lock command places an exclusive lock for one channel to
        communicate with the device. As long as the lock is active, any
        other channel trying to send a message will fail. In order to
        prevent a stalling or crashing application to lock the device
        indefinitely, a lock time up to 10 seconds may be set. An
        application requiring a longer lock has to send repeating lock
        commands to maintain the lock.
      </p>
      <p><strong>Request</strong></p>
      <table title="Request" border="1" cellspacing="0" cellpadding="5">
        <tbody><tr><td>CMD</td><td>CTAPHID_LOCK</td></tr>
        <tr><td>BCNT</td><td>1</td></tr>
        <tr><td>DATA</td><td>Lock time in seconds 0..10. A value of 0 immediately releases the lock</td></tr>
      </tbody></table>
      <p><strong>Response at success</strong></p>
      <table title="Response at success" border="1" cellspacing="0" cellpadding="5">
        <tbody><tr><td>CMD</td><td>CTAPHID_LOCK</td></tr>
        <tr><td>BCNT</td><td>0</td></tr>
        <tr><td>DATA</td><td>N/A</td></tr>
      </tbody></table>
          </section>
        </section>
        <section id="vendor-specific-commands">
          <h5 aria-level="4" role="heading" id="h5_vendor-specific-commands"><span class="secno">8.1.9.3 </span>Vendor specific commands
          </h5>
          <p>A CTAPHID may implement additional vendor specific commands that
            are not defined in this specification, yet being CTAPHID
            compliant. Such commands, if implemented must have a command in
            the range between CTAPHID_VENDOR_FIRST (0x40) and 
            CTAPHID_VENDOR_LAST (0x7F).
          </p>
        </section>
      </section>
    </section> <!-- USB -->

    <section id="iso7816-iso14443-and-near-field-communication-nfc">
      <h3 aria-level="2" role="heading" id="h3_iso7816-iso14443-and-near-field-communication-nfc"><span class="secno">8.2 </span>ISO7816, ISO14443 and Near Field Communication (NFC)</h3>

      <section id="conformance-1">
        <h4 aria-level="3" role="heading" id="h4_conformance-1"><span class="secno">8.2.1 </span>Conformance</h4>
        Please refer to [ISOIEC-7816-4-2013] for APDU definition.
      </section>

      <section id="protocol">
        <h4 aria-level="3" role="heading" id="h4_protocol"><span class="secno">8.2.2 </span>Protocol</h4>
        <p>The general protocol between a FIDO 2.0 client and an authenticator
          over ISO7816/ISO14443 is as follows:</p>
        <ol>
          <li>Client sends an applet selection command
          </li><li>Authenticator replies with success if the applet is present
          </li><li>Client sends a command for an operation
          </li><li>Authenticator replies with response data or error
        </li></ol>
      </section>

      <section id="applet-selection">
        <h4 aria-level="3" role="heading" id="h4_applet-selection"><span class="secno">8.2.3 </span>Applet selection</h4>
        <p>A successful Select allows the client to know that the applet is present
          and active. A client <em class="rfc2119" title="SHALL">SHALL</em> send a Select to the authenticator before any
          other command.</p>

        <p>The FIDO 2.0 AID consists of the following fields:</p>
        <table class="simple">
            <tbody><tr><th>Field</th><th>Value</th></tr>
            <tr><td>RID</td><td>0xA000000647</td></tr>
            <tr><td>AC</td><td>0x2f</td></tr>
            <tr><td>AX</td><td>0x0001</td></tr>
          </tbody></table>

        <p>The command to select the FIDO applet is:</p>
          <table class="simple">
            <tbody><tr><th>CLA</th><th>INS</th><th>P1</th><th>P2</th><th>Lc</th><th>Data In</th><th>Le</th></tr>
            <tr><td>0x00</td><td>0xA4</td><td>0x04</td><td>0x0C</td><td>0x08</td><td>AID</td><td>TBD (version string length)</td></tr>
          </tbody></table>
          
        <p>In response to the applet selection command, the FIDO authenticator
          replies with its version information string in the successful
          response.</p>

        <p>Given legacy support for CTAP1/U2F, the client must determine the
          capabilities of the device at the selection stage.</p>

        <ul>
          <li>If the authenticator implements CTAP1/U2F, the version information
            <em class="rfc2119" title="SHALL">SHALL</em> be the string U2F_V2 to maintain backwards-compatibility with
            CTAP1/U2F-only clients.</li>
          <li>If the authenticator ONLY implements CTAP2, the device <em class="rfc2119" title="SHALL">SHALL</em>
            respond with data that is NOT U2F_V2.</li>
          <li>If the authenticator implements both CTAP1/U2F and CTAP2, the
            version information <em class="rfc2119" title="SHALL">SHALL</em> be the string U2F_V2 to maintain
            backwards-compatibility with CTAP1/U2F-only clients. CTAP2-aware
            clients may then issue a CTAP authenticatorGetInfo command to
            determine if the device supports CTAP2 or not.</li>
        </ul>
      </section>

      <section id="framing">
        <h4 aria-level="3" role="heading" id="h4_framing"><span class="secno">8.2.4 </span>Framing</h4>

        <p>Conceptually, framing defines an encapsulation of FIDO 2.0 commands. In NFC,
          this encapsulation is done in an APDU following [ISOIEC-7816-4-2013]. Fragmentation,
          if needed, is discussed in the following paragraph.</p>

        <section id="commands-1">
          <h5 aria-level="4" role="heading" id="h5_commands-1"><span class="secno">8.2.4.1 </span>Commands</h5>
          <p>Commands <em class="rfc2119" title="SHALL">SHALL</em> have the following format:</p>
          <table class="simple">
            <tbody><tr><th>CLA</th><th>INS</th><th>P1</th><th>P2</th><th>Data In</th><th>Le</th></tr>
            <tr><td>0x80</td><td>0x10</td><td>0x00</td><td>0x00</td><td>CTAP Command Byte || CBOR Encoded Data</td><td>Variable</td></tr>
          </tbody></table>
        </section>

        <section id="response">
          <h5 aria-level="4" role="heading" id="h5_response"><span class="secno">8.2.4.2 </span>Response</h5>
          <p>Response <em class="rfc2119" title="SHALL">SHALL</em> have the following format in case of success:</p>
          <table class="simple">
            <tbody><tr><th>Case</th><th>Data</th><th>Status word</th></tr>
            <tr><td>Success</td><td>Response data</td><td>"9000" - Success</td></tr>
            <tr><td>Status update</td><td>Status data</td><td>"9100" - OK<br>
              When receiving this, CTAP will immediately issue an NFCCTAP_GETREPONSE command unless
              a cancel was issued. CTAP will provide the status data to the higher layers.
            </td></tr>
            <tr><td>Errors</td><td></td><td>See [ISOIEC-7816-4-2013]</td></tr>
        </tbody></table>
        </section>

      </section>

      <section id="fragmentation">
        <h4 aria-level="3" role="heading" id="h4_fragmentation"><span class="secno">8.2.5 </span>Fragmentation</h4>
        <p>APDU command may hold up to 255 or 65535 bytes of data using 
	   short or extended length encoding respectively. APDU response 
	   may hold up to 256 or 65536 bytes of data using short or extended 
	   length encoding respectively.</p>
        <p>Some requests may not fit into a short APDU command, or the expected 
	   response may not fit in a short APDU response. For this reason, FIDO 
	   2.0 client <em class="rfc2119" title="MAY">MAY</em> encode APDU command in the following way:</p>
        <ul>
          <li>The request may be encoded using <em>extended length</em> APDU 
            encoding.
	  </li>
          <li>The request may be encoded using <em>short</em> APDU encoding.
            If the request does not fit a short APDU command, the client <em class="rfc2119" title="MUST">MUST</em> use 
            ISO 7816-4 APDU chaining.
          </li>
        </ul>
        <p>Some responses may not fit into a short APDU response. For this reason,
	  FIDO 2.0 authenticators <em class="rfc2119" title="MUST">MUST</em> respond in the following way:</p>
        <ul>
          <li>If the request was encoded using <em>extended length</em> APDU encoding, 
  	    the authenticator <em class="rfc2119" title="MUST">MUST</em> respond using the extended length  APDU response 
            format.
	  </li>
          <li>If the request was encoded using <em>short</em> APDU encoding, the 
	    authenticator <em class="rfc2119" title="MUST">MUST</em> respond using ISO 7816-4 APDU chaining.
          </li>
        </ul>

      </section>
      <section id="commands-2">
      	<h4 aria-level="3" role="heading" id="h4_commands-2"><span class="secno">8.2.6 </span>Commands</h4>
	<section id="nfcctap_msg-0x10">
	<h5 aria-level="4" role="heading" id="h5_nfcctap_msg-0x10"><span class="secno">8.2.6.1 </span>NFCCTAP_MSG (0x10)</h5>
	<p>The NFCCTAP_MSG command send a CTAP message to the authenticator. This command <em class="rfc2119" title="SHALL">SHALL</em> return 
          as soon as processing is done. If the operation was not completed, it <em class="rfc2119" title="MAY">MAY</em> return a 0x9100 result
          to trigger NFCCTAP_GETRESPONSE functionality if the client indicated support by setting the
          relevant bit in P1.
	</p>
	<p>
          The values for P1 for the NFCCTAP_MSG command are:
          </p><table class="simple">
            <tbody><tr><th>P1 Bits</th><th>Meaning</th></tr>
            <tr><td>0x80</td><td>The client supports NFCCTAP_GETRESPONSE</td></tr>
	    <tr><td>0x7F</td><td>RFU, must be 0x00</td></tr>
          </tbody></table>
          Values for P2 are all RFU and <em class="rfc2119" title="MUST">MUST</em> be set to 0.
        <p></p>

	
	<h5 id="nfcctap_getresponse-0x11">NFCCTAP_GETRESPONSE (0x11)</h5>
	<p>The NFCCTAP_GETRESPONSE command is issued up to receiving 0x9100 unless a cancel was issued.
	This command <em class="rfc2119" title="SHALL">SHALL</em> return a 0x9100 result with a status indication if it has a status update,
	the reply to the request with a 0x9000 result code to indicate success or an error value.
	</p>
	<p>All values for P1 and P2 are RFU and <em class="rfc2119" title="MUST">MUST</em> be set to 0x00.
	</p></section>
    </section> <!-- NFC -->

    <section id="bluetooth-smart-bluetooth-low-energy-technology">
      <h4 aria-level="3" role="heading" id="h4_bluetooth-smart-bluetooth-low-energy-technology"><span class="secno">8.2.7 </span>Bluetooth Smart / Bluetooth Low Energy Technology</h4>

      <section id="conformance-2">
        <h5 aria-level="4" role="heading" id="h5_conformance-2"><span class="secno">8.2.7.1 </span>Conformance</h5>
        <p>Authenticator and Client devices using Bluetooth Low Energy
           Technology <em class="rfc2119" title="SHALL">SHALL</em> conform to Bluetooth Core Specification 4.0 
           or later [BTCORE]</p>
        <p>Bluetooth SIG specified UUID values <em class="rfc2119" title="SHALL">SHALL</em> be found on the
           Assigned Numbers website [BTASSNUM]</p>
      </section>

      <section id="pairing">
        <h5 aria-level="4" role="heading" id="h5_pairing"><span class="secno">8.2.7.2 </span>Pairing</h5>
        <p>Bluetooth Low Energy Technology is a long-range wireless protocol 
           and thus has several implications for privacy, security, and overall 
           user-experience. Because it is wireless, Bluetooth Low Energy Technology
           may be subject to monitoring, injection, and other network-level attacks.</p>

        <p>For these reasons, Clients and Authenticators <em class="rfc2119" title="MUST">MUST</em> create and use a
           long-term link key (LTK) and <em class="rfc2119" title="SHALL">SHALL</em> encrypt all communications.
           Authenticator <em class="rfc2119" title="MUST">MUST</em> never use short term keys.</p>

        <p>Because Bluetooth Low Energy Technology has poor ranging (<em>i.e.,</em> 
           there is no good indication of proximity), it may not be clear to a 
           FIDO Client with which Bluetooth Low Energy Technology Authenticator 
           it should communicate.  Pairing is the only mechanism defined in this 
           protocol to ensure that FIDO Clients are interacting with the expected 
           Bluetooth Low Energy Technology Authenticator.  As a result,
           Authenticator manufacturers <em class="rfc2119" title="SHOULD">SHOULD</em> instruct users to avoid performing
           Bluetooth pairing in a public space such as a cafe, shop or train
           station.</p>

        <p>One disadvantage of using standard Bluetooth pairing is that the
           pairing is "system-wide" on most operating systems.  That is, if an
           Authenticator is paired to a FIDO Client which resides on an operating
           system where Bluetooth pairing is "system-wide", then any application
           on that device might be able to interact with an Authenticator. This
           issue is discussed further in Implementation Considerations.</p>
      </section>

      <section id="link-security">
        <h5 aria-level="4" role="heading" id="h5_link-security"><span class="secno">8.2.7.3 </span>Link Security</h5>
        <p>For Bluetooth Low Energy Technology connections, the Authenticator 
           <em class="rfc2119" title="SHALL">SHALL</em> enforce <code>Security Mode 1, Level 2</code> (unauthenticated
           pairing with encryption) or <code>Security Mode 1, Level 3</code>
           (authenticated pairing with encryption) before any FIDO messages 
           are exchanged.</p>
      </section>

      <section id="framing-1">
        <h5 aria-level="4" role="heading" id="h5_framing-1"><span class="secno">8.2.7.4 </span>Framing</h5>
        <p>Conceptually, framing defines an encapsulation of FIDO raw messages
           responsible for correct transmission of a single request and its
           response by the transport layer.</p>

        <p>All requests and their responses are conceptually written as a single
           frame. The format of the requests and responses is given first as
           complete frames. Fragmentation is discussed next for each type of
           transport layer.</p>

        <section id="request-from-client-to-authenticator">
          <h6 aria-level="5" role="heading" id="h6_request-from-client-to-authenticator"><span class="secno">8.2.7.4.1 </span>Request from Client to Authenticator</h6>
          <p>Request frames must have the following format</p>

          <table class="simple">
            <tbody><tr><th>Offset</th><th>Length</th><th>Mnemonic</th><th>Description</th></tr>
            <tr><td>0</td><td>1</td><td><code>CMD</code></td><td>Command identifier</td></tr>
            <tr><td>1</td><td>1</td><td><code>HLEN</code></td><td>High part of data length</td></tr>
            <tr><td>2</td><td>1</td><td><code>LLEN</code></td><td>Low part of data length</td></tr>
            <tr><td>3</td><td>s</td><td><code>DATA</code></td><td>Data (s is equal to the length)</td></tr>
          </tbody></table>

          <p>Supported commands are <code>PING</code>, <code>MSG</code> and <code>CANCEL</code>.
             The constant values for them are described below.</p>

            <p>The <code>CANCEL</code> command cancels any outstanding <code>MSG</code> commands.
            
          </p><p>The data format for the <code>MSG</code> command is defined in the
             Message Encoding section of this document.</p>
        </section>

        <section id="response-from-authenticator-to-client">
          <h6 aria-level="5" role="heading" id="h6_response-from-authenticator-to-client"><span class="secno">8.2.7.4.2 </span>Response from Authenticator to Client</h6>
          <p>Response frames must have the following format, which share a
          similar format to the request frames: </p>

          <table class="simple">
            <tbody><tr><th>Offset</th><th>Length</th><th>Mnemonic</th><th>Description</th></tr>
            <tr><td>0</td><td>1</td><td><code>STAT</code></td><td>Response status</td></tr>
            <tr><td>1</td><td>1</td><td><code>HLEN</code></td><td>High part of data length</td></tr>
            <tr><td>2</td><td>1</td><td><code>LLEN</code></td><td>Low part of data length</td></tr>
            <tr><td>3</td><td>s</td><td><code>DATA</code></td><td>Data (s is equal to the length)</td></tr>
          </tbody></table>

          <p>When the status byte in the response is the same as the command
             byte in the request, the response is a successful response.  The
             value <code>ERROR</code> indicates an error, and the response data
             contains an error code as a variable-length, big-endian integer. The
             constant value for <code>ERROR</code> is described below. </p>

          <p>Note that the errors sent in this response are errors at the
             encapsulation layer, <em>e.g.,</em> indicating an incorrectly
             formatted request, or possibly an error communicating with the
             Authenticator’s FIDO message processing layer. Errors reported by the
             FIDO message processing layer itself are considered a success from
             the encapsulation layer’s point of view, and are reported as a
             complete <code>MSG</code> response. </p>

          <p>Data format is defined in the Message Encoding section of this document.</p>
        </section>

        <section id="command-status-and-error-constants">
          <h6 aria-level="5" role="heading" id="h6_command-status-and-error-constants"><span class="secno">8.2.7.4.3 </span>Command, Status, and Error constants</h6>

          <p>The COMMAND constants and values are:</p>
          <table class="simple">
            <tbody><tr><th>Constant</th><th>Value</th></tr>
            <tr><td><code>PING</code></td><td>0x81</td></tr>
            <tr><td><code>KEEPALIVE</code></td><td>0x82</td></tr>
            <tr><td><code>MSG</code></td><td>0x83</td></tr>
            <tr><td><code>CANCEL</code></td><td>0xbe</td></tr>
            <tr><td><code>ERROR</code></td><td>0xbf</td></tr>
          </tbody></table>

          <p>The KEEPALIVE command contains a single byte with the following
           possible values:</p>
          <table class="simple">
            <tbody><tr><th>Status Constant</th><th>Value</th></tr>
            <tr><td><code>PROCESSING</code></td><td>0x01</td></tr>
            <tr><td><code>UP_NEEDED</code></td><td>0x02</td></tr>
            <tr><td><code>RFU</code></td><td>0x00, 0x03-0xFF</td></tr>
          </tbody></table>

          <p> The ERROR constants and values are:</p>
          <table class="tlv">
            <tbody><tr><th>Error Constant</th><th>Value</th><th>Meaning</th></tr>
            <tr><td><code>ERR_INVALID_CMD</code></td><td>0x01</td><td>The command in the request is unknown/invalid</td></tr>
            <tr><td><code>ERR_INVALID_PAR</code></td><td>0x02</td><td>The parameter(s) of the command is/are invalid or missing</td></tr>
            <tr><td><code>ERR_INVALID_LEN</code></td><td>0x03</td><td>The length of the request is invalid</td></tr>
            <tr><td><code>ERR_INVALID_SEQ</code></td><td>0x04</td><td>The sequence number is invalid</td></tr>
            <tr><td><code>ERR_REQ_TIMEOUT</code></td><td>0x05</td><td>The request timed out</td></tr>
            <tr><td><code>NA</code></td><td>0x06</td><td>Value reserved (HID)</td></tr>
            <tr><td><code>NA</code></td><td>0x0a</td><td>Value reserved (HID)</td></tr>
            <tr><td><code>NA</code></td><td>0x0b</td><td>Value reserved (HID)</td></tr>
            <tr><td><code>ERR_OTHER</code></td><td>0x7f</td><td>Other, unspecified error</td></tr>
          </tbody></table>
        </section>
      </section> <!-- end of framing section -->

      <section id="gatt-service-description">
        <h5 aria-level="4" role="heading" id="h5_gatt-service-description"><span class="secno">8.2.7.5 </span>GATT Service Description</h5>
        <p>This profile defines two roles: FIDO Authenticator and FIDO Client.</p>
        <ul>
          <li>The FIDO Client shall be a GATT Client</li>
          <li>The FIDO Authenticator shall be a GATT Server</li>
        </ul>
        <p>The <a href="#fig-gatt-server" class="fig-ref">following figure</a> illustrates the
          mandatory services and characteristics that <em class="rfc2119" title="SHALL">SHALL</em> be offered by a
          FIDO Authenticator as part of its GATT server:</p>

        <figure id="fig-gatt-server">
           <img src="img/fido-2.0-gatt-server.png" alt="FIDO mandatory service and characteristics">
           <figcaption>Fig. <span class="figno">4</span> <span class="fig-title">
             Mandatory GATT services and characteristics that <em class="rfc2119" title="MUST">MUST</em> be offered by a FIDO
             Authenticator.  Note that the Generic Access Service ([<a href="#BTGAS">GAS</a>) 
             is not present as it is already mandatory for any Bluetooth Low Energy Technology 
             compliant device.
           </span></figcaption>
        </figure>

        <p>The table below summarizes additional GATT sub-procedure
           requirements for a FIDO Authenticator (GATT Server) beyond those
           required by all GATT Servers.</p>

        <table class="simple">
          <tbody><tr><th>GATT Sub-Procedure</th><th>Requirements</th></tr>
          <tr><td>Write Characteristic Value</td><td><code>Mandatory</code>
          </td></tr><tr><td>Notifications</td><td><code>Mandatory</code>
          </td></tr><tr><td>Read Characteristic Descriptors </td><td><code>Mandatory</code>
          </td></tr><tr><td>Write Characteristic Descriptors</td><td><code>Mandatory</code>
        </td></tr></tbody></table>

        <p>The table below summarizes additional GATT sub-procedure requirements
           for a FIDO Client (GATT Client) beyond those required by all GATT Clients.</p>

        <table class="simple">
          <tbody><tr><th>GATT Sub-Procedure</th><th>Requirements</th></tr>
          <tr><td>Discover All Primary Services</td><td><code>(*)</code>
          </td></tr><tr><td>Discover Primary Services by Service UUID</td><td><code>(*)</code>
          </td></tr><tr><td>Discover All Characteristics of a Service</td><td><code>(**)</code>
          </td></tr><tr><td>Discover Characteristics by UUID</td><td><code>(**)</code>
          </td></tr><tr><td>Discover All Characteristic Descriptors</td><td><code>Mandatory</code>
          </td></tr><tr><td>Read Characteristic Value</td><td><code>Mandatory</code>
          </td></tr><tr><td>Write Characteristic Value</td><td><code>Mandatory</code>
          </td></tr><tr><td>Notification</td><td><code>Mandatory</code>
          </td></tr><tr><td>Read Characteristic Descriptors</td><td><code>Mandatory</code>
          </td></tr><tr><td>Write Characteristic Descriptors</td><td><code>Mandatory</code>
        </td></tr></tbody></table>

        <p>(*): Mandatory to support at least one of these sub-procedures.</p>
        <p>(**): Mandatory to support at least one of these sub-procedures.</p>
        <p>Other GATT sub-procedures may be used if supported by both client
           and server.</p>

        <p>Specifics of each service are explained below. In the following
           descriptions: all values are big-endian coded, all strings are in
           UTF-8 encoding, and any characteristics not mentioned explicitly are
           optional.</p>

        <section id="fido-service">
          <h6 aria-level="5" role="heading" id="h6_fido-service"><span class="secno">8.2.7.5.1 </span>FIDO Service</h6>
          <p>An Authenticator <em class="rfc2119" title="SHALL">SHALL</em> implement the FIDO Service described below.
             The UUID for the FIDO GATT service is <code>0xFFFD</code>, it shall be declared as a Primary Service.
             The service contains the following characteristics:</p>

          <table class="simple">
            <tbody><tr><th>Characteristic Name</th><th>Mnemonic</th><th>Property</th><th>Length</th><th>UUID</th></tr>
            <tr><td>FIDO Control Point</td><td><code>fidoControlPoint</code></td><td>Write</td><td>Defined by Vendor (20-512 bytes)</td><td>F1D0FFF1-DEAA-ECEE-B42F-C9BA7ED623BB</td></tr>
            <tr><td>FIDO Status</td><td><code>fidoStatus</code></td><td>Notify</td><td>N/A</td><td>F1D0FFF2-DEAA-ECEE-B42F-C9BA7ED623BB</td></tr>
            <tr><td>FIDO Control Point Length</td><td><code>fidoControlPointLength</code></td><td>Read</td><td>2 bytes</td><td>F1D0FFF3-DEAA-ECEE-B42F-C9BA7ED623BB</td></tr>
            <tr><td>FIDO Service Revision Bitfield</td><td><code>fidoServiceRevisionBitfield</code></td><td>Read/Write</td><td>Defined by Vendor (1+ bytes)</td><td>F1D0FFF4-DEAA-ECEE-B42F-C9BA7ED623BB</td></tr>
            <tr><td>FIDO Service Revision</td><td><code>fidoServiceRevision</code></td><td>Read</td><td>Defined by Vendor (20-512 bytes)</td><td>0x2A28</td></tr>
          </tbody></table>

          <p><code>fidoControlPoint</code> is a write-only command buffer.</p>

          <p><code>fidoStatus</code> is a notify-only response attribute.
             The Authenticator will send a series of notifications on this attribute
             with a maximum length of (ATT_MTU-3) using the response frames defined
             above. This mechanism is used because this results in a faster transfer
             speed compared to a notify-read combination.</p>

          <p><code>fidoControlPointLength</code> defines the maximum size in
             bytes of a single write request to <code>fidoControlPoint</code>.
             This value <em class="rfc2119" title="SHALL">SHALL</em> be between 20 and 512.</p>

          <p><code>fidoServiceRevision</code> is a deprecated field that is only relevant to 
            U2F 1.0 support. It defines the revision of the U2F Service.
            The value is a UTF-8 string.  For version 1.0 of the specification, 
            the value <code>fidoServiceRevision</code> <em class="rfc2119" title="SHALL">SHALL</em> be <code>1.0</code> or in
            raw bytes: <code>0x312e30</code>. This field <em class="rfc2119" title="SHALL">SHALL</em> be omitted if protocol 
            version 1.0 is not supported.
          </p>
          <p>The <code>fidoServiceRevision</code> Characteristic <em class="rfc2119" title="MAY">MAY</em> include
             a Characteristic Presentation Format descriptor with format value
             0x19, <code>UTF-8 String</code>.
          </p>

          <p><code>fidoServiceRevisionBitfield</code> defines the revision of the FIDO Service.
            The value is a bit field which each bit representing a version. For each
            version bit the value is 1 if the version is supported, 0 if it is not.
            The length of the bitfield is 1 or more bytes. All bytes that are 0 are 
            omitted if all the following bytes are 0 too. The byte order is big endian.
            The client <em class="rfc2119" title="SHALL">SHALL</em> write a value to this characteristic with exactly 1 bit 
            set before sending any FIDO commands unless u2fServiceRevision is present
            and U2F 1.0 compatibility is desired. If only U2F version 1.0 is supported, 
            this characteristic <em class="rfc2119" title="SHALL">SHALL</em> be omitted.

            </p><table class="tlv">
             <tbody><tr><th>Byte (left to right)</th><th>Bit</th><th>Version</th></tr>
             <tr><td>0</td><td>7</td><td>U2F 1.1</td></tr>
             <tr><td>0</td><td>6</td><td>U2F 1.2</td></tr>
             <tr><td>0</td><td>5</td><td>FIDO 2.0</td></tr>
             <tr><td>0</td><td>4-0</td><td>Reserved</td></tr>
            </tbody></table>

            For example, a device that only supports FIDO 2.0 Rev 1 will only have a
            fidoServiceRevisionBitfield characteristic of length 1 with value 0x20.
            <p></p>

        </section>
        <section id="device-information-service">
          <h6 aria-level="5" role="heading" id="h6_device-information-service"><span class="secno">8.2.7.5.2 </span>Device Information Service</h6>
          <p>An Authenticator <em class="rfc2119" title="SHALL">SHALL</em> implement the Device Information Service
             [<a href="#BTDIS">BTDIS</a>] with the following characteristics:
            </p><ul>
              <li>Manufacturer Name String
              </li><li>Model Number String
              </li><li>Firmware Revision String
            </li></ul>

          <p>All values for the Device Information Service are left to the
             vendors.  However, vendors should not create uniquely identifiable
             values so that Authenticators do not become a method of tracking
             users.</p>
        </section>
        <section id="generic-access-profile-service">
          <h6 aria-level="5" role="heading" id="h6_generic-access-profile-service"><span class="secno">8.2.7.5.3 </span>Generic Access Profile Service</h6>
          <p>Every Authenticator <em class="rfc2119" title="SHALL">SHALL</em> implement the Generic Access Profile Service 
            [<a href="#BTGAS">BTGAS</a>] with the following characteristics:
          </p><ul>
            <li>Device Name
            </li><li>Appearance
          </li></ul>
        </section>
      </section> <!-- end of gatt service section -->

      <section id="protocol-overview">
        <h5 aria-level="4" role="heading" id="h5_protocol-overview"><span class="secno">8.2.7.6 </span>Protocol Overview</h5>
        <p>The general overview of the communication protocol follows:</p>
        <ol>
          <li>Authenticator advertises the FIDO Service.
          </li><li>Client scans for Authenticator advertising the FIDO
              Service.
          </li><li>Client performs characteristic discovery on the Authenticator.
          </li><li>If not already paired, the Client and Authenticator <em class="rfc2119" title="SHALL">SHALL</em>
              perform BLE pairing and create a LTK.  Authenticator <em class="rfc2119" title="SHALL">SHALL</em> only
              allow connections from previously bonded Clients without user
              intervention.
          </li><li>Client checks if the <code>fidoServiceRevisionBitfield</code>
              characteristic is present. If so, the client selects a supported
              version by writing a value with a single bit set.
          </li><li>Client reads the <code>fidoControlPointLength</code> characteristic.
          </li><li>Client registers for notifications on the <code>fidoStatus</code>
              characteristic.
          </li><li>Client writes a request (<em>e.g.</em>, an enroll request) into
              the <code>fidoControlPoint</code> characteristic.
          </li><li>Authenticator evaluates the request and responds by sending
              notifications over <code>fidoStatus</code> characteristic.
          </li><li>The protocol completes when either:
            <ul>
              <li>The Client unregisters for notifications on the
                <code>fidoStatus</code> characteristic, or:</li>
              <li>The connection times out and is closed by the
                Authenticator.</li>
            </ul>
        </li></ol>
      </section>

      <section id="authenticator-advertising-format">
        <h5 aria-level="4" role="heading" id="h5_authenticator-advertising-format"><span class="secno">8.2.7.7 </span>Authenticator Advertising Format</h5>
        <p>When advertising, the Authenticator <em class="rfc2119" title="SHALL">SHALL</em> advertise the FIDO
           service UUID.</p>
        <p>When advertising, the Authenticator <em class="rfc2119" title="MAY">MAY</em> include the TxPower value
            in the advertisement (see [<a href="#BTXPLAD">BTXPLAD</a>]).</p>
        <p>When advertising in pairing mode, the Authenticator <em class="rfc2119" title="SHALL">SHALL</em> either: 
          (1) set the LE Limited Mode bit to zero and the LE General Discoverable 
          bit to one OR (2) set the LE Limited Mode bit to one and the LE General 
          Discoverable bit to zero. When advertising in non-pairing mode, 
          the Authenticator <em class="rfc2119" title="SHALL">SHALL</em> set both the LE Limited Mode bit and the LE 
          General Discoverable Mode bit to zero in the Advertising Data Flags.</p>
        <p>The advertisement <em class="rfc2119" title="MAY">MAY</em> also carry a device name which is
           distinctive and user-identifiable.  For example, "ACME Key" would
           be an appropriate name, while "XJS4" would not be.</p>
        <p>The Authenticator <em class="rfc2119" title="SHALL">SHALL</em> also implement the Generic Access Profile
           [<a href="#BTGAP">BTGAP</a>] and Device Information Service 
           [<a href="#BTDIS">BTDIS</a>], both of which also provide a user-friendly
           name for the device that could be used by the Client.</p>
        <p>It is not specified when or how often an Authenticator should
           advertise, instead that flexibility is left to manufacturers.</p>
      </section>

      <section id="requests">
        <h5 aria-level="4" role="heading" id="h5_requests"><span class="secno">8.2.7.8 </span>Requests</h5>
        <p>Clients <em class="rfc2119" title="SHOULD">SHOULD</em> make requests by connecting to the Authenticator
           and performing a write into the <code>fidoControlPoint</code>
           characteristic.</p>
      </section>

      <section id="responses-1">
        <h5 aria-level="4" role="heading" id="h5_responses-1"><span class="secno">8.2.7.9 </span>Responses</h5>
        <p>Authenticators <em class="rfc2119" title="SHOULD">SHOULD</em> respond to Clients by sending notifications
           on the <code>fidoStatus</code> characteristic.</p>

        <p>Some Authenticators might alert users or prompt them to complete the
           test of user presence (<em>e.g.</em>, via sound, light, vibration)
           Upon receiving any request, the Authenticators <em class="rfc2119" title="SHALL">SHALL</em> send
           KEEPALIVE commands every <code>kKeepAliveMillis</code>
           milliseconds until completing processing the commands. While the
           Authenticator is processing the request the KEEPALIVE command will
           contain status <code>PROCESSING</code>. If the Authenticator is
           waiting to complete the Test of User Presence, the KEEPALIVE command
           will contains status <code>UP_NEEDED</code>. While waiting to
           complete the Test of User Presence, the Authenticator <em class="rfc2119" title="MAY">MAY</em> alert the
           user (e.g., by flashing) in order to prompt the user to complete the
           test of user presence.
           As soon the Authenticator has completed processing and confirmed
           user presence, it <em class="rfc2119" title="SHALL">SHALL</em> stop sending KEEPALIVE commands and send the
           reply.</p>
        <p>Upon receiving a KEEPALIVE command, the Client <em class="rfc2119" title="SHALL">SHALL</em> assume the
           Authenticator is still processing the command; the Client <em class="rfc2119" title="SHALL">SHALL</em> not
           resend the command.  The Authenticator <em class="rfc2119" title="SHALL">SHALL</em> continue sending
           KEEPALIVE messages at least every <code>kKeepAliveMillis</code>
           to indicate that it is still handling the request.  Until a
           client-defined timeout occurs, the Client <em class="rfc2119" title="SHALL NOT">SHALL NOT</em> move on to other
           devices when it receives a KEEPALIVE with <code>UP_NEEDED</code>
           status, as it knows this is a device that can satisfy its request.</p>
      </section>

      <section id="framing-fragmentation">
        <h5 aria-level="4" role="heading" id="h5_framing-fragmentation"><span class="secno">8.2.7.10 </span>Framing fragmentation</h5>
        <p>A single request/response sent over Bluetooth Low Energy Technology
           <em class="rfc2119" title="MAY">MAY</em> be split over multiple writes and notifications, due to the 
           inherent limitations of Bluetooth Low Energy Technology which is not
           currently meant for large messages.  Frames are fragmented in the 
           following way:</p>
        <p>A frame is divided into an <em>initialization fragment</em> and
           one or more <em>continuation fragments</em>.
        </p><p>An initialization fragment is defined as:
           </p><table class="simple">
             <tbody><tr><th>Offset</th><th>Length</th><th>Mnemonic</th><th>Description</th></tr>
             <tr><td>0</td><td>1</td><td><code>CMD</code></td><td>Command identifier</td></tr>
             <tr><td>1</td><td>1</td><td><code>HLEN</code></td><td>High part of data length</td></tr>
             <tr><td>2</td><td>1</td><td><code>LLEN</code></td><td>Low part of data length</td></tr>
             <tr><td>3</td><td>0 to (maxLen - 3)</td><td><code>DATA</code></td><td>Data</td></tr>
           </tbody></table>
        <p>where <code>maxLen</code> is the maximum packet size supported by
           the characteristic or notification.</p>
        <p>In other words, the start of an initialization fragment is
           indicated by setting the high bit in the first byte. The subsequent
           two bytes indicate the total length of the frame, in big-endian
           order. The first <code>maxLen</code> - 3 bytes of data follow.</p>

        <p>Continuation fragments are defined as:
        </p><table class="simple">
          <tbody><tr><th>Offset</th><th>Length</th><th>Mnemonic</th><th>Description</th></tr>
          <tr><td>0</td><td>1</td><td><code>SEQ</code></td><td>Packet sequence 0x00..0x7f (high bit always cleared)</td></tr>
          <tr><td>1</td><td>0 to (maxLen - 1)</td><td><code>DATA</code></td><td>Data</td></tr>
        </tbody></table>
        <p>where <code>maxLen</code> is the maximum packet size supported
           by the characteristic or notification.</p>
        <p>In other words, continuation fragments begin with a sequence number,
           beginning at 0, implicitly with the high bit cleared. The sequence
           number must wrap around to 0 after reaching the maximum sequence
           number of 0x7f.</p>

        <p>Example for sending a <code>PING</code> command with 40 bytes of
           data with a <code>maxLen</code> of 20 bytes:</p>
        <table class="simple">
          <tbody><tr><th>Frame</th><th>Bytes</th></tr>
          <tr><td>0</td><td><code>[810028] [17 bytes of data]</code>
          </td></tr><tr><td>1</td><td><code>[00] [19 bytes of data]</code>
          </td></tr><tr><td>2</td><td><code>[01] [4 bytes of data]</code>
        </td></tr></tbody></table>

        <p>Example for sending a ping command with 400 bytes of data with a
           <code>maxLen</code> of 512 bytes:</p>
        <table class="simple">
          <tbody><tr><th>Frame</th><th>Bytes</th></tr>
          <tr><td>0</td><td><code>[810190] [400 bytes of data]</code>
        </td></tr></tbody></table>
      </section>

      <section id="notifications">
        <h5 aria-level="4" role="heading" id="h5_notifications"><span class="secno">8.2.7.11 </span>Notifications</h5>
        <p>A client needs to register for notifications before it can receive them.
          Bluetooth Core Specification 4.0 or later [<a href="#BTCORE">BTCORE</a>]
          forces a device to remember the notification registration status over 
          different connections [<a href="#BTCCC">BTCCC</a>]. Unless a client explicitly
          unregisters for notifications, the registration will be automatically restored 
          when reconnecting. A client <em class="rfc2119" title="MAY">MAY</em> therefor check the notification status
          upon connection and only register if notifications aren't already registered.
          Please note that some clients <em class="rfc2119" title="MAY">MAY</em> disable notifications from a power management
          point of view (see below) and the notification registration is remembered per bond,
          not per client. A client <em class="rfc2119" title="MUST NOT">MUST NOT</em> remember the notification status in its own data
          storage.
        </p>
      </section>
      <section id="implementation-considerations">
        <h5 aria-level="4" role="heading" id="h5_implementation-considerations"><span class="secno">8.2.7.12 </span>Implementation Considerations</h5>

        <section id="bluetooth-pairing-client-considerations">
          <h6 aria-level="5" role="heading" id="h6_bluetooth-pairing-client-considerations"><span class="secno">8.2.7.12.1 </span>Bluetooth pairing: Client considerations</h6>
          <p>As noted in the Pairing section, a disadvantage of using standard
             Bluetooth pairing is that the pairing is "system-wide" on most
             operating systems.  That is, if an Authenticator is paired to a
             FIDO Client which resides on an operating system where Bluetooth
             pairing is "system-wide", then any application on that device
             might be able to interact with an Authenticator. This poses both
             security and privacy risks to users.</p>

          <p>While Client operating system security is partly out of FIDO's
             scope, further revisions of this specification <em class="rfc2119" title="MAY">MAY</em> propose
             mitigations for this issue.</p>
        </section>

        <section id="bluetooth-pairing-authenticator-considerations">
          <h6 aria-level="5" role="heading" id="h6_bluetooth-pairing-authenticator-considerations"><span class="secno">8.2.7.12.2 </span>Bluetooth pairing: Authenticator considerations</h6>
          <p>The method to put the Authenticator into Pairing Mode should be
             such that it is not easy for the user to do accidentally
             <strong>especially</strong> if the pairing method is Just Works.
             For example, the action could be pressing a physically recessed
             button or pressing multiple buttons.  A visible or audible cue
             that the Authenticator is in Pairing Mode should be considered.
             As a counter example, a silent, long press of a single
             non-recessed button is not advised as some users naturally hold
             buttons down during regular operation.</p>

          <p>Note that at times, Authenticators may legitimately receive
             communication from an unpaired device.  For example, a user
             attempts to use an Authenticator for the first time with a new
             Client: he turns it on, but forgets to put the Authenticator into
             pairing mode.  In this situation, after connecting to the
             Authenticator, the Client will notify the user that he needs to
             pair his Authenticator.  The Authenticator should make it easy for
             the user to do so, e.g., by not requiring the user to wait
             for a timeout before being able to enable pairing mode.
          </p>

        <p>Some Client platforms (most notably iOS) do not expose the AD Flag
           LE Limited and General Discoverable Mode bits to applications.  For
           this reason, Authenticators are also strongly recommended to include
           the Service Data field [<a href="BTSD">BTSD</a>] in the Scan 
           Response. The Service Data field is 3 or more octets long.
           This allows the Flags field to be extended while using the minimum 
           number of octets within the data packet. All octets that are 0x00 
           are not transmitted as long as all other octets after that octet are 
           also 0x00 and it is not the first octet after the service UUID. The 
           first 2 bytes contain the FIDO Service UUID, the following bytes are 
           flag bytes. </p>
           
           <p>To help Clients show the correct UX, Authenticators can use the
           Service Data field to specify whether or not Authenticators will 
           require a Passkey (PIN) during pairing.</p>
           
           <p></p><table class="tlv">
            <tbody><tr><th>Service Data Bit</th><th>Meaning (if set)</th></tr>
            <tr><td>7</td><td>Device is in pairing mode.</td></tr>
            <tr><td>6</td><td>Device requires Passkey Entry [<a href="#BTPESTK">BTPESTK</a>].</td></tr>
           </tbody></table>
           <p></p>
        </section>
      </section>

        <section id="handling-command-completion">
          <h5 aria-level="4" role="heading" id="h5_handling-command-completion"><span class="secno">8.2.7.13 </span>Handling command completion</h5>
          <p>It is important for low-power devices to be able to conserve power
             by shutting down or switching to a lower-power state when they
             have satisfied a Client's requests.  However, the FIDO protocol
             makes this hard as it typically includes more than one
             command/response. This is especially true  if a user has more than
             one key handle associated with an account or identity, multiple
             key handles may need to be tried before getting a successful
             outcome.  Furthermore, Clients that fail to send follow-up commands
             in a timely fashion may cause the Authenticator to drain its
             battery by staying powered up anticipating more commands.</p>

          <p>A further consideration is to ensure that a user is not confused
             about which command she is confirming by completing the test of
             user presence. That is, if a user performs the test of user
             presence, that action should perform exactly one operation.</p>

          <p>We combine these considerations into the following series of
             recommendations:</p>
          <ul>
            <li>Upon initial connection to an Authenticator, and upon receipt
                of a response from an Authenticator, if a Client has more
                commands to issue, the Client <em class="rfc2119" title="MUST">MUST</em> transmit the next command or
                fragment within <code>kMaxCommandTransmitDelayMillis</code>
                milliseconds. </li>
            <li>Upon final response from an Authenticator, if the Client decides it has no more
                commands to send it should indicate this by disabling notifications on the
                <code>fidoStatus</code> characteristic. When the notifications are disabled
                the Authenticator may enter a low power state or disconnect and shut down.</li>
            <li>Any time the Client wishes to send a FIDO message, it must have first enabled
                notifications on the <code>fidoStatus</code> characteristic and wait for the
                ATT acknowledgement to be sure the Authenticator is ready to process messages.</li>
            <li>Upon successful completion of a command which required a test
                of user presence, e.g. upon a successful authentication or
                registration command, the Authenticator can assume the Client
                is satisfied, and <em class="rfc2119" title="MAY">MAY</em> reset its state or power down.</li>
            <li>Upon sending a command response that did not consume a test of
                user presence, the Authenticator <em class="rfc2119" title="MUST">MUST</em> assume that the Client may
                wish to initiate another command, and leave the connection open
                until the Client closes it or until a timeout of at least
                <code>kErrorWaitMillis</code> elapses. Examples of command
                responses that do not consume user presence include failed
                authenticate or register commands, as well as get version
                responses, whether successful or not. After
                <code>kErrorWaitMillis</code> milliseconds have elapsed without
                further commands from a Client, an Authenticator <em class="rfc2119" title="MAY">MAY</em> reset its
                state or power down.</li>
          </ul>
          <table class="simple">
            <thead>
              <tr><th>Constant</th><th>Value</th></tr>
            </thead>
            <tbody><tr><td><code>kMaxCommandTransmitDelayMillis</code></td><td>1500 milliseconds</td></tr>
            <tr><td><code>kErrorWaitMillis</code></td><td>2000 milliseconds</td></tr>
            <tr><td><code>kKeepAliveMillis</code></td><td>500 milliseconds</td></tr>
          </tbody></table>
        </section>

        <section id="data-throughput">
          <h5 aria-level="4" role="heading" id="h5_data-throughput"><span class="secno">8.2.7.14 </span>Data throughput</h5>
          <p>Bluetooth Low Energy Technology does not have particularly high 
             throughput, this can cause noticeable latency to the user if 
             request/responses are large. Some ways that implementers can 
             reduce latency are:
          </p>
          <ul>
            <li>Support the maximum MTU size allowable by hardware (up to the
                512-byte max from the BLE specifications).
            </li><li>Make the attestation certificate as small as possible; do not
                include unnecessary extensions.
          </li></ul>
        </section>

        <section id="advertising">
          <h5 aria-level="4" role="heading" id="h5_advertising"><span class="secno">8.2.7.15 </span>Advertising</h5>
          <p>Though the standard does not appear to mandate it (in any way that
             we’ve found thus far), advertising and device discovery seems to
             work better when the Authenticators advertise on all 3 advertising
             channels and not just one.</p>
        </section>

        <section id="authenticator-address-type">
          <h5 aria-level="4" role="heading" id="h5_authenticator-address-type"><span class="secno">8.2.7.16 </span>Authenticator Address Type</h5>
          <p>In order to enhance the user's privacy and specifically to guard
             against tracking, it is recommended that Authenticators use
             Resolvable Private Addresses (RPAs) instead of static
             addresses.</p>
        </section>
      </section> <!-- end of implementation considerations -->
    </section> <!-- BLE -->

  </section> <!-- Transport-specific Bindings -->

  <section id="bibliography">
    <!--OddPage--><h2 aria-level="1" role="heading" id="h2_bibliography"><span class="secno">9. </span>Bibliography</h2>
    <p id="BTASSNUM">[BTASSNUM] Bluetooth Assigned Numbers.  URL: <a href="https://www.bluetooth.org/en-us/specification/assigned-numbers">https://www.bluetooth.org/en-us/specification/assigned-numbers</a></p>
    <p id="BTCORE">[BTCORE] Bluetooth Core Specification 4.0.  URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="BTDIS">[BTDIS] Device Information Service v1.1.  URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="BTGAP">[BTGAP] Generic Access Profile. Bluetooth Core Specification 4.0, Volume 3, Part C, Section 12.  URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="BTGAS">[BTGAS] Generic Access Profile service. Bluetooth Core Specification 4.0, Volume 3, Part C, Section 12. URL: <a href="https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.generic_access.xml">https://developer.bluetooth.org/gatt/services/Pages/ServiceViewer.aspx?u=org.bluetooth.service.generic_access.xml</a></p>
    <p id="BTCCC">[BTCCC] Client Characteristic Configuration. Bluetooth Core Specification 4.0, Volume 3, Part G, Section 3.3.3.3.  URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="BTXPLAD">[BTXPLAD] Bluetooth TX Power AD Type. Bluetooth Core Specification 4.0, Volume 3, Part C, Section 11. URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="BTSD">[BTSD] Bluetooth Service Data AD Type. Bluetooth Core Specification 4.0, Volume 3, Part C, Section 11. URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="BTPESTK">[BTPESTK] Passkey Entry. Bluetooth Core Specification 4.0, Volume 3, Part H, Section 2.3.5.3 URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="BTPNPID">[BTPNPID] PnP ID. <a href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.pnp_id.xml">https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.pnp_id.xml</a> URL: <a href="https://www.bluetooth.com/specifications/adopted-specifications">https://www.bluetooth.com/specifications/adopted-specifications</a></p>
    <p id="IANA-COSE-ALGS-REG">[IANA-COSE-ALGS-REG] IANA CBOR Object Signing and Encryption (COSE) Algorithms Registry.  URL: <a href="https://www.iana.org/assignments/cose/cose.xhtml#algorithms">https://www.iana.org/assignments/cose/cose.xhtml#algorithms</a></p>
    <p id="ISOIEC-7816-4-2013">[ISOIEC-7816-4-2013] ISO 7816-4: Identification cards - Integrated circuit cards; Part 4: Organization, security and commands for interchange</p>
    <p id="NISTSP800-56A">[NIST SP800-56A] Elaine Barker, Lily Chen, Allen Roginsky and Miles Smid <a href="http://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-56Ar2.pdf">Recommendation for Pair-Wise Key Establishment Schemes Using Discrete Logarithm Cryptography</a> URL: <a href="http://csrc.nist.gov/groups/ST/toolkit/documents/SP800-56Arev1_3-8-07.pdf">http://csrc.nist.gov/groups/ST/toolkit/documents/SP800-56Arev1_3-8-07.pdf</a></p>
  </section>

  

<section id="references" class="appendix" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter"><!--OddPage--><h2 aria-level="1" role="heading" id="h2_references"><span class="secno">A. </span>References</h2><section id="normative-references" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter"><h3 aria-level="2" role="heading" id="h3_normative-references"><span class="secno">A.1 </span>Normative references</h3><dl class="bibliography" about=""><dt id="bib-RFC2119">[RFC2119]</dt><dd rel="dcterms:requires">S. Bradner. <a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a>
</dd><dt id="bib-RFC7049">[RFC7049]</dt><dd rel="dcterms:requires">C. Bormann; P. Hoffman. <a href="https://tools.ietf.org/html/rfc7049"><cite>Concise Binary Object Representation (CBOR)</cite></a>. October 2013. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7049">https://tools.ietf.org/html/rfc7049</a>
</dd><dt id="bib-SEC1V2">[SEC1V2]</dt><dd rel="dcterms:requires">. <a href="http://secg.org/download/aid-780/sec1-v2.pdf"><cite>SEC1: Elliptic Curve Cryptography, Version 2.0</cite></a>. May 2009. URL: <a href="http://secg.org/download/aid-780/sec1-v2.pdf">http://secg.org/download/aid-780/sec1-v2.pdf</a>
</dd><dt id="bib-U2FRawMsgs">[U2FRawMsgs]</dt><dd rel="dcterms:requires">D. Balfanz. <a href="https://fidoalliance.org/specs/fido-u2f-raw-message-formats-v1.0-rd-20140209.pdf"><cite>FIDO U2F Raw Message Formats v1.0</cite></a>. Draft. URL: <a href="https://fidoalliance.org/specs/fido-u2f-raw-message-formats-v1.0-rd-20140209.pdf">http://fidoalliance.org/specs/fido-u2f-raw-message-formats-v1.0-rd-20140209.pdf</a>
</dd><dt id="bib-WebAuthN">[WebAuthN]</dt><dd rel="dcterms:requires">Vijay Bharadwaj; Hubert Le Van Gong; Dirk Balfanz; Alexei Czeskis; Arnar Birgisson; Jeff Hodges; Michael Jones; Rolf Lindemann; J.C. Jones. <a href="https://www.w3.org/TR/webauthn/"><cite>Web Authentication: An API for accessing Public Key Credentials Level 1</cite></a>. 11 August 2017. W3C Working Draft. URL: <a href="https://www.w3.org/TR/webauthn/">https://www.w3.org/TR/webauthn/</a>
</dd></dl></section><section id="informative-references" typeof="bibo:Chapter" resource="#ref" rel="bibo:Chapter"><h3 aria-level="2" role="heading" id="h3_informative-references"><span class="secno">A.2 </span>Informative references</h3><dl class="bibliography" about=""><dt id="bib-RFC8152">[RFC8152]</dt><dd rel="dcterms:references">J. Schaad. <a href="https://tools.ietf.org/html/rfc8152"><cite>CBOR Object Signing and Encryption (COSE)</cite></a>. July 2017. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc8152">https://tools.ietf.org/html/rfc8152</a>
</dd></dl></section></section><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body></html>
